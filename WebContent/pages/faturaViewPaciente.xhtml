<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets">

	<style>
.centerPanels .ui-panel .ui-panel-titlebar, .centerPanels .ui-panel .ui-panel-content
	{
	text-align: center;
}

.lancamentoExplain.ui-panelgrid.form-group .ui-panelgrid-cell {
	padding: 7px 16px;
}

.lancamentoExplain.ui-panelgrid.form-group .ui-panelgrid-cell:nth-child(1)
	{
	padding-top: 0;
}

.lessPaddingSides .ui-panelgrid-cell {
	padding-left: 5px !important;
	padding-right: 5px !important;
}

body .sideChkBox.ui-chkbox {
	width: auto;
}

body .sideChkBox .ui-chkbox-box {
	display: inline-block;
	vertical-align: middle;
	margin-right: 4px;
}

body .sideChkBox .ui-chkbox-label {
	vertical-align: middle;
	margin-top: 0;
}

.ui-confirm-dialog-message {
	white-space: pre-line;
}

body .negociacaoAprovada {
	background-color: #149952;
	color: white;
}

body .negociacaoEmAndamento {
	
}

body .lancamentoFalhaOperacao {
	background-color: #c44949;
	color: white;
}

.listaLancamentoColunaDataPagamento input {
	text-align: center;
	height: 31px;
}
</style>

	<!-- Telas que ainda usam FaturaView.xhtml antigo: movimentacoes.xhmtl, pagamentoRecebimentoFatura.xhtml, relatorioFatura.xhtml -->

	<p:dialog widgetVar="dlgNewLancamento" header="Novo Lançamento"
		responsive="true" modal="true" appendTo=":lume">
		<p:ajax event="close" resetValues="true" update="pnlNewLancamento" />
		<div class="ui-g ui-fluid">
			<div class="ui-g-12 ui-lg-12">
				<p:outputPanel id="pnlNewLancamento">
					<h:panelGroup styleClass="lumeField" id="pnTipo">
						<p:outputLabel for="formaPagamento" value="Forma de Pagamento: " />
						<p:selectOneRadio id="formaPagamento"
							value="#{faturaPagtoMB.formaPagamento}" required="true"
							layout="grid" columns="3">
							<p:ajax update="pnlNewLancamento" process="@this"
								listener="#{faturaPagtoMB.atualizaProduto}" />
							<f:selectItems value="#{faturaPagtoMB.formasPagamento}" var="tp"
								itemValue="#{tp.valor}" itemLabel="#{tp.nome}" />
						</p:selectOneRadio>
						<p:message styleClass="msg" for="formaPagamento" />
					</h:panelGroup>
					<h:panelGroup styleClass="lumeField"
						rendered="#{faturaPagtoMB.showProduto}">
						<p:outputLabel for="produtoLancamento" value="Produto: " />
						<p:selectOneMenu id="produtoLancamento"
							value="#{faturaPagtoMB.tarifa}" converter="tarifa"
							required="#{faturaPagtoMB.showProduto}">
							<p:ajax listener="#{faturaPagtoMB.atualizaDataCredito}"
								process="@this" update="pnlNewLancamento" />
							<f:selectItem itemLabel="Selecione um Produto"
								itemValue="#{null}" />
							<f:selectItems value="#{faturaPagtoMB.tarifas}" var="tp"
								itemValue="#{tp}" itemLabel="#{tp.produtoStr}" />
						</p:selectOneMenu>
						<p:message for="produtoLancamento" styleClass="msg" />
					</h:panelGroup>
					<h:panelGroup styleClass="lumeField"
						rendered="#{faturaPagtoMB.existeCadastroTarifa() and faturaPagtoMB.tarifa != null}">
						<p:outputLabel for="numParcelas" value="Parcelas: " />
						<p:selectOneMenu id="numParcelas" value="#{faturaPagtoMB.parcela}"
							filter="true" filterMatchMode="startsWith">
							<f:selectItems value="#{faturaPagtoMB.parcelas}" var="p"
								itemValue="#{p}" itemLabel="#{p}" />
						</p:selectOneMenu>
						<p:message for="numParcelas" styleClass="msg" />
					</h:panelGroup>
					<h:panelGroup styleClass="lumeField">
						<p:outputLabel for="valorAPagar" value="Valor: " />
						<p:inputNumber id="valorAPagar" value="#{faturaPagtoMB.valor}"
							required="true" maxlength="13" maxValue="9999999999.99"
							decimalSeparator="," symbol="R$ " thousandSeparator=".">
						</p:inputNumber>
					</h:panelGroup>
					<h:panelGroup styleClass="lumeField" id="pnJustificativa">
						<p:outputLabel for="dataPagamento" value="Data de Pagamento: " />
						<p:calendar id="dataPagamento"
							value="#{faturaPagtoMB.dataPagamento}" required="true"
							pattern="dd/MM/yyyy" showWeeksBar="false"
							locale="#{lumeSecurity.locale}"
							timeZone="#{lumeSecurity.timeZone}" navigator="true"
							yearRange="-10:+10">
							<p:ajax event="dateSelect"
								listener="#{faturaPagtoMB.handleSelectPagamento}"
								update="pnlNewLancamento" process="@this, pnlNewLancamento" />
						</p:calendar>
						<p:message for="dataPagamento" styleClass="msg" />
					</h:panelGroup>
					<h:panelGroup styleClass="lumeField">
						<p:outputLabel for="dataCredito" value="Data de Crédito:" />
						<p:calendar id="dataCredito" value="#{faturaPagtoMB.dataCredito}"
							pattern="dd/MM/yyyy" showWeeksBar="false"
							locale="#{lumeSecurity.locale}"
							timeZone="#{lumeSecurity.timeZone}" navigator="true"
							yearRange="-10:+10" disabled="#{!faturaPagtoMB.administrador}" />
						<p:message for="dataCredito" styleClass="msg" />
					</h:panelGroup>
					<div class="SeparatorFull"></div>
					<p:panelGrid columns="1" layout="grid"
						styleClass="ui-panelgrid-blank form-group ui-fluid removeSideGridPadding">
						<p:commandButton value="Salvar" icon="White fa fa-save"
							actionListener="#{faturaPagtoMB.actionPersistLancamento}"
							update="pnlNewLancamento, pnlfaturaView, buttonViewFatura"
							process="@this, pnlNewLancamento" styleClass="GreenButton" />
					</p:panelGrid>
				</p:outputPanel>
			</div>
		</div>
	</p:dialog>

	<p:dialog widgetVar="dlgNovoLancamento" header="Novo Lançamento"
		responsive="true" modal="true" appendTo=":lume" width="70%"
		height="80%">
		<div class="ui-g ui-fluid">
			<div class="ui-g-12 ui-lg-12">

				<p:outputPanel
					style="position: relative; max-height: calc(80vh - 69px); height: calc(80vh - 69px);">
					<p:scrollPanel mode="native"
						style="position: relative; width: calc(100% - 20px); height: calc(100% - 20px); max-height: calc(100% - 20px); padding: 10px;">

						<p:outputPanel id="pnlNovoLancamento">
							<p:remoteCommand name="novoLancamentoRefazCalculos"
								process="@this"
								actionListener="#{faturaPagtoMB.novoLancamentoRefazCalculos()}"
								update="novoLancamentoValorPrimeiraParcela, novoLancamentoInfoParcelamento, novoLancamentoParcelasTable" />
							<p:panelGrid columns="1" layout="grid"
								styleClass="ui-panelgrid-blank form-group ui-fluid removeSideGridPadding">

								<h:panelGroup styleClass="md-combo">

									<p:outputLabel for="novoLancamentoFiltroParcelas"
										value="Quantidade de Parcelas:" />

									<p:outputPanel style="display: flex !important">
										<p:selectOneMenu id="novoLancamentoFiltroParcelas"
											value="#{faturaPagtoMB.novoLancamentoQuantidadeParcelas}"
											forceSelection="true" scrollHeight="400">

											<f:selectItem
												itemLabel="Selecione uma quantidade de parcelas..."
												itemValue="#{null}" />
											<f:selectItems
												value="#{faturaPagtoMB.novoLancamentoParcelasDisponiveis}"
												var="p" itemValue="#{p}" itemLabel="#{p} parcelas" />

											<p:ajax process="@this"
												listener="#{faturaPagtoMB.actionNovoLancamentoAtualizaQuantidadeDeParcelas}"
												update="tooltipNovoLancamentoTarifasDisponiveisObj, novoLancamentoFormaPagamento, novoLancamentoValorPrimeiraParcela, novoLancamentoInfoParcelamento, novoLancamentoParcelasTable" />
										</p:selectOneMenu>
										<p:outputPanel id="tooltipNovoLancamentoTarifasDisponiveisObj">
											<h:outputLabel class="fa fa-question"
												id="tooltipNovoLancamentoTarifasDisponiveis"
												style="font-size:16px; margin-left:10px; margin-top:10px;" />
											<p:tooltip for="tooltipNovoLancamentoTarifasDisponiveis"
												position="bottom" escape="false"
												value="#{faturaPagtoMB.novoLancamentoTooltipNegociacaoTarifasDisponiveis}" />
										</p:outputPanel>
									</p:outputPanel>


									<p:message styleClass="msg" for="novoLancamentoFiltroParcelas" />

								</h:panelGroup>

								<h:panelGroup styleClass="md-combo">
									<p:outputLabel for="novoLancamentoFormaPagamento"
										value="Forma de Pagamento:" />
									<p:selectOneMenu id="novoLancamentoFormaPagamento"
										converter="tarifa"
										value="#{faturaPagtoMB.novoLancamentoFormaPagamento}">
										<f:selectItem itemValue="#{null}"
											itemLabel="Selecione uma Forma de Pagamento:" />
										<f:selectItems
											value="#{faturaPagtoMB.novoLancamentoTarifasDisponiveis}"
											var="tf" itemValue="#{tf}" itemLabel="#{tf.produtoStr}" />
										<p:ajax event="change"
											listener="#{faturaPagtoMB.actionNovoLancamentoAlteraFormaPagamento}"
											update="novoLancamentoDataCredito, novoLancamentoParcelasTable"
											process="@this" />
									</p:selectOneMenu>
									<p:message for="novoLancamentoFormaPagamento" styleClass="msg" />
								</h:panelGroup>

								<h:panelGroup styleClass="md-inputfield">
									<p:inputNumber id="novoLancamentoValorTotal"
										value="#{faturaPagtoMB.novoLancamentoValorTotal}"
										maxlength="13" maxValue="9999999999.99" decimalSeparator=","
										symbol="R$ " thousandSeparator=".">
										<p:ajax process="@this"
											oncomplete="novoLancamentoRefazCalculos()" />
									</p:inputNumber>
									<p:outputLabel for="novoLancamentoValorTotal" value="Valor:" />
									<p:message styleClass="msg" for="novoLancamentoValorTotal" />
								</h:panelGroup>

								<h:panelGroup styleClass="md-inputfield"
									style="margin-top: 10px;">
									<p:inputNumber id="novoLancamentoValorPrimeiraParcela"
										value="#{faturaPagtoMB.novoLancamentoValorDaPrimeiraParcela}"
										maxlength="13" maxValue="9999999999.99" decimalSeparator=","
										symbol="R$ " thousandSeparator=".">
										<p:ajax process="@this"
											oncomplete="novoLancamentoRefazCalculos()" />
									</p:inputNumber>
									<p:outputLabel for="novoLancamentoValorPrimeiraParcela"
										value="Valor da Primeira Parcela:" />
									<p:message styleClass="msg"
										for="novoLancamentoValorPrimeiraParcela" />
								</h:panelGroup>

								<h:panelGroup styleClass="md-inputfield">
									<p:calendar id="novoLancamentoDataPagamento"
										value="#{faturaPagtoMB.novoLancamentoDataPagamento}"
										pattern="dd/MM/yyyy" showWeeksBar="false"
										locale="#{lumeSecurity.locale}"
										timeZone="#{lumeSecurity.timeZone}" navigator="true"
										yearRange="-10:+10">
										<p:ajax event="dateSelect"
											listener="#{faturaPagtoMB.actionNovoLancamentoAlteraDataPagamento}"
											update="novoLancamentoDataCredito"
											process="@this, novoLancamentoFormaPagamento"
											oncomplete="novoLancamentoRefazCalculos()" />
									</p:calendar>
									<p:outputLabel for="novoLancamentoDataPagamento"
										value="Data de Pagamento: " />
									<p:message for="novoLancamentoDataPagamento" styleClass="msg" />
								</h:panelGroup>

								<h:panelGroup styleClass="md-inputfield">
									<p:calendar id="novoLancamentoDataCredito"
										value="#{faturaPagtoMB.novoLancamentoDataCredito}"
										pattern="dd/MM/yyyy" showWeeksBar="false"
										locale="#{lumeSecurity.locale}"
										timeZone="#{lumeSecurity.timeZone}" navigator="true"
										yearRange="-10:+10" disabled="#{!faturaPagtoMB.administrador}">
										<p:ajax event="dateSelect" process="@this"
											oncomplete="novoLancamentoRefazCalculos()" />
									</p:calendar>
									<p:outputLabel for="novoLancamentoDataCredito"
										value="Data de Crédito:" />
									<p:message for="novoLancamentoDataCredito" styleClass="msg" />
								</h:panelGroup>

								<p:outputPanel id="novoLancamentoInfoParcelamento">
									<p:outputPanel
										rendered="#{faturaPagtoMB.novoLancamentoMensagemCalculo != null}">

										<p:outputLabel style="font-weight:bold;font-size:18px"
											value="#{faturaPagtoMB.novoLancamentoMensagemCalculo}"></p:outputLabel>
										<br />
										<p:outputLabel style="font-weight:bold;color:red"
											value="#{faturaPagtoMB.novoLancamentoMensagemErroCalculo}"></p:outputLabel>

									</p:outputPanel>
								</p:outputPanel>

								<p:dataTable emptyMessage="Nenhuma parcela criada ainda."
									id="novoLancamentoParcelasTable" filterDelay="1500"
									reflow="true" value="#{faturaPagtoMB.novoLancamentoParcelas}"
									var="parcela" rows="10" paginator="true" rowKey="#{parcela}"
									paginatorPosition="bottom"
									widgetVar="dtNovoLancamentoParcelasTable">
									<f:facet name="header">Lista de Parcelas a serem criadas</f:facet>
									<p:column filterBy="#{parcela.seq}" sortBy="#{parcela.seq}"
										filterMatchMode="contains" headerText="Nº" width="30">
										<h:outputText value="#{parcela.seq}" />
									</p:column>
									<p:column filterBy="#{parcela.valor}" sortBy="#{parcela.valor}"
										filterMatchMode="contains" headerText="Valor da Parcela">
										<h:outputText value="#{parcela.valor}">
											<f:convertNumber type="currency" currencySymbol="R$"
												maxFractionDigits="2" />
										</h:outputText>
									</p:column>
									<p:column filterBy="#{parcela.formaPagamento.produtoStr}"
										sortBy="#{parcela.formaPagamento.produtoStr}"
										filterMatchMode="contains" headerText="Forma de Pagamento">

										<p:selectOneMenu converter="tarifa"
											value="#{parcela.formaPagamento}">
											<f:selectItem itemValue="#{null}"
												itemLabel="Selecione uma Forma de Pagamento:" />
											<f:selectItems
												value="#{faturaPagtoMB.novoLancamentoTarifasDisponiveis}"
												var="tf" itemValue="#{tf}" itemLabel="#{tf.produtoStr}" />
											<p:ajax event="change" update="novoLancamentoParcelasTable"
												process="@this" />
										</p:selectOneMenu>

									</p:column>
									<p:column filterBy="#{parcela.dataPagamento}"
										sortBy="#{parcela.dataPagamento}" filterMatchMode="contains"
										headerText="Data de Pagamento">
										<p:calendar value="#{parcela.dataPagamento}"
											pattern="dd/MM/yyyy" showWeeksBar="false"
											locale="#{lumeSecurity.locale}"
											timeZone="#{lumeSecurity.timeZone}" navigator="true"
											yearRange="-10:+10"
											styleClass="listaLancamentoColunaDataPagamento">
											<p:ajax event="dateSelect"
												update="novoLancamentoParcelasTable" process="@this" />
										</p:calendar>
									</p:column>
									<p:column filterBy="#{parcela.dataCredito}"
										sortBy="#{parcela.dataCredito}" filterMatchMode="contains"
										headerText="Data de Crédito">
										<h:outputText value="#{parcela.dataCredito}">
											<f:convertDateTime pattern="dd/MM/yyyy" />
										</h:outputText>
									</p:column>
								</p:dataTable>
							</p:panelGrid>
						</p:outputPanel>

					</p:scrollPanel>
				</p:outputPanel>

				<p:separator styleClass="SeparatorFull" />

				<p:panelGrid columns="2" layout="grid"
					styleClass="ui-panelgrid-blank form-group ui-fluid removeSideGridPadding">

					<p:commandButton value="Salvar" icon="White fa fa-save"
						actionListener="#{faturaPagtoMB.actionPersistNovoNovoLancamento}"
						update="pnlfaturaView" process="@this, pnlNovoLancamento"
						styleClass="GreenButton" />
					<p:commandButton value="Fechar" icon="White fa fa-close"
						process="@this" oncomplete="PF('dlgNovoLancamento').hide()"
						styleClass="NavyButton" />

				</p:panelGrid>
			</div>
		</div>
	</p:dialog>

	<p:dialog widgetVar="dlgEditarLancamento" header="Editar Lançamento"
		responsive="true" modal="true" appendTo=":lume" width="700px">
		<div class="ui-g ui-fluid">
			<div class="ui-g-12 ui-lg-12">
				<p:outputPanel id="pnlEditarLancamento">
					<p:panelGrid columns="1" layout="grid"
						styleClass="ui-panelgrid-blank form-group ui-fluid removeSideGridPadding">

						<h:panelGroup styleClass="md-combo">
							<p:outputLabel for="editarLancamentoFormaPagamento"
								value="Forma de Pagamento:" />
							<p:selectOneMenu id="editarLancamentoFormaPagamento"
								converter="tarifa"
								value="#{faturaPagtoMB.editarLancamento.tarifa}">
								<f:selectItem itemValue="#{null}"
									itemLabel="Selecione uma Forma de Pagamento:" />
								<f:selectItems
									value="#{faturaPagtoMB.editarLancamentoFormasDisponiveis}"
									var="tf" itemValue="#{tf}" itemLabel="#{tf.produtoStr}" />
								<p:ajax event="change"
									listener="#{faturaPagtoMB.actionEditarLancamentoAlteraFormaPagamento}"
									update="editarLancamentoDataCredito" process="@this" />
							</p:selectOneMenu>
							<p:message for="editarLancamentoFormaPagamento" styleClass="msg" />
						</h:panelGroup>

						<h:panelGroup styleClass="md-inputfield">
							<p:calendar id="editarLancamentoDataPagamento"
								value="#{faturaPagtoMB.editarLancamento.dataPagamento}"
								pattern="dd/MM/yyyy" showWeeksBar="false"
								locale="#{lumeSecurity.locale}"
								timeZone="#{lumeSecurity.timeZone}" navigator="true"
								yearRange="-10:+10">
								<p:ajax event="dateSelect"
									listener="#{faturaPagtoMB.actionEditarLancamentoAlteraDataPagamento}"
									update="editarLancamentoDataCredito" process="@this" />
							</p:calendar>
							<p:outputLabel for="editarLancamentoDataPagamento"
								value="Data de Pagamento: " />
							<p:message for="editarLancamentoDataPagamento" styleClass="msg" />
						</h:panelGroup>

						<h:panelGroup styleClass="md-inputfield">
							<p:calendar id="editarLancamentoDataCredito"
								value="#{faturaPagtoMB.editarLancamento.dataCredito}"
								pattern="dd/MM/yyyy" showWeeksBar="false"
								locale="#{lumeSecurity.locale}"
								timeZone="#{lumeSecurity.timeZone}" navigator="true"
								yearRange="-10:+10" disabled="#{!faturaPagtoMB.administrador}" />
							<p:outputLabel for="editarLancamentoDataCredito"
								value="Data de Crédito:" />
							<p:message for="editarLancamentoDataCredito" styleClass="msg" />
						</h:panelGroup>

					</p:panelGrid>
				</p:outputPanel>

				<p:separator styleClass="SeparatorFull" />

				<p:panelGrid columns="2" layout="grid"
					styleClass="ui-panelgrid-blank form-group ui-fluid removeSideGridPadding">

					<p:commandButton value="Salvar" icon="White fa fa-save"
						actionListener="#{faturaPagtoMB.actionPersistEditarLancamento}"
						update="pnlfaturaView" process="@this, pnlEditarLancamento"
						styleClass="GreenButton" />
					<p:commandButton value="Fechar" icon="White fa fa-close"
						process="@this" oncomplete="PF('dlgEditarLancamento').hide()"
						styleClass="NavyButton" />

				</p:panelGrid>
			</div>
		</div>
	</p:dialog>

	<p:dialog widgetVar="dlgNovaNegociacao" header="Nova Negociação"
		responsive="true" modal="true" appendTo=":lume" width="70%">
		<div class="ui-g ui-fluid">
			<div class="ui-g-12 ui-lg-12">
				<p:outputPanel id="pnlNovaNegociacao">
					<p:remoteCommand name="refazCalculos" process="@this"
						actionListener="#{faturaPagtoMB.refazCalculos()}"
						update="negociacaoValorPrimeiraParcela, infoParcelamento" />
					<p:panelGrid columns="2" layout="grid"
						styleClass="ui-panelgrid-blank form-group ui-fluid removeSideGridPadding">

						<p:outputPanel>
							<p:panelGrid columns="1" layout="grid"
								styleClass="ui-panelgrid-blank form-group ui-fluid removeSideGridPadding">

								<h:panelGroup styleClass="md-combo">

									<p:outputLabel for="filtroParcelas"
										value="Quantidade de Parcelas:" />

									<p:outputPanel style="display: flex !important">
										<p:selectOneMenu id="filtroParcelas" var="parcelaInfo"
											value="#{faturaPagtoMB.negociacaoQuantidadeParcelas}"
											forceSelection="true" scrollHeight="400">

											<f:selectItem
												itemLabel="Selecione uma quantidade de parcelas..."
												itemValue="#{null}" />
											<f:selectItems value="#{faturaPagtoMB.parcelasDisponiveis}"
												var="p" itemValue="#{p}"
												itemLabel="#{p} parcelas &#8211; Desconto Máx: #{faturaPagtoMB.getDescontoFromParcela(p)}" />

											<p:column headerText="Quantidade de Parcelas"
												style="text-align: center;">
												<h:outputText value="#{parcelaInfo} parcelas" />
											</p:column>
											<p:column headerText="Desconto Máximo">
												<h:outputText
													value="#{faturaPagtoMB.getDescontoFromParcela(parcelaInfo)}" />
											</p:column>

											<p:ajax process="@this"
												listener="#{faturaPagtoMB.atualizaQuantidadeDeParcelas}"
												update="tooltipNovaNegociacaoTarifasDisponiveisObj, negociacaoTipoDesconto, negociacaoValorDesconto, negociacaoValorPrimeiraParcela, infoParcelamento" />
										</p:selectOneMenu>
										<p:outputPanel id="tooltipNovaNegociacaoTarifasDisponiveisObj">
											<h:outputLabel class="fa fa-question"
												id="tooltipNovaNegociacaoTarifasDisponiveis"
												style="font-size:16px; margin-left:10px; margin-top:10px;" />
											<p:tooltip for="tooltipNovaNegociacaoTarifasDisponiveis"
												position="bottom" escape="false"
												value="#{faturaPagtoMB.tooltipNegociacaoTarifasDisponiveis}" />
										</p:outputPanel>
									</p:outputPanel>
								</h:panelGroup>
								<h:panelGroup styleClass="md-combo" style="margin-top: 10px;">
									<p:outputLabel for="negociacaoTipoDesconto"
										value="Tipo de Desconto:" />
									<p:selectOneMenu id="negociacaoTipoDesconto"
										value="#{faturaPagtoMB.negociacaoTipoDesconto}">

										<f:selectItem itemLabel="Porcentagem" itemValue="P" />
										<f:selectItem itemLabel="Valor" itemValue="V" />

										<p:ajax process="@this"
											listener="#{faturaPagtoMB.atualizaTipoDesconto}"
											update="negociacaoValorDesconto, negociacaoValorPrimeiraParcela, infoParcelamento" />
									</p:selectOneMenu>
								</h:panelGroup>

								<h:panelGroup styleClass="md-inputfield taller"
									style="margin-top: 10px;">
									<p:outputPanel id="negociacaoValorDesconto">
										<p:inputNumber id="negociacaoValorDescValor"
											value="#{faturaPagtoMB.negociacaoValorDesconto}"
											maxlength="13" maxValue="9999999999.99" decimalSeparator=","
											symbol="R$ " thousandSeparator="."
											rendered="#{faturaPagtoMB.negociacaoTipoDesconto == 'V'}">
											<p:ajax process="@this" oncomplete="refazCalculos()" />
										</p:inputNumber>
										<p:outputLabel for="negociacaoValorDescValor"
											value="Valor do Desconto:"
											rendered="#{faturaPagtoMB.negociacaoTipoDesconto == 'V'}" />
										<p:inputNumber id="negociacaoValorDescPorcentagem"
											value="#{faturaPagtoMB.negociacaoValorDesconto}"
											styleClass="taller" maxlength="13" maxValue="9999999999.99"
											decimalSeparator="," symbol="%" thousandSeparator="."
											symbolPosition="s"
											rendered="#{faturaPagtoMB.negociacaoTipoDesconto == 'P'}">
											<p:ajax process="@this" oncomplete="refazCalculos()" />
										</p:inputNumber>
										<p:outputLabel for="negociacaoValorDescPorcentagem"
											value="Percentual de Desconto:"
											rendered="#{faturaPagtoMB.negociacaoTipoDesconto == 'P'}" />
									</p:outputPanel>
								</h:panelGroup>

								<h:panelGroup styleClass="md-inputfield taller"
									style="margin-top: 10px;">
									<p:inputNumber id="negociacaoValorPrimeiraParcela"
										value="#{faturaPagtoMB.negociacaoValorDaPrimeiraParcela}"
										maxlength="13" maxValue="9999999999.99" decimalSeparator=","
										symbol="R$ " thousandSeparator=".">
										<p:ajax process="@this" oncomplete="refazCalculos()" />
									</p:inputNumber>
									<p:outputLabel for="negociacaoValorPrimeiraParcela"
										value="Valor da Primeira Parcela:" />
								</h:panelGroup>

								<p:outputPanel id="infoParcelamento">
									<p:outputPanel
										rendered="#{faturaPagtoMB.negociacaoMensagemCalculo != null}">

										<p:outputLabel style="font-weight:bold;font-size:18px"
											value="#{faturaPagtoMB.negociacaoMensagemCalculo}"></p:outputLabel>
										<br />
										<p:outputLabel style="font-weight:bold;color:red"
											value="#{faturaPagtoMB.negociacaoMensagemErroCalculo}"></p:outputLabel>

									</p:outputPanel>
								</p:outputPanel>

							</p:panelGrid>
						</p:outputPanel>

						<p:outputPanel>
							<h:panelGroup styleClass="md-inputfield">
								<p:inputTextarea rows="14" cols="33" id="negociacaoObservacao"
									style="height: 237px !important"
									value="#{faturaPagtoMB.negociacaoObservacao}" />
								<p:outputLabel for="negociacaoObservacao" value="Observação:" />
							</h:panelGroup>
						</p:outputPanel>

					</p:panelGrid>
				</p:outputPanel>

				<p:separator styleClass="SeparatorFull" />

				<p:panelGrid columns="2" layout="grid"
					styleClass="ui-panelgrid-blank form-group ui-fluid removeSideGridPadding">

					<p:commandButton value="Salvar" icon="White fa fa-save"
						actionListener="#{faturaPagtoMB.actionPersistNegociacao}"
						update="pnlfaturaView" process="@this, pnlNovaNegociacao"
						styleClass="GreenButton" />
					<p:commandButton value="Fechar" icon="White fa fa-close"
						process="@this" oncomplete="PF('dlgNovaNegociacao').hide()"
						styleClass="NavyButton" />

				</p:panelGrid>
			</div>
		</div>
	</p:dialog>

	<p:dialog widgetVar="dlgAprovaNegociacao" header="Confirmar Negociação"
		responsive="true" modal="true" appendTo=":lume" width="70%">
		<div class="ui-g ui-fluid">
			<div class="ui-g-12 ui-lg-12">

				<p:outputPanel
					style="position: relative; max-height: calc(80vh - 69px); height: calc(80vh - 69px);">
					<p:scrollPanel mode="native"
						style="position: relative; width: calc(100% - 20px); height: calc(100% - 20px); max-height: calc(100% - 20px); padding: 10px;">

						<p:outputPanel id="pnlAprovaNegociacao">
							<p:fieldset legend="O que foi negociado: ">
								<p:panelGrid columns="2" layout="grid"
									styleClass="ui-panelgrid-blank form-group ui-fluid removeSideGridPadding">

									<p:outputPanel>
										<p:panelGrid columns="1" layout="grid"
											styleClass="ui-panelgrid-blank form-group ui-fluid removeSideGridPadding">

											<h:panelGroup styleClass="md-combo">
												<p:outputLabel for="filtroParcelasAprovacao"
													value="Quantidade de Parcelas:" />

												<p:outputPanel style="display: flex !important">
													<p:selectOneMenu id="filtroParcelasAprovacao"
														var="parcelaInfo"
														value="#{faturaPagtoMB.negociacaoQuantidadeParcelas}"
														forceSelection="true" scrollHeight="400" disabled="true">

														<f:selectItem
															itemLabel="Selecione uma quantidade de parcelas..."
															itemValue="#{null}" />
														<f:selectItems
															value="#{faturaPagtoMB.parcelasDisponiveis}" var="p"
															itemValue="#{p}"
															itemLabel="#{p} parcelas &#8211; Desconto Máx: #{faturaPagtoMB.getDescontoFromParcela(p)}" />

														<p:column headerText="Quantidade de Parcelas"
															style="text-align: center;">
															<h:outputText value="#{parcelaInfo} parcelas" />
														</p:column>
														<p:column headerText="Desconto Máximo">
															<h:outputText
																value="#{faturaPagtoMB.getDescontoFromParcela(parcelaInfo)}" />
														</p:column>

													</p:selectOneMenu>
													<p:outputPanel
														id="tooltipConfirmaNegociacaoTarifasDisponiveisObj">
														<h:outputLabel class="fa fa-question"
															id="tooltipConfirmaNegociacaoTarifasDisponiveis"
															style="font-size:16px; margin-left:10px; margin-top:10px;" />
														<p:tooltip
															for="tooltipConfirmaNegociacaoTarifasDisponiveis"
															position="bottom" escape="false"
															value="#{faturaPagtoMB.tooltipNegociacaoTarifasDisponiveis}" />
													</p:outputPanel>
												</p:outputPanel>

											</h:panelGroup>

											<h:panelGroup styleClass="md-combo">
												<p:outputLabel for="negociacaoTipoDescontoAprovacao"
													value="Tipo de Desconto:" />
												<p:selectOneMenu id="negociacaoTipoDescontoAprovacao"
													value="#{faturaPagtoMB.negociacaoTipoDesconto}"
													disabled="true">

													<f:selectItem itemLabel="Porcentagem" itemValue="P" />
													<f:selectItem itemLabel="Valor" itemValue="V" />

												</p:selectOneMenu>
											</h:panelGroup>

											<h:panelGroup styleClass="md-inputfield taller">
												<p:outputPanel id="negociacaoValorDescontoAprovacao">
													<p:inputNumber id="negociacaoValorDescValorAprovacao"
														value="#{faturaPagtoMB.negociacaoValorDesconto}"
														maxlength="13" maxValue="9999999999.99"
														decimalSeparator="," symbol="R$ " thousandSeparator="."
														readonly="true"
														rendered="#{faturaPagtoMB.negociacaoTipoDesconto == 'V'}">
													</p:inputNumber>
													<p:outputLabel for="negociacaoValorDescValorAprovacao"
														value="Valor do Desconto:"
														rendered="#{faturaPagtoMB.negociacaoTipoDesconto == 'V'}" />
													<p:inputNumber id="negociacaoValorDescPorcentagemAprovacao"
														value="#{faturaPagtoMB.negociacaoValorDesconto}"
														styleClass="taller" maxlength="13"
														maxValue="9999999999.99" decimalSeparator="," symbol="%"
														thousandSeparator="." symbolPosition="s" readonly="true"
														rendered="#{faturaPagtoMB.negociacaoTipoDesconto == 'P'}">
													</p:inputNumber>
													<p:outputLabel
														for="negociacaoValorDescPorcentagemAprovacao"
														value="Percentual de Desconto:"
														rendered="#{faturaPagtoMB.negociacaoTipoDesconto == 'P'}" />
												</p:outputPanel>
											</h:panelGroup>

											<h:panelGroup styleClass="md-inputfield taller">
												<p:inputNumber id="negociacaoValorPrimeiraParcelaAprovacao"
													value="#{faturaPagtoMB.negociacaoValorDaPrimeiraParcela}"
													maxlength="13" maxValue="9999999999.99"
													decimalSeparator="," symbol="R$ " thousandSeparator="."
													readonly="true">
												</p:inputNumber>
												<p:outputLabel for="negociacaoValorPrimeiraParcelaAprovacao"
													value="Valor da Primeira Parcela:" />
											</h:panelGroup>

											<p:outputPanel id="infoParcelamentoAprovacao">
												<p:outputPanel
													rendered="#{faturaPagtoMB.negociacaoMensagemCalculo != null}">

													<p:outputLabel style="font-weight:bold;font-size:18px"
														value="#{faturaPagtoMB.negociacaoMensagemCalculo}"></p:outputLabel>
													<br />
													<p:outputLabel style="font-weight:bold;color:red"
														value="#{faturaPagtoMB.negociacaoMensagemErroCalculo}"></p:outputLabel>

												</p:outputPanel>
											</p:outputPanel>

										</p:panelGrid>
									</p:outputPanel>

									<p:outputPanel>
										<h:panelGroup styleClass="md-inputfield">
											<p:inputTextarea rows="12" cols="33"
												id="negociacaoObservacaoAprovacao" readonly="true"
												value="#{faturaPagtoMB.negociacaoObservacao}" />
											<p:outputLabel for="negociacaoObservacaoAprovacao"
												value="Observação:" />
										</h:panelGroup>
									</p:outputPanel>

								</p:panelGrid>
							</p:fieldset>

							<p:panelGrid columns="1" layout="grid" style="margin-top: 20px;"
								styleClass="ui-panelgrid-blank form-group ui-fluid removeSideGridPadding">

								<h:panelGroup styleClass="md-combo">
									<p:outputLabel for="negociacaoFormaPagamentoAprovacao"
										value="Forma de Pagamento:" />
									<p:selectOneMenu id="negociacaoFormaPagamentoAprovacao"
										converter="tarifa"
										value="#{faturaPagtoMB.negociacaoFormaPagamento}">
										<f:selectItem itemValue="#{null}"
											itemLabel="Selecione uma Forma de Pagamento:" />
										<f:selectItems
											value="#{faturaPagtoMB.negociacaoTarifasDisponiveis}"
											var="tf" itemValue="#{tf}" itemLabel="#{tf.produtoStr}" />
										<p:ajax event="change" process="@this"
											update="negociacaoParcelasTable"
											listener="#{faturaPagtoMB.actionAlteraFormaPagamentoNegociacao}" />
									</p:selectOneMenu>
									<p:message for="negociacaoFormaPagamentoAprovacao"
										styleClass="msg" />
								</h:panelGroup>

								<h:panelGroup styleClass="md-inputfield">
									<p:inputNumber id="negociacaoValorTotalAprovacao"
										value="#{faturaPagtoMB.negociacaoValorTotal}" maxlength="13"
										maxValue="9999999999.99" decimalSeparator="," symbol="R$ "
										thousandSeparator="." readonly="true">
									</p:inputNumber>
									<p:outputLabel for="negociacaoValorTotalAprovacao"
										value="Valor:" />
								</h:panelGroup>

								<h:panelGroup styleClass="md-inputfield">
									<p:calendar id="negociacaoDataPagamentoAprovacao"
										value="#{faturaPagtoMB.negociacaoDataPagamento}"
										pattern="dd/MM/yyyy" showWeeksBar="false"
										locale="#{lumeSecurity.locale}"
										timeZone="#{lumeSecurity.timeZone}" navigator="true"
										yearRange="-10:+10">
										<p:ajax event="dateSelect"
											listener="#{faturaPagtoMB.actionAlteraDataPagamentoNegociacao}"
											update="negociacaoDataCreditoAprovacao, negociacaoParcelasTable"
											process="@this, negociacaoFormaPagamentoAprovacao" />
									</p:calendar>
									<p:outputLabel for="negociacaoDataPagamentoAprovacao"
										value="Data de Pagamento: " />
									<p:message for="negociacaoDataCreditoAprovacao"
										styleClass="msg" />
								</h:panelGroup>

								<h:panelGroup styleClass="md-inputfield">
									<p:calendar id="negociacaoDataCreditoAprovacao"
										value="#{faturaPagtoMB.negociacaoDataCredito}"
										pattern="dd/MM/yyyy" showWeeksBar="false"
										locale="#{lumeSecurity.locale}"
										timeZone="#{lumeSecurity.timeZone}" navigator="true"
										yearRange="-10:+10" disabled="#{!faturaPagtoMB.administrador}">
										<p:ajax event="dateSelect"
											listener="#{faturaPagtoMB.actionAlteraDataCreditoNegociacao}"
											update="negociacaoParcelasTable" process="@this" />
									</p:calendar>
									<p:outputLabel for="negociacaoDataCreditoAprovacao"
										value="Data de Crédito:" />
									<p:message for="negociacaoDataCreditoAprovacao"
										styleClass="msg" />
								</h:panelGroup>

								<p:dataTable emptyMessage="Nenhuma parcela criada ainda."
									id="negociacaoParcelasTable" filterDelay="1500" reflow="true"
									value="#{faturaPagtoMB.negociacaoParcelas}" var="parcela"
									rows="10" paginator="true" rowKey="#{parcela}"
									paginatorPosition="bottom"
									widgetVar="dtNegociacaoParcelasTable">
									<f:facet name="header">Lista de Parcelas a serem criadas</f:facet>
									<p:column filterBy="#{parcela.seq}" sortBy="#{parcela.seq}"
										filterMatchMode="contains" headerText="Nº" width="30">
										<h:outputText value="#{parcela.seq}" />
									</p:column>
									<p:column filterBy="#{parcela.valor}" sortBy="#{parcela.valor}"
										filterMatchMode="contains" headerText="Valor da Parcela">
										<h:outputText value="#{parcela.valor}">
											<f:convertNumber type="currency" currencySymbol="R$"
												maxFractionDigits="2" />
										</h:outputText>
									</p:column>
									<p:column filterBy="#{parcela.formaPagamento.produtoStr}"
										sortBy="#{parcela.formaPagamento.produtoStr}"
										filterMatchMode="contains" headerText="Forma de Pagamento">

										<p:selectOneMenu converter="tarifa"
											value="#{parcela.formaPagamento}">
											<f:selectItem itemValue="#{null}"
												itemLabel="Selecione uma Forma de Pagamento:" />
											<f:selectItems
												value="#{faturaPagtoMB.negociacaoTarifasDisponiveis}"
												var="tf" itemValue="#{tf}" itemLabel="#{tf.produtoStr}" />
											<p:ajax event="change" update="negociacaoParcelasTable"
												process="@this" />
										</p:selectOneMenu>

									</p:column>
									<p:column filterBy="#{parcela.dataPagamento}"
										sortBy="#{parcela.dataPagamento}" filterMatchMode="contains"
										headerText="Data de Pagamento">
										<p:calendar value="#{parcela.dataPagamento}"
											pattern="dd/MM/yyyy" showWeeksBar="false"
											locale="#{lumeSecurity.locale}"
											styleClass="listaLancamentoColunaDataPagamento"
											timeZone="#{lumeSecurity.timeZone}" navigator="true"
											yearRange="-10:+10">
											<p:ajax event="dateSelect" update="negociacaoParcelasTable"
												process="@this" />
										</p:calendar>
									</p:column>
									<p:column filterBy="#{parcela.dataCredito}"
										sortBy="#{parcela.dataCredito}" filterMatchMode="contains"
										headerText="Data de Crédito">
										<h:outputText value="#{parcela.dataCredito}">
											<f:convertDateTime pattern="dd/MM/yyyy" />
										</h:outputText>
									</p:column>
								</p:dataTable>

							</p:panelGrid>

						</p:outputPanel>

					</p:scrollPanel>
				</p:outputPanel>

				<p:separator styleClass="SeparatorFull" />

				<p:panelGrid columns="2" layout="grid"
					styleClass="ui-panelgrid-blank form-group ui-fluid removeSideGridPadding">

					<p:commandButton value="Confirmar Negociação"
						icon="White fa fa-save"
						actionListener="#{faturaPagtoMB.actionConfirmaNegociacao}"
						update="pnlfaturaView" process="@this, pnlNovaNegociacao"
						styleClass="GreenButton">
						<p:confirm header="Confirmação" icon="ui-icon-alert"
							escape="false"
							message="Você tem certeza que deseja aprovar esta negociação? &lt;br/&gt; Os lançamentos existentes serão substituidos pelos lançamentos novos de acordo com a negociação!">
						</p:confirm>
					</p:commandButton>
					<p:commandButton value="Fechar" icon="White fa fa-close"
						process="@this" oncomplete="PF('dlgAprovaNegociacao').hide()"
						styleClass="NavyButton" />

				</p:panelGrid>
			</div>
		</div>
	</p:dialog>

	<p:dialog id="faturaView" appendTo=":lume" widgetVar="dlgFaturaView"
		responsive="true" modal="true"
		onHide="PF('dlgFaturaView').toggleMaximize();onCloseFaturaView();"
		onShow="PF('dlgFaturaView').toggleMaximize();">
		<f:facet name="header">
			<p:outputPanel id="pnlfaturaViewHeader">
				<h:outputText
					value="Visualização da Fatura - #{faturaPagtoMB.entity.dataCriacaoStr}" />
			</p:outputPanel>
		</f:facet>
		<p:outputPanel
			style="max-height: calc(100% - 54px); height: calc(100% - 54px);">
			<p:scrollPanel mode="native"
				style="position: relative; width: calc(100% - 20px); height: calc(100% - 20px); padding: 10px;">
				<p:outputPanel id="pnlfaturaView">
					<div class="ui-g ui-fluid">
						<div class="ui-g-12 ui-lg-12">
							<p:panelGrid columns="4" layout="grid"
								columnClasses="ui-g-2, ui-g-4, ui-g-2, ui-g-4"
								styleClass="ui-panelgrid-blank ui-fluid form-group removeSideGridPadding">

								<h:outputText for="paciente" value="Paciente:" />
								<p:inputText id="paciente"
									value="#{faturaPagtoMB.entity.paciente.dadosBasico.nome}"
									readonly="true" />

								<h:outputText for="planoTratamentoDestaFatura"
									value="Plano de Tratamento:" />
								<p:inputText id="planoTratamentoDestaFatura"
									value="#{faturaPagtoMB.entity.dadosTabelaPT.descricao}"
									readonly="true" />

								<h:outputText for="dataCriacao" value="Data Criação:" />
								<p:inputText id="dataCriacao"
									value="#{faturaPagtoMB.entity.dataCriacaoStr}" readonly="true" />

								<h:outputText for="statusFatura" value="Status da Fatura:" />
								<p:outputLabel id="statusFatura"
									style="color: #{(faturaPagtoMB.entity.statusFatura.rotulo eq 'I' ? 'red' : 'black')}"
									value="#{faturaPagtoMB.entity.statusFaturaCompleto}"
									readonly="true" escape="false">
									<p:tooltip escape="false" for="@parent" position="bottom"
										value="#{faturaPagtoMB.entity.tooltipAlteracaoStatus}"
										hideDelay="500" />
								</p:outputLabel>

							</p:panelGrid>

							<p:panelGrid columns="5" layout="grid"
								columnClasses="ui-g-2, ui-g-2, ui-g-2, ui-g-2, ui-g-4"
								styleClass="ui-panelgrid-blank ui-fluid form-group removeSideGridPadding centerPanels lessPaddingSides">
								<p:panel id="valorPago">
									<f:facet name="header">
										<h:outputText value="Valor Recebido" />
										<h:outputLabel class="fa fa-question"
											id="tooltipValorRecebido"
											style="font-size:16px; margin-left:10px;" />
										<p:tooltip for="tooltipValorRecebido" style="max-width: 300px"
											escape="false"
											value="#{padroesTelaMB.getTooltipValue('faturaViewPaciente', 'valorRecebido')}"
											position="bottom" />
									</f:facet>
									<h:outputText
										value="#{faturaPagtoMB.entity.dadosTabelaTotalPagoFromPaciente}">
										<f:convertNumber currencySymbol="R$ " type="currency" />
									</h:outputText>
								</p:panel>
								<p:panel id="valorNaoPago">
									<f:facet name="header">
										<h:outputText value="Valor a Receber" />
										<h:outputLabel class="fa fa-question"
											id="tooltipValorAReceber"
											style="font-size:16px; margin-left:10px;" />
										<p:tooltip for="tooltipValorAReceber" style="max-width: 300px"
											escape="false"
											value="#{padroesTelaMB.getTooltipValue('faturaViewPaciente', 'valorAReceber')}"
											position="bottom" />
									</f:facet>
									<h:outputText
										value="#{faturaPagtoMB.entity.dadosTabelaTotalNaoPagoFromPaciente}">
										<f:convertNumber currencySymbol="R$ " type="currency" />
									</h:outputText>
								</p:panel>
								<p:panel id="valorDesconto">
									<f:facet name="header">
										<h:outputText value="Valor do Desconto" />
										<h:outputLabel class="fa fa-question"
											id="tooltipValorDesconto"
											style="font-size:16px; margin-left:10px;" />
										<p:tooltip for="tooltipValorDesconto" style="max-width: 300px"
											escape="false"
											value="#{padroesTelaMB.getTooltipValue('faturaViewPaciente', 'valorDesconto')}"
											position="bottom" />
									</f:facet>
									<h:outputText
										value="#{faturaPagtoMB.entity.dadosTabelaTotalDesconto}" />
								</p:panel>
								<p:panel id="valorTotal">
									<f:facet name="header">
										<h:outputText value="Valor Total" />
										<h:outputLabel class="fa fa-question" id="tooltipValorTotal"
											style="font-size:16px; margin-left:10px;" />
										<p:tooltip for="tooltipValorTotal" style="max-width: 300px"
											escape="false"
											value="#{padroesTelaMB.getTooltipValue('faturaViewPaciente', 'valorTotal')}"
											position="bottom" />
									</f:facet>
									<h:outputText
										value="#{faturaPagtoMB.entity.dadosTabelaRepasseTotalFatura}">
										<f:convertNumber currencySymbol="R$ " type="currency" />
									</h:outputText>
								</p:panel>
								<p:panel id="valorNaoPlanejado">
									<f:facet name="header">
										<h:outputText value="Sem Forma de Pagamento" />
										<h:outputLabel class="fa fa-question"
											id="tooltipValorNaoPlanejado"
											style="font-size:16px; margin-left:10px;" />
										<p:tooltip for="tooltipValorNaoPlanejado"
											style="max-width: 300px" escape="false"
											value="#{padroesTelaMB.getTooltipValue('faturaViewPaciente', 'valorNaoPlanejado')}"
											position="bottom" />
									</f:facet>
									<h:outputText
										value="#{faturaPagtoMB.entity.dadosTabelaRepasseTotalNaoPlanejado}">
										<f:convertNumber currencySymbol="R$ " type="currency" />
									</h:outputText>
								</p:panel>
							</p:panelGrid>

							<p:dataTable filterDelay="1500" reflow="true" emptyMessage=""
								value="#{faturaPagtoMB.entity.itensFiltered}" var="fi" rows="20"
								paginator="true" rowKey="#{fi}" paginatorPosition="bottom">
								<f:facet name="header">Itens</f:facet>

								<p:column sortBy="#{fi.descricaoItem}"
									filterMatchMode="contains" filterBy="#{fi.descricaoItem}"
									headerText="Descrição">
									<h:outputText value="#{fi.descricaoItem}" style="float:left" />
								</p:column>

								<p:column sortBy="#{fi.tipoSaldoStr}" filterMatchMode="contains"
									filterBy="#{fi.tipoSaldoStr}" headerText="Tipo do Saldo"
									width="150">
									<h:outputText value="#{fi.tipoSaldoStr}" />
								</p:column>

								<p:column sortBy="#{fi.valorItem}" filterMatchMode="contains"
									filterBy="#{fi.valorItem}" headerText="Valor" width="100">
									<h:outputText value="#{fi.valorItem}">
										<f:convertNumber currencySymbol="R$ " type="currency" />
									</h:outputText>
								</p:column>

								<p:column sortBy="#{fi.valorComDesconto}"
									filterMatchMode="contains" filterBy="#{fi.valorComDesconto}"
									headerText="Valor com desconto" width="100">
									<h:outputText value="#{fi.valorComDesconto}">
										<f:convertNumber currencySymbol="R$ " type="currency" />
									</h:outputText>
								</p:column>

							</p:dataTable>

							<p:separator styleClass="SeparatorFull" />

							<p:dataTable filterDelay="1500" reflow="true" emptyMessage=""
								value="#{faturaPagtoMB.entity.negociacoesFiltered}"
								var="negociacao" rows="20" paginator="true"
								rowKey="#{negociacao}" paginatorPosition="bottom">
								<f:facet name="header">Negociações</f:facet>

								<p:column headerText="Ações" style="width: 80px"
									styleClass="#{(negociacao.status.rotulo == 'AP' ? 'negociacaoAprovada' : 'negociacaoEmAndamento')}">
									<p:commandButton icon="fa fa-trash" styleClass="RedButton"
										process="@this"
										update="@parent:@parent:@parent:@parent:@parent:pnlfaturaView"
										title="Cancelar Negociação"
										actionListener="#{faturaPagtoMB.actionCancelaNegociacao(negociacao)}">
										<p:confirm header="Confirmação" icon="ui-icon-alert"
											escape="false"
											message="Você tem certeza que deseja cancelar esta negociação? &lt;br/&gt; &lt;b&gt;Se já foi aprovada&lt;/b&gt;, o desconto negociado será removido!">
										</p:confirm>
									</p:commandButton>
									<p:commandButton icon="fa fa-check" styleClass="GreenButton"
										process="@this" disabled="#{negociacao.status.rotulo != 'AA'}"
										update="@parent:@parent:@parent:@parent:@parent:@parent:@parent:@parent:pnlAprovaNegociacao"
										title="Confirmar Negociação"
										oncomplete="PF('dlgAprovaNegociacao').show()"
										actionListener="#{faturaPagtoMB.actionStartConfirmacaNegociacao(negociacao)}">
									</p:commandButton>
								</p:column>

								<p:column headerText="Negociado Por"
									styleClass="#{(negociacao.status.rotulo == 'AP' ? 'negociacaoAprovada' : 'negociacaoEmAndamento')}"
									sortBy="#{negociacao.negociadoPor.dadosBasico.nome}"
									filterBy="#{negociacao.negociadoPor.dadosBasico.nome}"
									filterMatchMode="contains">
									<h:outputText
										value="#{negociacao.negociadoPor.dadosBasico.nome}" />
								</p:column>

								<p:column headerText="Descrição"
									styleClass="#{(negociacao.status.rotulo == 'AP' ? 'negociacaoAprovada' : 'negociacaoEmAndamento')}"
									sortBy="#{negociacao.descricao}"
									filterBy="#{negociacao.descricao}" filterMatchMode="contains">
									<h:outputText value="#{negociacao.descricao}" />
								</p:column>

								<p:column headerText="Valor da Parcela"
									styleClass="#{(negociacao.status.rotulo == 'AP' ? 'negociacaoAprovada' : 'negociacaoEmAndamento')}"
									sortBy="#{negociacao.valorParcela}"
									filterBy="#{negociacao.valorParcela}"
									filterMatchMode="contains">
									<h:outputText value="#{negociacao.valorParcela}">
										<f:convertNumber currencySymbol="R$ " type="currency" />
									</h:outputText>
								</p:column>

								<p:column headerText="Valor Total"
									styleClass="#{(negociacao.status.rotulo == 'AP' ? 'negociacaoAprovada' : 'negociacaoEmAndamento')}"
									sortBy="#{negociacao.valorTotal}"
									filterBy="#{negociacao.valorTotal}" filterMatchMode="contains">
									<h:outputText value="#{negociacao.valorTotal}">
										<f:convertNumber currencySymbol="R$ " type="currency" />
									</h:outputText>
								</p:column>

								<p:column headerText="Valor do Desconto"
									styleClass="#{(negociacao.status.rotulo == 'AP' ? 'negociacaoAprovada' : 'negociacaoEmAndamento')}"
									sortBy="#{negociacao.valorDescontoCompleto}"
									filterBy="#{negociacao.valorDescontoCompleto}"
									filterMatchMode="contains">
									<h:outputText value="#{negociacao.valorDescontoCompleto}">
										<f:convertNumber currencySymbol="R$ " type="currency" />
									</h:outputText>
								</p:column>

								<p:column headerText="Valor Final"
									styleClass="#{(negociacao.status.rotulo == 'AP' ? 'negociacaoAprovada' : 'negociacaoEmAndamento')}"
									sortBy="#{negociacao.valorFinal}"
									filterBy="#{negociacao.valorFinal}" filterMatchMode="contains">
									<h:outputText value="#{negociacao.valorFinal}">
										<f:convertNumber currencySymbol="R$ " type="currency" />
									</h:outputText>
								</p:column>

							</p:dataTable>

							<p:separator styleClass="SeparatorFull" />

							<p:panel>
								<p:selectBooleanCheckbox styleClass="sideChkBox"
									itemLabel="Mostrar lançamentos cancelados."
									value="#{faturaPagtoMB.showLancamentosCancelados}">
									<p:ajax process="@this" update="lancamentosFatura" />
								</p:selectBooleanCheckbox>
							</p:panel>
							<br />
							<p:dataTable filterDelay="1500" reflow="true" emptyMessage=""
								value="#{faturaPagtoMB.lancamentos}" var="l" rows="20"
								paginator="true" rowKey="#{l}" paginatorPosition="bottom"
								id="lancamentosFatura">
								<f:facet name="header">Lançamentos da Fatura</f:facet>

								<p:column headerText="Ações" width="50" exportable="false"
									styleClass="#{(l.validado == 'C' ? 'lancamentoFalhaOperacao' : '')}"
									rendered="#{showNewLancamento != null and showNewLancamento == 'S' and faturaPagtoMB.permiteExcluirLancamento}">
									<p:commandButton styleClass="RedButton" icon="fa fa-trash"
										title="Cancelar lançamento"
										disabled="#{!l.ativo or l.validado == 'C' or faturaPagtoMB.entity.statusFatura.rotulo eq 'I'}"
										update="@parent:@parent:@parent:pnlfaturaView, @parent:@parent:@parent:buttonViewFatura"
										actionListener="#{faturaPagtoMB.cancelaLancamento(l)}"
										process="@this"
										rendered="#{showNewLancamento != null and showNewLancamento == 'S' and faturaPagtoMB.permiteExcluirLancamento}">
										<p:confirm header="Confirmação" icon="ui-icon-alert"
											escape="false"
											message="Você tem certeza que deseja cancelar este lançamento? &lt;br/&gt; &lt;b&gt;Se já foi confirmado&lt;/b&gt;, o saldo ficará disponível na &lt;b&gt;conta do paciente&lt;/b&gt;.">
										</p:confirm>
									</p:commandButton>
									<p:commandButton styleClass="OrangeButton" icon="fa fa-pencil"
										title="Editar lançamento"
										disabled="#{!l.ativo or l.validado != 'N' or l.pagamentoConferido == 'S'}"
										update="@parent:@parent:@parent:@parent:@parent:pnlEditarLancamento"
										actionListener="#{faturaPagtoMB.actionStartEditarLancamento(l)}"
										onsuccess="PF('dlgEditarLancamento').show()" process="@this"
										rendered="#{showNewLancamento != null and showNewLancamento == 'S' and faturaPagtoMB.permiteExcluirLancamento}">
									</p:commandButton>
									<p:commandButton styleClass="GreenButton" icon="fa fa-check"
										title="Recebido"
										update="@parent:@parent, @parent:@parent:@parent:pnlfaturaView"
										actionListener="#{faturaPagtoMB.confereLancamentoRepasse(l)}"
										process="@this"
										rendered="#{showNewLancamento != null and showNewLancamento == 'S'}"
										disabled="#{l.pagamentoConferido == 'S' or l.validado != 'N' or !l.ativo}">
										<p:confirm header="Confirmação" icon="ui-icon-alert"
											message="Você confirma este recebimento?">
										</p:confirm>
									</p:commandButton>
								</p:column>
								<p:column
									styleClass="#{(l.validado == 'C' ? 'lancamentoFalhaOperacao' : '')} cabecalho"
									width="10%"
									style="#{l != null and !l.ativo ? 'color: red' : ''}"
									filterBy="#{l.formaPagamentoStr}"
									headerText="Forma de Pagamento" sortBy="#{l.formaPagamentoStr}">
									<h:outputText value="#{l.formaPagamentoStr}" />
								</p:column>
								<p:column
									styleClass="#{(l.validado == 'C' ? 'lancamentoFalhaOperacao' : '')}"
									sortBy="#{l.valor}" filterMatchMode="contains"
									filterBy="#{l.valor}" headerText="Valor" width="10%"
									style="#{l != null and !l.ativo ? 'color: red' : ''}">
									<h:outputText value="#{l.valor}">
										<f:convertNumber currencySymbol="R$ " type="currency" />
									</h:outputText>
								</p:column>
								<p:column
									styleClass="#{(l.validado == 'C' ? 'lancamentoFalhaOperacao' : '')}"
									sortBy="#{l.tributo}" filterMatchMode="contains"
									filterBy="#{l.tributo}" headerText="Tributos" width="5%"
									style="#{l != null and !l.ativo ? 'color: red' : ''}">
									<h:outputText value="#{l.tributoPerc}">
										<f:convertNumber type="percent" maxFractionDigits="2" />
									</h:outputText>
									<h:outputText rendered="#{repasseProfissional == 'S'}"
										value="0%">
									</h:outputText>
								</p:column>
								<p:column
									styleClass="#{(l.validado == 'C' ? 'lancamentoFalhaOperacao' : '')}"
									sortBy="#{l.dataPagamentoStr}"
									style="#{l != null and !l.ativo ? 'color: red' : ''}"
									filterMatchMode="contains" filterBy="#{l.dataPagamentoStr}"
									width="10%" headerText="Data de Pagamento">
									<h:outputText value="#{l.dataPagamentoStr}" />
								</p:column>
								<p:column
									styleClass="#{(l.validado == 'C' ? 'lancamentoFalhaOperacao' : '')}"
									sortBy="#{l.dataCreditoStr}" filterMatchMode="contains"
									width="10%" filterBy="#{l.dataCreditoStr}"
									headerText="Data de Crédito"
									style="#{l != null and !l.ativo ? 'color: red' : ''}">
									<h:outputText value="#{l.dataCreditoStr}" />
								</p:column>
								<p:column
									styleClass="#{(l.validado == 'C' ? 'lancamentoFalhaOperacao' : '')}"
									sortBy="#{(l.validado == 'S' ? 'Sim' : 'Não')}" width="5%"
									filterMatchMode="contains"
									style="#{l != null and !l.ativo ? 'color: red' : ''}"
									filterBy="#{(l.validado == 'S' ? 'Sim' : 'Não')}"
									headerText="Validado?">
									<h:outputText value="#{(l.validado == 'S' ? 'Sim' : 'Não')}" />
								</p:column>
								<p:column
									styleClass="#{(l.validado == 'C' ? 'lancamentoFalhaOperacao' : '')}"
									sortBy="#{l.validadoPorProfissional.dadosBasico.nome}"
									filterMatchMode="contains" width="10%"
									style="#{l != null and !l.ativo ? 'color: red' : ''}"
									filterBy="#{l.validadoPorProfissional.dadosBasico.nome}"
									headerText="Validado Por">
									<h:outputText
										value="#{l.validadoPorProfissional.dadosBasico.nome}" />
								</p:column>
								<p:column
									styleClass="#{(l.validado == 'C' ? 'lancamentoFalhaOperacao' : '')}"
									headerText="Status" sortBy="#{l.statusCompleto}" width="15%"
									style="#{l != null and !l.ativo ? 'color: red' : ''}"
									filterMatchMode="contains" filterBy="#{l.statusCompleto}">
									<h:outputText value="#{l.statusCompleto}" />
								</p:column>
							</p:dataTable>

						</div>
					</div>
				</p:outputPanel>
			</p:scrollPanel>
		</p:outputPanel>
		<p:panelGrid columns="4" layout="grid" id="buttonViewFatura"
			styleClass="ui-panelgrid-blank form-group ui-fluid removeSideGridPadding">
			<p:commandButton value="Novo Lançamento" icon="fa fa-gear"
				process="@this" update="@parent:pnlNovoLancamento"
				styleClass="OrangeButton"
				rendered="#{showNewLancamento != null and showNewLancamento == 'S'}"
				disabled="#{(faturaPagtoMB.entity.dadosTabelaRepasseTotalNaoPlanejado le 0 or faturaPagtoMB.verificaFaturaInterrompida()) and false}"
				actionListener="#{faturaPagtoMB.actionNovoLancamentoNew}"
				oncomplete="PF('dlgNovoLancamento').show()" />
			<p:commandButton value="Nova Negociação" icon="fa fa-gear"
				process="@this" update="@parent:pnlNovaNegociacao"
				styleClass="RedButton"
				rendered="#{showNewLancamento != null and showNewLancamento == 'S'}"
				actionListener="#{faturaPagtoMB.actionNovaNegociacao}"
				oncomplete="PF('dlgNovaNegociacao').show()" />
			<p:commandButton value="Visualizar Impressão" icon="fa fa-print"
				styleClass="NavyButton" process="@this"
				oncomplete="PF('dlgPrintFatura').show()"
				update="@parent:@parent:faturaInclude" />
			<p:column
				rendered="#{showNewLancamento == null or showNewLancamento != 'S'}" />
			<p:column
				rendered="#{showNewLancamento == null or showNewLancamento != 'S'}" />
			<p:commandButton value="Fechar" icon="fa fa-close"
				styleClass="NavyButton" oncomplete="PF('dlgFaturaView').hide()"
				process="@this" />
		</p:panelGrid>
	</p:dialog>

	<p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
		<p:commandButton value="Sim" type="button"
			styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
		<p:commandButton value="Não" type="button"
			styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
	</p:confirmDialog>

	<p:outputPanel id="faturaInclude">
		<ui:include src="/templates/faturaImpressao.xhtml">
			<ui:param name="f" value="#{faturaPagtoMB.entity}" />
			<ui:param name="show"
				value="#{faturaPagtoMB.showLancamentosCancelados}" />
			<ui:param name="lancamentos" value="#{faturaPagtoMB.lancamentos}" />
		</ui:include>
	</p:outputPanel>


</ui:composition>