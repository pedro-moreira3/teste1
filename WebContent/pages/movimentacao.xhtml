<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" template="/WEB-INF/template.xhtml"
	xmlns:pe="http://primefaces.org/ui/extensions">
	<ui:define name="content">
		<div class="ui-g ui-fluid">
			<div class="ui-g-12 ui-lg-12">
				<div class="card card-w-title">

					<p:outputPanel id="pnMaterial" styleClass="BordNone">
						<h:inputHidden id="idMaterial" value="#{materialMB.entity.id}" />
						<h1>Movimentação de Materiais</h1>
						<div class="SeparatorFull"></div>
						<br />
						<p:dataTable filterDelay="1500" reflow="true" emptyMessage=""
							id="dtMaterial" value="#{materialMB.materiais}" var="material"
							rows="6" paginator="true" selection="#{materialMB.entity}"
							selectionMode="single" rowKey="#{material}"
							paginatorPosition="bottom">
							<p:ajax event="rowSelect" update=":lume:pnMaterial"
								listener="#{materialMB.carregaTela()}" />
							<f:facet name="header">Materiais</f:facet>
							<p:column filterBy="#{material.item.descricaoLimpa}"
								sortBy="#{material.item.descricao}" filterMatchMode="contains"
								headerText="Descrição">
								<h:outputText value="#{material.item.descricao}"
									title="#{material.id}" />
							</p:column>
							<p:column filterBy="#{material.estoque.quantidade}"
								sortBy="#{material.estoque.quantidade}" filterMatchMode="contains"
								headerText="Quantidade Atual">
								<h:outputText value="#{material.estoque.quantidade}">
									<f:convertNumber />
								</h:outputText>
								<h:outputText
									value="#{materialMB.getUnidadeString(material.item)}"
									styleClass="unidadeMedidaString" />
							</p:column>
							<p:column filterBy="#{material.marca.nome}"
								sortBy="#{material.marca.nome}" filterMatchMode="contains"
								headerText="Marca">
								<h:outputText value="#{material.marca.nome}" />
							</p:column>
							<p:column filterBy="#{material.lote}" sortBy="#{material.lote}"
								filterMatchMode="contains" headerText="Lote">
								<h:outputText value="#{material.lote}" />
							</p:column>
							<p:column filterBy="#{material.dataValidadeStr}"
								sortBy="#{material.validade}" filterMatchMode="contains"
								headerText="Validade">
								<h:outputText value="#{material.dataValidadeStr}" />
							</p:column>

							<p:column filterBy="#{material.estoque.local.descricao}"
								sortBy="#{material.estoque.local.descricao}" filterMatchMode="contains"
								headerText="Local">
								<h:outputText value="#{material.estoque.local.descricao}" />
							</p:column>

						</p:dataTable>

						<div class="EmptyBox20"></div>
						<p:panelGrid columns="2"
							columnClasses="ui-grid-col-2,ui-grid-col-10" layout="grid"
							styleClass="ui-panelgrid-blank"
							style="border:0px none; background-color:transparent;">
							<h:outputLabel value="Item: " />
							<h:outputLabel id="item" value="#{materialMB.item.descricao}" />

							<h:outputLabel value="Local Origem: " />
							<h:outputLabel id="localOrigem"
								value="#{materialMB.entity.estoque.local.descricao}" />

							<h:outputLabel value="Local Destino: " />
							<p:column>
								<p:autoComplete queryDelay="1000" id="digitacaoLocal"
									value="#{materialMB.digitacaoLocal}" minQueryLength="3"
									completeMethod="#{materialMB.filtraLocal}"
									styleClass="itembusca">
									<p:ajax event="itemSelect"
										listener="#{materialMB.handleSelectLocal}"
										update=":lume:tbLocalTree" />
								</p:autoComplete>
								<br />
								<br />
								<p:tree value="#{materialMB.rootLocal}" var="local"
									style="height:200px;" id="tbLocalTree"
									selection="#{materialMB.selectedLocal}" selectionMode="single">
									<p:ajax event="select"
										listener="#{materialMB.onNodeSelectLocal}"
										update=":lume:digitacaoLocal" process="@this" />
									<p:ajax event="unselect"
										listener="#{materialMB.onNodeUnselectLocal}" />
									<p:treeNode>
										<h:outputText value="#{local.descricao}" />
									</p:treeNode>
								</p:tree>
							</p:column>

							<p:outputLabel for="quantidadeMovimentada"
								value="Quantidade a ser movimentada: " />
							<p:column>
								<p:inputText id="quantidadeMovimentada"
									value="#{materialMB.quantidadeMovimentada}" maxlength="10"
									required="true" onkeypress="validaNumeros(event)" />
								<h:outputLabel
									value="#{materialMB.getUnidadeString(materialMB.item)}"
									styleClass="unidadeMedidaString" disabled="true"
									style="vertical-align: down;" />
							</p:column>

							<h:outputLabel value="Quantidade Atual: " />
							<p:column>
								<h:outputText id="quantidade"
									value="#{materialMB.entity.estoque.quantidade}" disabled="true"
									styleClass="Wid20">
									<f:convertNumber />
								</h:outputText>
								<h:outputText
									value="#{materialMB.getUnidadeString(materialMB.item)}"
									styleClass="unidadeMedidaString" />
							</p:column>

							<h:outputLabel value="Valor Unitário: " />
							<h:outputLabel id="valorUnitario"
								value="#{materialMB.entity.valor}" disabled="true">
								<f:convertNumber currencySymbol="R$" type="currency"
									locale="#{lumeSecurity.locale}" />
							</h:outputLabel>

							<h:outputLabel value="Marca: " />
							<h:outputLabel id="marca" value="#{materialMB.entity.marca.nome}"
								disabled="true" />

							<h:outputLabel value="Lote: " />
							<h:outputLabel id="lote" value="#{materialMB.entity.lote}"
								disabled="true" />


							<h:outputLabel value="Data de Cadastro: " />
							<h:outputLabel id="dataCadastro"
								value="#{materialMB.entity.dataCadastroStr}" disabled="true" />

							<h:outputLabel value="Data de Validade: " />
							<h:outputLabel id="dataValidade"
								value="#{materialMB.entity.dataValidadeStr}" disabled="true" />

							<h:outputLabel value="Data de Movimentação: " />
							<h:outputLabel id="dataMovimentacao"
								value="#{materialMB.entity.dataMovimentacaoStr}" disabled="true" />
						</p:panelGrid>
						<br />
						<div class="SeparatorFull"></div>
						<p:panelGrid columns="4" layout="grid"
							styleClass="ui-panelgrid-blank form-group ui-fluid">
							<p:commandButton id="persist" icon="White fa fa-exchange"
								value="Movimentar" actionListener="#{materialMB.movimentar}"
								update=":lume:pnMaterial,:lume:dtMaterial"
								process=":lume:pnMaterial"
								disabled="#{materialMB.entity.id == 0}" styleClass="GreenButton" />
						</p:panelGrid>
					</p:outputPanel>
				</div>
			</div>
		</div>
	</ui:define>
</ui:composition>