<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://primefaces.org/ui" template="/WEB-INF/template.xhtml" xmlns:pe="http://primefaces.org/ui/extensions">
    <ui:define name="content">
        <div class="ui-g ui-fluid">
			<div class="ui-g-12 ui-lg-12">
				<div class="card card-w-title">
                    <p:outputPanel styleClass="BordNone">
                        <h1>Devolução da Esterilização</h1>
                        <div class="SeparatorFull"></div>
                        <br />
                        <p:dataTable filterDelay="1500"  reflow="true" emptyMessage="" id="dtEsterilizacoesSolicitadas" value="#{esterilizacaoMB.esterilizacaoDataModel}" var="esterilizacaoSolicitada" rows="20"
                            paginator="true" selection="#{esterilizacaoMB.esterilizacaoSelecionadas}" rowKey="#{esterilizacaoSolicitada}" paginatorPosition="bottom">
                            <f:facet name="header">Esterilizações Solicitadas</f:facet>

                            <p:column selectionMode="multiple" style="width:16px;text-align:center" />

                            <p:ajax event="rowSelect" process="@this" update=":lume:dtKits, :lume:dtEsterilizacoesSolicitadas, :lume:devolucao, :lume:esterilizado, :lume:pnButton"
                                listener="#{esterilizacaoMB.habilitaDevolucao}" />
                            <p:ajax event="rowSelectCheckbox" process="@this" update=":lume:dtKits, :lume:dtEsterilizacoesSolicitadas, :lume:devolucao, :lume:esterilizado, :lume:pnButton"
                                listener="#{esterilizacaoMB.habilitaDevolucao}" />
                            <p:ajax event="rowUnselectCheckbox" process="@this" update=":lume:dtKits, :lume:dtEsterilizacoesSolicitadas, :lume:devolucao, :lume:esterilizado, :lume:pnButton"
                                listener="#{esterilizacaoMB.habilitaDevolucao}" />
                            <p:ajax event="toggleSelect" process="@this" update=":lume:dtKits, :lume:dtEsterilizacoesSolicitadas, :lume:devolucao, :lume:esterilizado, :lume:pnButton"
                                listener="#{esterilizacaoMB.habilitaDevolucao}" />


                            <p:column filterBy="#{esterilizacaoSolicitada.descricao}" sortBy="#{esterilizacaoSolicitada.descricao}" filterMatchMode="contains" headerText="Descrição">
                                <h:outputText value="#{esterilizacaoSolicitada.descricao}" title="#{esterilizacaoSolicitada.id}" />
                            </p:column>
                            <p:column filterBy="#{esterilizacaoSolicitada.observacao}" sortBy="#{esterilizacaoSolicitada.observacao}" filterMatchMode="contains" headerText="Observação">
                                <h:outputText value="#{esterilizacaoSolicitada.observacao}" />
                            </p:column>

                            <p:column filterBy="#{esterilizacaoSolicitada.solicitante.dadosBasico.prefixoNome}" sortBy="#{esterilizacaoSolicitada.solicitante.dadosBasico.prefixoNome}"
                                filterMatchMode="contains" headerText="Solicitante">
                                <h:outputText value="#{esterilizacaoSolicitada.solicitante.dadosBasico.prefixoNome}" />
                            </p:column>
                            <p:column filterBy="#{esterilizacaoSolicitada.profissional.dadosBasico.prefixoNome}" sortBy="#{esterilizacaoSolicitada.profissional.dadosBasico.prefixoNome}"
                                filterMatchMode="contains" headerText="Esterilizador">
                                <h:outputText value="#{esterilizacaoSolicitada.profissional.dadosBasico.prefixoNome}" />
                            </p:column>
                            <p:column filterBy="#{esterilizacaoSolicitada.status}" sortBy="#{esterilizacaoSolicitada.status}" filterMatchMode="contains" headerText="Status">
                                <h:outputText value="#{esterilizacaoSolicitada.status}" />
                            </p:column>

                            <p:column filterBy="#{esterilizacaoSolicitada.dataValidadeStr}" sortBy="#{esterilizacaoSolicitada.dataValidadeStr}" filterMatchMode="contains" headerText="Data de Validade">
                                <h:outputText value="#{esterilizacaoSolicitada.dataValidadeStr}" />
                            </p:column>
                            <p:column filterBy="#{esterilizacaoSolicitada.dataStr}" sortBy="#{esterilizacaoSolicitada.dataStrOrd}" filterMatchMode="contains" headerText="Data do Pedido">
                                <h:outputText value="#{esterilizacaoSolicitada.dataStr}" />
                            </p:column>
                            <p:column filterBy="#{esterilizacaoSolicitada.resumo}" sortBy="#{esterilizacaoSolicitada.resumo}" filterMatchMode="contains">
                                <f:facet name="header">
                                    <h:outputText value="Resumo" />
                                </f:facet>
                                <h:outputText value="#{esterilizacaoSolicitada.resumo}" />
                            </p:column>
                        </p:dataTable>
                        <h:panelGroup id="pnButton">
                        	<br />
                            <p:separator styleClass="SeparatorFull" />
                            <p:panelGrid columns="4" layout="grid" styleClass="ui-panelgrid-blank form-group ui-fluid">
                                <p:commandButton id="empacotado" icon="White fa fa-th-large" value="Empacotado" actionListener="#{esterilizacaoMB.actionEmpacotar}"
                                    disabled="#{!esterilizacaoMB.enableDevolucao}" update=":lume:dtKits, :lume:dtEsterilizacoesSolicitadas,:lume:pnButton" process=":lume:dtKits, @this" />
                                <p:commandButton id="esterilizado" icon="White fa fa-spinner" value="Em Esterilização" actionListener="#{esterilizacaoMB.actionEsterilizacao}"
                                    disabled="#{!esterilizacaoMB.enableDevolucao}" update=":lume:dtKits, :lume:dtEsterilizacoesSolicitadas,:lume:pnButton" process=":lume:dtKits, @this"
                                    styleClass="GreenButton" />
                                <p:commandButton id="devolucao" icon="White fa fa-sun-o" value="Esterilizado" actionListener="#{esterilizacaoMB.setaValidade}"
                                    disabled="#{!esterilizacaoMB.enableDevolucao}" update=":lume:dtKits,:lume:dtEsterilizacoesSolicitadas,:lume:pnButton" oncomplete="PF('esterilizar').show()"
                                    process=":lume:dtKits, @this" styleClass="OrangeButton">
                                </p:commandButton>
                            </p:panelGrid>
                        </h:panelGroup>
                        <p:dataTable filterDelay="1500"  reflow="true" emptyMessage="#{esterilizacaoMB.msg}" id="dtKits" selection="#{esterilizacaoMB.esterilizacaoKitSelecionada}" selectionMode="single"
                            value="#{esterilizacaoMB.kitsSolicitados}" rowKey="#{kit}" var="kit" rows="7" paginator="true" paginatorPosition="bottom">
                            <f:facet name="header">Detalhes</f:facet>
                            <p:ajax event="rowSelect" update=":lume:pnButton2" process=":lume:dtKits" />
                            <p:column filterBy="#{kit.kit.descricao}" sortBy="#{kit.kit.descricao}" filterMatchMode="contains" headerText="Kit">
                                <h:outputText value="#{kit.kit.descricao}" title="#{kit.id}" />
                            </p:column>
                            <p:column filterBy="#{kit.item.descricaoLimpa}" sortBy="#{kit.item.descricao}" filterMatchMode="contains" headerText="Item">
                                <h:outputText value="#{kit.item.descricao}" />
                            </p:column>
                            <p:column filterBy="#{kit.quantidade}" sortBy="#{kit.quantidade}" filterMatchMode="contains" headerText="Quantidade">
                                <h:outputText value="#{kit.quantidade}" />
                            </p:column>
                        </p:dataTable>
                        <br />
                        <h:panelGroup id="pnButton2">
                            <p:separator styleClass="SeparatorFull" />
                            <p:panelGrid columns="4" layout="grid" styleClass="ui-panelgrid-blank form-group ui-fluid">
                                <p:commandButton id="actionDescartar" icon="White fa fa-trash-o" value="Descartar" onclick="PF('descartar').show()"
                                    disabled="#{esterilizacaoMB.esterilizacaoKitSelecionada == null || esterilizacaoMB.esterilizacaoKitSelecionada.esterilizacao.clinica == false}"
                                    update=":lume:dtKits, :lume:dtEsterilizacoesSolicitadas,:lume:pnButton2" process=":lume:dtKits, @this" styleClass="RedButton">
                                    <p:confirm header="Confirmação" message="Este item será retirado do estoque, deseja confirmar?" icon="ui-icon-alert" />
                                </p:commandButton>
                            </p:panelGrid>
                            <div class="EmptyBox20"></div>
                        </h:panelGroup>
                        
                        <p:dialog id="descartar" widgetVar="descartar" header="Descartar" responsive="true" modal="true">
                            <p:outputPanel id="pnDescartar" styleClass="BordNone">
                                <h:panelGroup styleClass="lumeField" id="pnJustificativaDescarte">
                                    <p:outputLabel for="quantidadeDescarte" value="Quantidade descartada : " />
                                    <p:inputText id="quantidadeDescarte" required="true" value="#{esterilizacaoMB.quantidadeDescarte}">
                                        <f:validateLongRange minimum="1" />
                                    </p:inputText>
                                    <p:message for="quantidadeDescarte" styleClass="msg" />
                                </h:panelGroup>
                                <h:panelGroup styleClass="lumeField">
                                    <p:outputLabel for="justificativa" value="Justificativa : " />
                                    <p:selectOneMenu id="justificativa" required="true" value="#{esterilizacaoMB.justificativa}" converter="dominio">
                                        <f:selectItem itemValue="#{null}" itemLabel="Selecione uma justificativa" />
                                        <f:selectItems value="#{esterilizacaoMB.justificativas}" var="justificativa" itemLabel="#{justificativa.nome}" itemValue="#{justificativa}" />
                                    </p:selectOneMenu>
                                    <p:message for="justificativa" styleClass="msg" />
                                </h:panelGroup>
                                <p:separator styleClass="SeparatorFull" />
                                <p:panelGrid columns="1" layout="grid" styleClass="ui-panelgrid-blank form-group ui-fluid">
                                    <p:commandButton id="persistDescartar" icon="White fa fa-save" value="Salvar" actionListener="#{esterilizacaoMB.actionDescarte}"
                                        update=":lume:quantidadeDescarte, :lume:justificativa,:lume:dtKits, :lume:dtEsterilizacoesSolicitadas,:lume:pnButton, :lume:pnDescartar"
                                        process=":lume:quantidadeDescarte, :lume:justificativa,:lume:dtKits, @this, :lume:pnDescartar" oncomplete="handleDialogRequest(xhr, status, args)"
                                        styleClass="GreenButton" />
                                </p:panelGrid>
                        	</p:outputPanel>
                        </p:dialog>
                        <p:dialog id="esterilizar" widgetVar="esterilizar" header="Esterilizado" responsive="true" modal="true">
                            <p:outputPanel styleClass="BordNone">
                                <h:panelGroup styleClass="lumeField" id="pnJustificativa">
                                    <p:outputLabel for="validade" value="Validade : " />
                                    <p:calendar id="validade" value="#{esterilizacaoMB.dataValidade}" required="true" pattern="dd/MM/yyyy" showWeeksBar="false" locale="#{lumeSecurity.locale}"
                                        mindate="#{esterilizacaoMB.dataAtual}" timeZone="#{lumeSecurity.timeZone}" navigator="true" yearRange="-0:+1" mask="true" />
                                    <p:message for="validade" styleClass="msg" />
                                </h:panelGroup>
                                <p:separator styleClass="SeparatorFull" />
                                <p:panelGrid columns="1" layout="grid" styleClass="ui-panelgrid-blank form-group ui-fluid">
                                    <p:commandButton id="persistDevolver" icon="White fa fa-save" value="Salvar" actionListener="#{esterilizacaoMB.actionDevolucao}"
                                        update=":lume:validade ,:lume:dtKits, :lume:dtEsterilizacoesSolicitadas,:lume:pnButton" process=":lume:validade,:lume:dtKits, @this"
                                        oncomplete="handleDialogRequest(xhr, status, args)" styleClass="GreenButton" />
                                </p:panelGrid>
                            </p:outputPanel>
                        </p:dialog>


                        <script type="text/javascript">
																									function handleDialogRequest(xhr, status, args) {
																										if (args.esterilizar == true) {
																											PF('esterilizar').hide();
																										}
																										if (args.descartar == true) {
																											PF('descartar').hide();
																										}

																									}
																								</script>
                    </p:outputPanel>
                </div>
            </div>
        </div>
    </ui:define>
</ui:composition>