<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:ui="http://java.sun.com/jsf/facelets">

	<p:outputPanel id="mainViewAnamnese">
		<p:panelGrid columns="2" layout="grid" id="botoesControleTbAnamnese"
			styleClass="ui-panelgrid-blank form-group ui-fluid removeSideGridPadding">
			<p:commandButton id="newAnamnese" icon="ui-icon-add" value="Novo"
				actionListener="#{pacienteMB.actionAnamneseNew}"
				update=":lume:tabView:anamneseDoPaciente, :lume:tabView:dtAnamnese"
				process="@this" oncomplete="PF('dlgAnamnesePaciente').show();" />
			<p:commandButton id="deleteAnamnese" icon="White fa fa-trash-o White"
				value="Excluir" actionListener="#{pacienteMB.actionAnamneseRemove}"
				update=":lume:tabView:anamneseDoPaciente, :lume:tabView:dtAnamnese"
				process="@this" disabled="#{pacienteMB.pacienteAnamnese.id == null}"
				rendered="#{pacienteMB.admin}" styleClass="RedButton" />
		</p:panelGrid>

		<h:panelGroup id="dtAnamnese">
			<p:dataTable filterDelay="1500" reflow="true" emptyMessage=""
				value="#{pacienteMB.pacienteAnamneses}" var="pacienteAnamnese"
				rows="10" paginator="true"
				selection="#{pacienteMB.pacienteAnamnese}" selectionMode="single"
				rowKey="#{pacienteAnamnese}" paginatorPosition="bottom">
				<p:ajax event="rowSelect"
					update=":lume:tabView:pnPrincipalAnamnese, :lume:tabView:botoesControleTbAnamnese" />
				<f:facet name="header">Anamneses</f:facet>
				<p:column headerText="Visualização" style="width:100px">
					<p:commandButton styleClass="NavyButton" icon="fa fa-search"
						actionListener="#{pacienteMB.setPacienteAnamnese(pacienteAnamnese)}"
						oncomplete="PF('dlgAnamnesePaciente').show();" process="@this"
						title="Visualizar Anamnese"
						update=":lume:tabView:anamneseDoPaciente, :lume:tabView:pnPrincipalAnamnese, :lume:tabView:mainViewAnamnese">
					</p:commandButton>
				</p:column>
				<p:column filterBy="#{pacienteAnamnese.id}"
					sortBy="#{pacienteAnamnese.id}" filterMatchMode="contains"
					headerText="ID">
					<h:outputText value="#{pacienteAnamnese.id}"
						title="#{pacienteAnamnese.id}" />
				</p:column>
				<p:column
					filterBy="#{pacienteAnamnese.profissional.dadosBasico.prefixoNome}"
					sortBy="#{pacienteAnamnese.profissional.dadosBasico.prefixoNome}"
					filterMatchMode="contains" headerText="Profissional">
					<h:outputText
						value="#{pacienteAnamnese.profissional.dadosBasico.prefixoNome}"
						rendered="#{pacienteAnamnese.profissional != null}" />
					<h:outputText value="#{dominioMB.cliente} via Web"
						rendered="#{pacienteAnamnese.profissional == null}" />
				</p:column>
				<p:column filterBy="#{pacienteAnamnese.dataHoraStr}"
					sortBy="#{pacienteAnamnese.dataHoraStrOrd}"
					filterMatchMode="contains" headerText="Data/Hora">
					<h:outputText value="#{pacienteAnamnese.dataHoraStr}" />
				</p:column>
				<p:column filterBy="#{pacienteAnamnese.especialidades}"
					sortBy="#{pacienteAnamnese.especialidades}"
					filterMatchMode="contains" headerText="Especialidades">
					<h:outputText value="#{pacienteAnamnese.especialidades}" />
				</p:column>
			</p:dataTable>
		</h:panelGroup>
	</p:outputPanel>

	<p:dialog widgetVar="dlgAnamnesePaciente" appendTo=":lume"
		onHide="PF('dlgAnamnesePaciente').toggleMaximize();"
		onShow="PF('dlgAnamnesePaciente').toggleMaximize();"
		header="Anamnese do Paciente #{pacienteMB.entity.dadosBasico.nome}"
		id="anamneseDoPaciente" resizable="false" modal="true">
		<p:outputPanel id="pnPrincipalAnamnese"
			style="max-height: calc(100% - 54px); height: calc(100% - 54px);">
			<p:scrollPanel mode="native" style="width: 100%; height: 100%;">

				<div class="ui-g ui-fluid">
					<div class="ui-g-12 ui-lg-12">
						<h1 style="margin-top: 20px !important;">Especialidades</h1>
						<p:separator styleClass="SeparatorFull" />
						<p:selectManyCheckbox id="especialidade"
							value="#{pacienteMB.especialidadeSelecionada}"
							converter="especialidade" layout="grid" columns="5">
							<f:selectItems value="#{pacienteMB.especialidades}" var="e"
								itemValue="#{e}" itemLabel="#{e.descricao}" />
							<p:ajax
								listener="#{pacienteMB.actionAtualizaPerguntasPorAnamnese}"
								process="@this" update=":lume:tabView:perguntasEspecialidade" />
						</p:selectManyCheckbox>
						<p:separator styleClass="SeparatorFull" />

						<h:panelGroup id="perguntasEspecialidade">
							<ui:repeat var="anamnesesAgrupadas"
								value="#{pacienteMB.anamneses}">
								<p:fieldset legend="#{anamnesesAgrupadas[0].especialidade}">
									<ui:repeat var="anamnese" value="#{anamnesesAgrupadas}">
										<p:panelGrid columns="2" layout="grid"
											styleClass="ui-panelgrid-blank"
											columnClasses="ui-grid-col-4,ui-grid-col-8"
											style="border:0px none; background-color:transparent;">
											<p:column>
												<p:outputLabel for="texte"
													value="#{anamnese.pergunta.descricao}"
													rendered="#{anamnese.pergunta.tipoResposta == anamnese.pergunta.tipoRespostaTexto}" />
											</p:column>
											<p:column>
												<p:inputText id="texte" value="#{anamnese.resposta}"
													disabled="#{pacienteMB.readonly}"
													required="#{anamnese.pergunta.requerida}"
													requiredMessage="#{anamnese.pergunta.descricao} é obrigatório"
													rendered="#{anamnese.pergunta.tipoResposta == anamnese.pergunta.tipoRespostaTexto}" />
											</p:column>
										</p:panelGrid>

										<p:panelGrid columns="2" layout="grid"
											styleClass="ui-panelgrid-blank"
											columnClasses="ui-grid-col-4,ui-grid-col-8"
											style="border:0px none; background-color:transparent;">
											<p:outputLabel for="onMenu"
												value="#{anamnese.pergunta.descricao}"
												rendered="#{anamnese.pergunta.tipoResposta == anamnese.pergunta.tipoRespostaUmaEmVarias}" />
											<p:selectOneMenu id="onMenu" value="#{anamnese.resposta}"
												style="width: 340px;" converter="resposta"
												disabled="#{pacienteMB.readonly}"
												required="#{anamnese.pergunta.requerida}"
												requiredMessage="#{anamnese.pergunta.descricao} é obrigatório"
												rendered="#{anamnese.pergunta.tipoResposta == anamnese.pergunta.tipoRespostaUmaEmVarias}">
												<f:selectItem itemValue="#{null}"
													itemLabel="Selecione uma opção" />
												<f:selectItems value="#{anamnese.pergunta.respostas}"
													var="resposta" itemLabel="#{resposta.descricao}"
													itemValue="#{resposta.descricao}" />
											</p:selectOneMenu>
										</p:panelGrid>

										<p:panelGrid columns="2" layout="grid"
											styleClass="ui-panelgrid-blank"
											columnClasses="ui-grid-col-4,ui-grid-col-8"
											style="border:0px none; background-color:transparent;">
											<p:outputLabel for="checkBox"
												value="#{anamnese.pergunta.descricao}"
												rendered="#{anamnese.pergunta.tipoResposta == anamnese.pergunta.tipoRespostaVariasEmVarias}" />
											<p:selectManyCheckbox id="checkBox"
												value="#{anamnese.respostas}"
												disabled="#{pacienteMB.readonly}"
												required="#{anamnese.pergunta.requerida}"
												requiredMessage="#{anamnese.pergunta.descricao} é obrigatório"
												rendered="#{anamnese.pergunta.tipoResposta == anamnese.pergunta.tipoRespostaVariasEmVarias}"
												layout="responsive" columns="3">
												<f:selectItems value="#{anamnese.pergunta.respostas}"
													var="resposta" itemLabel="#{resposta.descricao}"
													itemValue="#{resposta.descricao}" />
											</p:selectManyCheckbox>
										</p:panelGrid>

										<p:panelGrid columns="2" layout="grid"
											styleClass="ui-panelgrid-blank"
											columnClasses="ui-grid-col-4,ui-grid-col-8"
											style="border:0px none; background-color:transparent;">
											<p:outputLabel for="onRadio"
												value="#{anamnese.pergunta.descricao}"
												rendered="#{anamnese.pergunta.tipoResposta == anamnese.pergunta.tipoRespostaSimOuNao}" />
											<p:selectOneRadio id="onRadio" value="#{anamnese.resposta}"
												disabled="#{pacienteMB.readonly}"
												required="#{anamnese.pergunta.requerida}"
												requiredMessage="#{anamnese.pergunta.descricao} é obrigatório"
												rendered="#{anamnese.pergunta.tipoResposta == anamnese.pergunta.tipoRespostaSimOuNao}">
												<f:selectItem itemLabel="Sim" itemValue="Sim" />
												<f:selectItem itemLabel="Não" itemValue="Não" />
											</p:selectOneRadio>
										</p:panelGrid>

										<p:panelGrid columns="2" layout="grid"
											styleClass="ui-panelgrid-blank"
											columnClasses="ui-grid-col-4,ui-grid-col-8"
											style="border:0px none; background-color:transparent;">
											<p:outputLabel for="numero"
												value="#{anamnese.pergunta.descricao}"
												rendered="#{anamnese.pergunta.tipoResposta == anamnese.pergunta.tipoRespostaQuantidade}" />
											<p:inputText value="#{anamnese.resposta}"
												style="width: 340px;" disabled="#{pacienteMB.readonly}"
												validatorMessage="Favor digitar um número." id="numero"
												required="#{anamnese.pergunta.requerida}"
												requiredMessage="#{anamnese.pergunta.descricao} é obrigatório"
												rendered="#{anamnese.pergunta.tipoResposta == anamnese.pergunta.tipoRespostaQuantidade}">
												<f:validateRegex pattern="[0-9]*" />
											</p:inputText>
										</p:panelGrid>
									</ui:repeat>
								</p:fieldset>
								<br />
							</ui:repeat>
						</h:panelGroup>
					</div>
				</div>

			</p:scrollPanel>
		</p:outputPanel>
		<p:panelGrid columns="2" layout="grid"
			styleClass="ui-panelgrid-blank form-group ui-fluid removeSideGridPadding">
			<p:commandButton icon="fa fa-close" value="Fechar" process="@this"
				oncomplete="PF('dlgAnamnesePaciente').hide()" />
			<p:commandButton id="persistAnamnese" icon="White fa fa-save White"
				value="Salvar" actionListener="#{pacienteMB.actionAnamnesePersist}"
				update=":lume:tabView:anamneseDoPaciente, :lume:tabView:dtAnamnese"
				process=":lume:tabView:anamneseDoPaciente"
				disabled="#{pacienteMB.readonly}" styleClass="GreenButton" />
		</p:panelGrid>
	</p:dialog>

</ui:composition>