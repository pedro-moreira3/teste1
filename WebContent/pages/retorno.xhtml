<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://primefaces.org/ui" template="/WEB-INF/template.xhtml" xmlns:pe="http://primefaces.org/ui/extensions">
    <ui:define name="content">
        <style>
.ui-fluid .ui-calendar, .ui-fluid .ui-calendar input {
    width: auto !important;
}
</style>

        <div class="Container100 Responsive100 NoIndent">
            <div class="Container100 ui-fluid NoPadding">
                <div class="Card">
                    <h:inputHidden id="idRetorno" value="#{retornoMB.entity.id}" />
                    <p:panel styleClass="BordNone">

                        <h1 class="CardBigTopic" id="titulo">Retorno</h1>
                        <div class="SeparatorFull"></div>


                    </p:panel>
                    <p:panel id="pnRetorno" styleClass="BordNone">
                        <p:panelGrid columns="4" columnClasses="ui-grid-col-2,ui-grid-col-4,ui-grid-col-2,ui-grid-col-4" layout="grid" styleClass="ui-panelgrid-blank"
                            style="border:0px none; background-color:transparent;">
                            <h:outputLabel value="Paciente : " />
                            <p:autoComplete dropdown="true" queryDelay="1000" minQueryLength="3" value="#{retornoMB.entity.paciente}" completeMethod="#{retornoMB.geraSugestoesPaciente}" var="p"
                                itemLabel="#{p.dadosBasico.nomeDocumento}" itemValue="#{p}" converter="paciente" required="true" size="46" scrollHeight="400"
                                disabled="#{retornoMB.entity.paciente != null}">
                            </p:autoComplete>

                            <h:outputLabel value="Status : " />
                            <p:selectOneMenu value="#{retornoMB.entity.retornar}">
                                <f:selectItem itemLabel="Pendente" itemValue="P" />
                                <f:selectItem itemLabel="Agendado" itemValue="A" />
                                <f:selectItem itemLabel="Cancelado" itemValue="C" />
                            </p:selectOneMenu>

                            <p:outputLabel value="Data Contato : " for="dtContato" />
                            <p:calendar id="dtContato" required="true" value="#{retornoMB.entity.dataRetorno}" pattern="dd/MM/yyyy" mask="true" showWeeksBar="false" locale="#{lumeSecurity.locale}"
                                timeZone="#{lumeSecurity.timeZone}" navigator="true" yearRange="-100:+1" class="Wid20" />

                            <p:outputLabel for="observacoesretornocadastro" value="Observações : " />
                            <p:inputTextarea id="observacoesretornocadastro" rows="3" cols="33" value="#{retornoMB.entity.observacoes}" maxlength="200" />

                            <h:outputLabel value="Plano de Tratamento : " />
                            <h:outputText value="#{retornoMB.entity.planoTratamento.descricao}" />

                            <h:outputLabel value="Data Finalização Plano de Tratamento : " />
                            <h:outputText value="#{retornoMB.entity.planoTratamento.dataFinalizadoStr}" />


                        </p:panelGrid>

                        <div class="SeparatorFull"></div>
                        <div class="Container25 Responsive100">
                            <p:commandButton icon="White fa fa-save" value="Salvar" actionListener="#{retornoMB.actionPersist}" update=":lume:pnRetorno,:lume:dtRetorno" process=":lume:pnRetorno"
                                styleClass="GreenButton" />
                        </div>
                        <div class="Container25 Responsive100">
                            <p:commandButton icon="White fa fa-trash-o" value="Excluir" actionListener="#{retornoMB.actionRemove}" update=":lume:pnRetorno,:lume:dtRetorno" process="@this"
                                disabled="#{retornoMB.entity.id == 0}" styleClass="RedButton" />
                        </div>

                        <div class="Container25 Responsive100">
                            <p:commandButton icon="White fa fa-file-o" value="Novo" actionListener="#{retornoMB.actionNew}" update=":lume:pnRetorno,:lume:dtRetorno" immediate="true" />
                        </div>

                        <div class="EmptyBox20"></div>

                    </p:panel>

                    <p:dataTable filterDelay="1500" reflow="true" emptyMessage="" id="dtRetorno" value="#{retornoMB.retornos}" var="retorno" rows="15" paginator="true" selection="#{retornoMB.entity}"
                        selectionMode="single" rowKey="#{retorno}" paginatorPosition="bottom">
                        <p:ajax event="rowSelect" update=":lume:pnRetorno" />
                        <f:facet name="header">
                            <h:panelGroup id="filtro">
                                <p:calendar value="#{retornoMB.dataIni}" pattern="dd/MM/yyyy" mask="true" showWeeksBar="false" locale="#{lumeSecurity.locale}" timeZone="#{lumeSecurity.timeZone}"
                                    navigator="true" yearRange="-100:+1" style="width: 95px !important;margin-right: 5px;" /> até
								<p:calendar value="#{retornoMB.dataFim}" pattern="dd/MM/yyyy" mask="true" showWeeksBar="false" locale="#{lumeSecurity.locale}" timeZone="#{lumeSecurity.timeZone}" navigator="true"
                                    yearRange="-100:+1" style="width: 95px !important;margin-left: 5px;" />
                                <p:commandButton id="pesquisar" icon="fa fa-search White" actionListener="#{retornoMB.geraLista}" update="@form" tabindex="1" process=":lume:dtRetorno:filtro"
                                    styleClass="OrangeButton" style="margin-left: 10px;" />
                            </h:panelGroup>
                        </f:facet>
                        <p:column filterBy="#{retorno.paciente.dadosBasico.nomeStr}" sortBy="#{retorno.paciente.dadosBasico.nome}" filterMatchMode="contains" headerText="Paciente">
                            <h:outputText value="#{retorno.paciente.dadosBasico.nome}" title="#{retorno.id}" />
                        </p:column>
                        <p:column filterBy="#{retorno.paciente.dadosBasico.telefoneStr}" sortBy="#{retorno.paciente.dadosBasico.telefoneStr}" filterMatchMode="contains" headerText="Telefone">
                            <h:outputText value="#{retorno.paciente.dadosBasico.telefoneStr}" />
                        </p:column>
                        <p:column headerText="Agendar" width="50">
                            <p:commandButton icon="White fa fa-book White" oncomplete="PF('eventDialog').show();resize('#lume\\:pnAgendamento');" process="@this"
                                action="#{agendamentoMB.retorno(retorno)}" update="lume:pnAgendamento" />
                        </p:column>
                        <p:column headerText="Whats" width="50">
                            <p:button id="whats" icon="White fa fa-whatsapp" onclick="window.open('#{retorno.whatsURL}');return false;" styleClass="GreenButton" disable="#{a.whatsURL == null}" />
                        </p:column>

                        <p:column filterBy="#{retorno.paciente.convenio.dadosBasico.nome}" sortBy="#{retorno.paciente.convenio.dadosBasico.nome}" filterMatchMode="contains" headerText="Convênio">
                            <h:outputText value="#{retorno.paciente.convenio.dadosBasico.nome}" />
                        </p:column>

                        <p:column filterBy="#{retorno.observacoes}" sortBy="#{retorno.observacoes}" filterMatchMode="contains" headerText="Observações">
                            <h:outputText value="#{retorno.observacoes}" />
                        </p:column>

                        <p:column filterBy="#{retorno.dataRetornoStr}" sortBy="#{retorno.dataRetornoStrOrd}" filterMatchMode="contains" headerText="Data Contato">
                            <h:outputText value="#{retorno.dataRetornoStr}" />
                        </p:column>

                        <p:column filterBy="#{retorno.retornar}" sortBy="#{retorno.retornar}" filterMatchMode="contains" headerText="Status">
                            <p:selectOneMenu value="#{retorno.retornar}">
                                <p:ajax process="@this" listener="#{retornoMB.persistRetorno(retorno)}" />
                                <f:selectItem itemLabel="Pendente" itemValue="P" />
                                <f:selectItem itemLabel="Agendado" itemValue="A" />
                                <f:selectItem itemLabel="Cancelado" itemValue="C" />
                            </p:selectOneMenu>
                        </p:column>


                        <p:column filterBy="#{retorno.paciente.dadosBasico.responsavel}" sortBy="#{retorno.paciente.dadosBasico.responsavel}" filterMatchMode="contains" headerText="Responsável">
                            <h:outputText value="#{retorno.paciente.dadosBasico.responsavel} #{retorno.paciente.dadosBasico.telefoneResponsavel}" />
                        </p:column>


                        <p:column filterBy="#{retorno.agendamento.dataAgendamentoStr}" sortBy="#{retorno.agendamento.dataAgendamento}" filterMatchMode="contains" headerText="Agendamento">
                            <h:outputText value="#{retorno.agendamento.profissional.dadosBasico.nome}" style="width:100%;display: block;" />
                            <h:outputText value="#{retorno.agendamento.dataAgendamentoStr}" />
                        </p:column>

                    </p:dataTable>

                </div>
            </div>
        </div>
        <p:remoteCommand id="btBloqueioAgenda" name="btBloqueioAgenda" actionListener="#{retornoMB.geraLista}" update="@form" process="@this" />

        <p:dialog widgetVar="eventDialog" header="Agendamento" resizable="false" id="pnAgendamento" responsive="true" position="10,10" modal="true" style="position:absolute !important;"
            appendToBody="true">

            <div class="Container100 Responsive100 NoIndent">
                <div class="Container100 ui-fluid NoPadding">
                    <div class="Card" style="margin-top: -35px">


                        <ui:include src="dlgagendamento.xhtml" />


                        <p:separator />

                        <h:panelGroup id="botoesAgenda">

                            <h:panelGroup rendered="#{agendamentoMB.habilitaSalvar}">
                                <div class="Container25 Responsive100">
                                    <p:commandButton id="persist" icon="White fa fa-save" process="pnAgendamento" value="Salvar" actionListener="#{agendamentoMB.actionPersist}"
                                        oncomplete="btBloqueioAgenda();PF('eventDialog').hide();" styleClass="GreenButton" />
                                </div>
                            </h:panelGroup>
                            <div class="Container25 Responsive100">
                                <p:commandButton icon="White fa fa-close" value="Fechar" process="@this" onclick="PF('eventDialog').hide()" />
                            </div>
                        </h:panelGroup>
                    </div>
                </div>
            </div>
        </p:dialog>
    </ui:define>
</ui:composition>