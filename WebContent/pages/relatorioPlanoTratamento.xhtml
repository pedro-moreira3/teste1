<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://primefaces.org/ui" template="/WEB-INF/template.xhtml" xmlns:pe="http://primefaces.org/ui/extensions">
    <ui:define name="content">
        <style>
.ui-fluid .ui-calendar, .ui-fluid .ui-calendar input {
    width: auto !important;
}

.Blue {
    color: #1e739e !important;
}

.ui-grid-col-4 {
    text-align: center;
}
</style>
        <div class="Container100 Responsive100 NoIndent">
            <div class="Container100 ui-fluid NoPadding">
                <div class="Card">
                    <p:panel id="pnPrincipal" styleClass="BordNone">

                        <h1 class="CardBigTopic">Relatório de Planos de Tratamento</h1>
                        <div class="SeparatorFull"></div>

                        <p:panelGrid id="filtro" columns="2" columnClasses="ui-grid-col-4,ui-grid-col-8" layout="grid" styleClass="ui-panelgrid-blank"
                            style="border:0px none; background-color:transparent;">

                            <p:outputLabel value="Período: " />

                            <h:panelGroup>
                                <p:calendar value="#{relatorioPlanoTratamentoMB.inicio}" pattern="dd/MM/yyyy" mask="true" showWeeksBar="false" locale="#{lumeSecurity.locale}"
                                    timeZone="#{lumeSecurity.timeZone}" navigator="true" yearRange="-100:+1" style="width: 95px !important;margin-right: 5px;" />

                                <p:outputLabel value="até" style="margin-right: 10px;margin-left: 10px;" />

                                <p:calendar value="#{relatorioPlanoTratamentoMB.fim}" pattern="dd/MM/yyyy" mask="true" showWeeksBar="false" locale="#{lumeSecurity.locale}"
                                    timeZone="#{lumeSecurity.timeZone}" navigator="true" yearRange="-100:+1" />
                            </h:panelGroup>

                            <p:outputLabel value="Filtro Período: " />

                            <p:selectOneMenu value="#{relatorioPlanoTratamentoMB.filtroPeriodo}" styleClass="Wid30">
                                <p:ajax process="@this" update="@form" listener="#{relatorioPlanoTratamentoMB.actionTrocaDatas}" />
                                <f:selectItem itemValue="O" itemLabel="Ontem" />
                                <f:selectItem itemValue="H" itemLabel="Hoje" />
                                <f:selectItem itemValue="M" itemLabel="Mês Atual" />
                                <f:selectItem itemValue="S" itemLabel="Últimos 7 dias" />
                                <f:selectItem itemValue="Q" itemLabel="Últimos 15 dias" />
                                <f:selectItem itemValue="T" itemLabel="Últimos 30 dias" />
                                <f:selectItem itemValue="I" itemLabel="Últimos 6 meses" />
                            </p:selectOneMenu>

                            <p:outputLabel value="Finalizado? : " />

                            <p:selectOneRadio value="#{relatorioPlanoTratamentoMB.status}" styleClass="Wid20">
                                <f:selectItem itemValue="S" itemLabel="Sim" />
                                <f:selectItem itemValue="N" itemLabel="Não" />
                            </p:selectOneRadio>

                        </p:panelGrid>

                        <div class="EmptyBox5"></div>

                        <div class="SeparatorFull"></div>

                        <div class="Container25 Responsive100">
                            <p:commandButton id="pesquisar" icon="fa fa-search White" value="Pesquisar" actionListener="#{relatorioPlanoTratamentoMB.actionFiltrar}" update="dtPrincipal" tabindex="1"
                                process="@this,pnPrincipal" styleClass="OrangeButton" />
                        </div>
                        <div class="Container25 Responsive100">
                            <p:commandButton id="new" icon="White fa fa-file-o" value="Limpar" actionListener="#{relatorioPlanoTratamentoMB.actionNew}" update="dtPrincipal,pnPrincipal"
                                immediate="true" tabindex="1" />
                        </div>
                        <div class="Container25 Responsive100">
                            <p:commandButton value="Excel" ajax="false" icon="White fa fa-file-excel-o" styleClass="GreenButton">
                                <p:dataExporter encoding="iso-8859-1" type="xls" target="dtPrincipal" fileName="planoTratamento" />
                            </p:commandButton>
                        </div>

                        <div class="EmptyBox20"></div>


                        <p:dataTable filterDelay="1500" reflow="true" emptyMessage="" id="dtPrincipal" value="#{relatorioPlanoTratamentoMB.planoTratamentos}" var="m" rows="20" paginator="true"
                            rowKey="#{m}" paginatorPosition="bottom">
                            <f:facet name="header">Procedimentos</f:facet>
                            <p:column filterBy="#{m.paciente.dadosBasico.nomeStr}" sortBy="#{m.paciente.dadosBasico.nome}" filterMatchMode="contains">
                                <f:facet name="header">
                                    <h:outputText value="Paciente" />
                                </f:facet>
                                <h:outputText value="#{m.paciente.dadosBasico.nome}" title="#{m.id}" />
                            </p:column>
                            <p:column filterBy="#{m.descricao}" sortBy="#{m.descricao}" filterMatchMode="contains">
                                <f:facet name="header">
                                    <h:outputText value="Plano de Tratamento" />
                                </f:facet>
                                <h:outputText value="#{m.descricao}" />
                            </p:column>
                            <p:column filterBy="#{m.dataHoraStr}" sortBy="#{m.dataHoraStrOrd}" filterMatchMode="contains">
                                <f:facet name="header">
                                    <h:outputText value="Data de Início" />
                                </f:facet>
                                <h:outputText value="#{m.dataHoraStr}" />
                            </p:column>
                            <p:column filterBy="#{m.valorTotal}" sortBy="#{m.valorTotal}" filterMatchMode="contains" style="text-align:right">
                                <f:facet name="header">
                                    <h:outputText value="Valor Total" />
                                </f:facet>
                                <h:outputText value="#{m.valorTotal}">
                                    <f:convertNumber currencySymbol="R$" type="currency" locale="#{lumeSecurity.locale}" />
                                </h:outputText>
                            </p:column>
                            <p:column filterBy="#{m.valorTotalOrcamento}" sortBy="#{m.valorTotalOrcamento}" filterMatchMode="contains" style="text-align:right">
                                <f:facet name="header">
                                    <h:outputText value="Valor Total c/ Desc)" />
                                </f:facet>
                                <h:outputText value="#{m.valorTotalOrcamento}">
                                    <f:convertNumber currencySymbol="R$" type="currency" locale="#{lumeSecurity.locale}" />
                                </h:outputText>
                            </p:column>
                            <p:column filterBy="#{m.valorPagar}" sortBy="#{m.valorPagar}" filterMatchMode="contains" style="text-align:right">
                                <f:facet name="header">
                                    <h:outputText value="Valor Restante à Pagar" />
                                </f:facet>
                                <h:outputText value="#{m.valorPagar}">
                                    <f:convertNumber currencySymbol="R$" type="currency" locale="#{lumeSecurity.locale}" />
                                </h:outputText>
                            </p:column>

                            <p:column rendered="#{relatorioPlanoTratamentoMB.status == 'N'}">
                                <p:commandButton icon="White fa fa-times-circle" onclick="PF('devolver').show();" title="Encerrar" process="@this" styleClass="OrangeButton"
                                    action="#{planoTratamentoMB.setEntity(m)}" />
                                <p:button icon="White fa fa-eye" title="Visualizar" onclick="window.open('paciente.jsf?idpt=#{m.id}'); return false;" />
                            </p:column>

                        </p:dataTable>
                    </p:panel>

                    <p:remoteCommand id="carregarDados" name="carregarDados" process="@this,lume:filtro" update=":lume:dtPrincipal" actionListener="#{relatorioPlanoTratamentoMB.actionFiltrar}" />

                    <p:dialog id="devolver" widgetVar="devolver" header="Finalizar" responsive="true" modal="true">
                        <p:panelGrid columns="1" columnClasses="ui-grid-col-12" layout="grid" styleClass="ui-panelgrid-blank" style="border:0px none; background-color:transparent;">

                            <p:outputLabel for="justificativa" value="Justificativa : " />
                            <p:selectOneMenu id="justificativa" value="#{planoTratamentoMB.justificativa}" converter="dominio" required="true">
                                <f:selectItem itemValue="#{null}" itemLabel="Selecione uma justificativa" />
                                <f:selectItems value="#{planoTratamentoMB.justificativas}" var="justificativa" itemLabel="#{justificativa.nome}" itemValue="#{justificativa}" />
                            </p:selectOneMenu>

                            <p:outputLabel for="retorno" value="Data retorno : " />
                            <p:calendar id="retorno" value="#{planoTratamentoMB.retorno}" pattern="dd/MM/yyyy" showWeeksBar="false" locale="#{lumeSecurity.locale}" navigator="true" yearRange="-0:+1"
                                mindate="#{odontoMB.sysdate}" mask="true">
                            </p:calendar>
                        </p:panelGrid>

                        <div class="SeparatorFull"></div>
                        <div class="Container100 Responsive100">
                            <p:commandButton id="persistDevolver" icon="White fa fa-save" value="Salvar" actionListener="#{planoTratamentoMB.actionFinalizar}" process="@this, :lume:justificativa"
                                oncomplete="handleDialogRequest(xhr, status, args)" styleClass="GreenButton" />
                        </div>
                    </p:dialog>
                </div>
            </div>
        </div>
        <script type="text/javascript">
									function handleDialogRequest(xhr, status, args) {
										if (args.justificativa == true) {
											PF('devolver').hide();
											carregarDados();
										}
									}
								</script>
    </ui:define>
</ui:composition>