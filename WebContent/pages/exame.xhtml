<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:p="http://primefaces.org/ui" xmlns:f="http://java.sun.com/jsf/core"
    xmlns:ui="http://java.sun.com/jsf/facelets">
    <!-- wColorPicker -->
    <link rel="Stylesheet" type="text/css" href="${request.contextPath}/resources/wPaint/inc/wColorPicker.1.2.min.css" />
    <script type="text/javascript" src="${request.contextPath}/resources/wPaint/inc/wColorPicker.1.2.min.js"></script>
    <!-- wPaint -->
    <link rel="Stylesheet" type="text/css" href="${request.contextPath}/resources/wPaint/wPaint.1.3.css" />
    <script type="text/javascript" src="${request.contextPath}/resources/wPaint/wPaint.1.3.js"></script>
    <script>
					$(function() {
						doPaint = function() {
							if ($("#lume\\:tabView\\:arquivoBase64").val() != "") {
								$("#lume\\:tabView\\:paint").wPaint();
								$("#lume\\:tabView\\:paint").wPaint("image", $("#lume\\:tabView\\:arquivoBase64").val());
								$('div#_wPaint_menu').css('position', 'absolute');
							}
						}

						doView = function() {
							if ($("#lume\\:tabView\\:viewArquivoBase64").val() != "") {
								$("#lume\\:tabView\\:view").wPaint();
								$("#lume\\:tabView\\:view").wPaint("image", $("#lume\\:tabView\\:viewArquivoBase64").val());
								$('div#_wPaint_menu').css('position', 'absolute');
							}
						}

						saveImage = function() {
							var imageData = $("#lume\\:tabView\\:paint").wPaint("image");
							$("#lume\\:tabView\\:arquivoBase64").val(imageData);
						}
					});
				</script>
    <style>
    
#lume\3a tabView\3a exame > div.ui-fileupload-buttonbar {
    width: 30%;
}
</style>

    <p:remoteCommand id="carregaPdf" name="carregaPdf" process="@this" update=":lume:tabView:media,:lume:tabView:dlgPdf" oncomplete="PF('viewDialogPdf').show();" />
    <div class="Container100 Responsive100 NoIndent">
        <div class="Container100 ui-fluid NoPadding">

            <div class="Card">
                <p:outputPanel id="pnExame" styleClass="BordNone">

                    <h1>Descrição</h1>
                    
					<p:separator styleClass="SeparatorFull" />

                    <p:inputTextarea id="descricao" cols="50" rows="6" value="#{exameMB.entity.descricao}" autoResize="true" required="true" maxlength="200" counterTemplate="{0} caracteres restantes."
                        counter="counter" />
                    <div class="EmptyBox20"></div>
                    <h1>Arquivo : (JPG/JPEG/GIF/PNG/PDF)</h1>
                    
                    <p:separator styleClass="SeparatorFull" />
                    
                    <h:outputText id="nomeAnexo" value="#{exameMB.entity.nomeAnexo}" />

                    <p:fileUpload id="exame" fileUploadListener="#{exameMB.uploadArquivo}" mode="advanced" label="Anexar" auto="true" rendered="true"
                        allowTypes="/(\.|\/)(gif|jpeg|png|pdf|jpg|GIF|JPEG|PNG|PDF|JPG)$/" sizeLimit="5120000" invalidFileMessage="Apenas imagens e PDF pode ser utilizados."
                        invalidSizeMessage="Tamanho excedeu oOo limite." update="nomeAnexo" />
                    <br />
                    
                    <p:separator styleClass="SeparatorFull" />

                    <p:panelGrid columns="3" layout="grid"
						styleClass="ui-panelgrid-blank form-group ui-fluid optionsPaciente">
                        <p:commandButton id="persistExame" icon="White fa fa-save" value="Salvar" actionListener="#{exameMB.actionPersist}" update=":lume:tabView:pnExame,:lume:tabView:tbExame"
                            process=":lume:tabView:pnExame" styleClass="GreenButton" />
                        <p:commandButton id="deleteExame" icon="White fa fa-trash-o" value="Excluir" actionListener="#{exameMB.actionRemove}" update=":lume:tabView:pnExame,:lume:tabView:tbExame"
                            process="@this" disabled="#{exameMB.entity.id == 0}" styleClass="RedButton" />
                        <p:commandButton id="newExame" icon="White fa fa-file-o" value="Novo" actionListener="#{exameMB.actionNew}" update=":lume:tabView:pnExame,:lume:tabView:dtExame"
                            immediate="true" process="@this" tabindex="1" />
                    </p:panelGrid>

                </p:outputPanel>
                <div class="EmptyBox20"></div>

                <p:outputPanel id="tbExame">
                    <p:dataTable filterDelay="1500"  reflow="true" emptyMessage="" id="dtExame" value="#{exameMB.exames}" var="exame" rows="10" paginator="true" paginatorPosition="bottom" selection="#{exameMB.entity}"
                        selectionMode="single" rowKey="#{exame}">
                        <p:ajax event="rowSelect" update=":lume:tabView:pnExame" />
                        <f:facet name="header">Exames</f:facet>
                        <p:column sortBy="#{exame.descricao}" filterBy="#{exame.descricao}" filterMatchMode="contains" headerText="Descrição">
                            <h:outputText value="#{exame.descricao}" />
                        </p:column>
                        <p:column headerText="Download" styleClass="TexAlCenter">
                            <p:commandButton ajax="false" icon="White fa fa-download " immediate="true" style="width: 33px !important;">
                                <p:fileDownload value="#{exame.arquivo}" />
                            </p:commandButton>
                        </p:column>
                        <p:column headerText="Arquivo Original" styleClass="TexAlCenter">
                            <p:commandButton action="#{exameMB.actionEditFile}" icon="White fa fa-save" process="@this" immediate="true" oncomplete="PF('viewDialogResponsivo').show();PF('viewDialogResponsivo').toggleMaximize();"
                                update=":lume:tabView:pnResponsivo" rendered="#{!exameMB.validaPdf(exame)}" style="width: 33px !important;">
                                <f:setPropertyActionListener target="#{exameMB.entity}" value="#{exame}" />
                            </p:commandButton>
                            <p:commandButton action="#{exameMB.actionEditFile}" icon="White fa fa-search" process="@this" immediate="true" oncomplete="carregaPdf();"
                                update=":lume:tabView:media,:lume:tabView:dlgPdf" rendered="#{exameMB.validaPdf(exame)}" style="width: 33px !important;">
                                <f:setPropertyActionListener target="#{exameMB.entity}" value="#{exame}" />
                            </p:commandButton>
                        </p:column>
                        <p:column headerText="Arquivo Editado" styleClass="TexAlCenter BotaoExame">
                            <p:commandButton action="#{exameMB.actionEditFile2}" icon="White fa fa-save" process="@this" immediate="true" oncomplete="doView();PF('viewDialog').show();"
                                update=":lume:tabView:view,:lume:tabView:viewArquivoBase64" disabled="#{exameMB.validaPdf(exame)}" style="width: 33px !important;">
                                <f:setPropertyActionListener target="#{exameMB.entity}" value="#{exame}" />
                            </p:commandButton>
                        </p:column>
                        <p:column headerText="Editar" styleClass="TexAlCenter BotaoExame">
                            <p:commandButton action="#{exameMB.actionEditFile}" disabled="#{exameMB.validaPdf(exame)}" icon="fa fa-pencil White" process="@this" immediate="true"
                                update=":lume:tabView:paint,:lume:tabView:arquivoBase64" oncomplete="doPaint();PF('editDialog').show();" style="width: 33px !important;">
                                <f:setPropertyActionListener target="#{exameMB.entity}" value="#{exame}" />
                            </p:commandButton>
                        </p:column>
                        <p:column headerText="Data/Hora" sortBy="#{exame.dataHoraStrOrd}">
                            <h:outputText value="#{exame.dataHoraStr}" />
                        </p:column>
                    </p:dataTable>
                </p:outputPanel>
            </div>
        </div>
    </div>
    <p:dialog widgetVar="viewDialogResponsivo" header="Visualizar imagem" modal="true" responsive="true" onHide="PF('viewDialogResponsivo').toggleMaximize();">
        <p:graphicImage value="#{exameMB.arquivo}" stream="false" id="pnResponsivo" style="width: 100%;height: auto;" />
    </p:dialog>
    <p:dialog widgetVar="editDialog" header="Editar imagem" id="pnEditar" modal="true" responsive="true" onHide="$('div#_wPaint_menu').hide();">
        <div class="Card">
            <p:outputPanel id="paint" layout="block" class="ResolucaoImg" style="height: 450px !important; width: 800px !important" />
            <h:inputHidden id="arquivoBase64" value="#{exameMB.arquivoBase64}" />
            <img id="canvasImage" src="" />
        </div>
        <p:commandButton id="persistNewFile" icon="White fa fa-save" value="Salvar" actionListener="#{exameMB.actionPersistNewFile}" process="@this,:lume:tabView:arquivoBase64" onclick="saveImage()"
            update=":lume:tabView:dtExame" oncomplete="PF('editDialog').hide();$('div#_wPaint_menu').hide();" styleClass="GreenButton" />
    </p:dialog>
    <p:dialog widgetVar="viewDialog" header="Visualizar imagem" modal="true" responsive="true" onShow="$('div#_wPaint_menu').hide();">
        <h:panelGroup styleClass="lumeField" id="pnVisualizar">
            <p:outputPanel id="view" layout="block" class="ResolucaoImg" />
            <h:inputHidden id="viewArquivoBase64" value="#{exameMB.arquivoBase64}" />
        </h:panelGroup>

    </p:dialog>
    <p:dialog widgetVar="viewDialogPdf" header="Visualizar PDF" modal="true" responsive="true" id="dlgPdf">
        <p:panel id="media" rendered="#{exameMB.habilitaPDF}">
            <p:media value="/report.pdf" class="ResolucaoImg" player="pdf" />
        </p:panel>

    </p:dialog>


</ui:composition>