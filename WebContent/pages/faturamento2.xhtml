<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://primefaces.org/ui" template="/WEB-INF/template.xhtml" xmlns:pe="http://primefaces.org/ui/extensions">
    <ui:define name="content">
        <div class="Container100 Responsive100 NoIndent">
            <div class="Container100 ui-fluid NoPadding">
                <div class="Card">
                    <p:panel id="pnPrincipal" styleClass="BordNone">
                        <h1 class="CardBigTopic">Repasse dos Profissionais</h1>
                        <div class="SeparatorFull"></div>

                        <p:fieldset legend="Filtros">
                            <p:panelGrid columns="4" columnClasses="ui-grid-col-2,ui-grid-col-4,ui-grid-col-2,ui-grid-col-4" layout="grid" styleClass="ui-panelgrid-blank"
                                style="border:0px none; background-color:transparent;">
                                <p:outputLabel for="profissional" value="Profissional : " />
                                <p:autoComplete dropdown="true" queryDelay="1000" size="35" value="#{faturamentoMB.profissional}" id="profissional" minQueryLength="3"
                                    completeMethod="#{faturamentoMB.geraSugestoesProfissional}" var="profissional" itemLabel="#{profissional.dadosBasico.prefixoNome}" itemValue="#{profissional}"
                                    converter="profissional" forceSelection="true" required="true">
                                </p:autoComplete>
                                <p:outputLabel for="mes" value="Mês : " />
                                <p:selectOneMenu id="mes" value="#{faturamentoMB.mes}">
                                    <f:selectItem itemValue="1" itemLabel="Janeiro" />
                                    <f:selectItem itemValue="2" itemLabel="Fevereiro" />
                                    <f:selectItem itemValue="3" itemLabel="Março" />
                                    <f:selectItem itemValue="4" itemLabel="Abril" />
                                    <f:selectItem itemValue="5" itemLabel="Maio" />
                                    <f:selectItem itemValue="6" itemLabel="Junho" />
                                    <f:selectItem itemValue="7" itemLabel="Julho" />
                                    <f:selectItem itemValue="8" itemLabel="Agosto" />
                                    <f:selectItem itemValue="9" itemLabel="Setembro" />
                                    <f:selectItem itemValue="10" itemLabel="Outubro" />
                                    <f:selectItem itemValue="11" itemLabel="Novembro" />
                                    <f:selectItem itemValue="12" itemLabel="Dezembro" />
                                </p:selectOneMenu>

                                <p:outputLabel for="mesesAnteriores" value="Incluir finalizados em aberto dos meses anteriores : " />
                                <p:selectBooleanCheckbox id="mesesAnteriores" value="#{faturamentoMB.mesesAnteriores}" />

                            </p:panelGrid>

                            <div class="SeparatorFull"></div>
                            <div class="Container25 Responsive100">
                                <p:commandButton id="pesquisar" icon="White fa fa-search" value="Pesquisar" actionListener="#{faturamentoMB.actionFiltrar}"
                                    update="dtPrincipal,pnPrincipal,dtProcedimentosRepassar" tabindex="1" process="@this,pnPrincipal" styleClass="OrangeButton" />
                            </div>
                        </p:fieldset>
                        <br />
                        <br />
                        <p:fieldset legend="Procedimentos à Reservar" toggleable="true" toggleSpeed="500" collapsed="false">
                            <p:dataTable filterDelay="1500"  reflow="true" emptyMessage="" id="dtPrincipal" selection="#{faturamentoMB.entity}" selectionMode="single" value="#{faturamentoMB.planoTratamentoProcedimentos}"
                                var="ptp" rows="5" paginator="true" rowKey="#{ptp}" paginatorPosition="bottom">
                                <p:ajax event="rowSelect" update=":lume:pnPrincipal" listener="#{faturamentoMB.carregarLancamentos}" />
                                <p:column filterBy="#{ptp.planoTratamento.descricao}" styleClass="cabecalho" sortBy="#{ptp.planoTratamento.descricao}" filterMatchMode="contains">
                                    <f:facet name="header">
                                        <h:outputText styleClass="cabecalho" value="Plano de Tratamento" />
                                    </f:facet>
                                    <h:outputText value="#{ptp.planoTratamento.descricao}" title="#{ptp.id}" />
                                </p:column>
                                <p:column filterBy="#{ptp.descricaoCompleta}" sortBy="#{ptp.descricaoCompleta}">
                                    <f:facet name="header">
                                        <h:outputText value="Procedimento" />
                                    </f:facet>
                                    <h:outputText value="#{ptp.descricaoCompleta}" />
                                </p:column>
                                <p:column filterBy="#{ptp.planoTratamento.paciente.dadosBasico.nomeStr}" sortBy="#{ptp.planoTratamento.paciente.dadosBasico.nome}">
                                    <f:facet name="header">
                                        <h:outputText value="Paciente" />
                                    </f:facet>
                                    <h:outputText value="#{ptp.planoTratamento.paciente.dadosBasico.nome}" />
                                </p:column>
                                <p:column styleClass="cabecalho" headerText="Data de Finalização" filterBy="#{ptp.dataFinalizadoStr}" sortBy="#{ptp.dataFinalizado}">
                                    <h:outputText value="#{ptp.dataFinalizadoStr}" />
                                </p:column>
                                <p:column filterBy="#{ptp.valorDesconto}" sortBy="#{ptp.valorDesconto}">
                                    <f:facet name="header">
                                        <h:outputText value="Valor " />
                                    </f:facet>
                                    <h:outputText value="#{ptp.valorDesconto}">
                                        <f:convertNumber currencySymbol="R$" type="currency" locale="#{lumeSecurity.locale}" />
                                    </h:outputText>
                                </p:column>
                                <p:column filterBy="#{ptp.custos}" sortBy="#{ptp.custos}">
                                    <f:facet name="header">
                                        <h:outputText value="Custo" />
                                    </f:facet>
                                    <h:panelGroup rendered="#{ptp.custos != 0 and ptp.tipoRemuneracaoProfissionalCalc == 'POR'}">
                                        <p:commandLink action="#{faturamentoMB.carregaCustos(ptp)}" oncomplete="PF('dlgCusto').show();" process="@this" update=":lume:dtCusto">
                                            <h:outputText value="#{ptp.custos}">
                                                <f:convertNumber currencySymbol="R$" type="currency" locale="#{lumeSecurity.locale}" />
                                            </h:outputText>
                                        </p:commandLink>
                                    </h:panelGroup>
                                    <h:panelGroup rendered="#{ptp.custos == 0 and ptp.tipoRemuneracaoProfissionalCalc == 'POR'}">
                                        <h:outputText value="#{ptp.custos}">
                                            <f:convertNumber currencySymbol="R$" type="currency" locale="#{lumeSecurity.locale}" />
                                        </h:outputText>
                                    </h:panelGroup>
                                </p:column>
                                <p:column filterBy="#{ptp.finalizadoPorProfissional.percentualRemuneracao}" sortBy="#{ptp.finalizadoPorProfissional.percentualRemuneracao}">
                                    <f:facet name="header">
                                        <h:outputText value="Remuneração" />
                                    </f:facet>
                                    <h:outputText value="#{ptp.finalizadoPorProfissional.percentualRemuneracao}%" rendered="#{ptp.tipoRemuneracaoProfissionalCalc == 'POR'}" />
                                </p:column>
                                <p:column filterBy="#{ptp.tributo}" sortBy="#{ptp.tributo}">
                                    <f:facet name="header">
                                        <h:outputText value="Tributo" />
                                    </f:facet>
                                    <h:outputText value="#{ptp.tributo}" rendered="#{ptp.tipoRemuneracaoProfissionalCalc == 'POR'}">
                                        <f:convertNumber currencySymbol="" type="currency" locale="#{lumeSecurity.locale}" />
                                    </h:outputText>
                                    <h:outputText value="%" rendered="#{ptp.tipoRemuneracaoProfissionalCalc == 'POR'}" />
                                </p:column>
                                <p:column filterBy="#{ptp.valorRepasse}" styleClass="cabecalho" sortBy="#{ptp.valorRepasse}">
                                    <f:facet name="header">
                                        <h:outputText value="Valor Profissional" />
                                    </f:facet>
                                    <h:outputText value="#{ptp.valorRepasse}">
                                        <f:convertNumber currencySymbol="R$" type="currency" locale="#{lumeSecurity.locale}" />
                                    </h:outputText>

                                </p:column>
                                <p:column filterBy="#{ptp.valorRepassado}" styleClass="cabecalho" sortBy="#{ptp.valorRepassado}">
                                    <f:facet name="header">
                                        <h:outputText value="Valor Reservado/Repassado" />
                                    </f:facet>
                                    <h:outputText value="#{ptp.valorRepassado}">
                                        <f:convertNumber currencySymbol="R$" type="currency" locale="#{lumeSecurity.locale}" />
                                    </h:outputText>
                                </p:column>
                                <p:column filterBy="#{ptp.valorRestante}" sortBy="#{ptp.valorRestante}">
                                    <f:facet name="header">
                                        <h:outputText value="Débito" />
                                    </f:facet>
                                    <h:outputText value="#{ptp.valorRestante}">
                                        <f:convertNumber currencySymbol="R$" type="currency" locale="#{lumeSecurity.locale}" />
                                    </h:outputText>
                                </p:column>
                                <p:column filterBy="#{ptp.tipoRemuneracaoProfissionalCalc}" sortBy="#{ptp.tipoRemuneracaoProfissionalCalc}">
                                    <f:facet name="header">
                                        <h:outputText value="Tipo Remuneração" />
                                    </f:facet>
                                    <h:outputText value="#{ptp.tipoRemuneracaoProfissionalCalc}" />
                                </p:column>
                            </p:dataTable>
                            <br />
                            <br />
                            <p:dataTable filterDelay="1500"  reflow="true" emptyMessage="" id="dtLancamentos" selection="#{faturamentoMB.lancamento}" selectionMode="single" value="#{faturamentoMB.lancamentos}"
                                var="lancamento" rows="5" paginator="true" rowKey="#{lancamento}" paginatorPosition="bottom">
                                <f:facet name="header">Recebimentos com crédito</f:facet>
                                <p:ajax event="rowSelect" update=":lume:pnPrincipal" listener="#{faturamentoMB.actionVerificaTarifa}" />
                                <p:column styleClass="cabecalho" headerText="Plano de Tratamento" filterBy="#{lancamento.orcamento.planoTratamento.descricao}"
                                    sortBy="#{lancamento.orcamento.planoTratamento.descricao}">
                                    <h:outputText value="#{lancamento.orcamento.planoTratamento.descricao}" title="#{lancamento.id}" />
                                </p:column>
                                <p:column headerText="Status" filterBy="#{lancamento.status}" sortBy="#{lancamento.status}">
                                    <h:outputText value="#{lancamento.status}" />
                                </p:column>
                                <p:column sortBy="#{lancamento.numeroParcela}" filterBy="#{lancamento.numeroParcela}" headerText="Parcela">
                                    <h:outputText value="#{lancamento.numeroParcela}" />
                                </p:column>
                                <p:column headerText="Data de Crédito" filterBy="#{lancamento.dataCreditoStr}" sortBy="#{lancamento.dataCreditoStr}">
                                    <h:outputText value="#{lancamento.dataCreditoStr}" />
                                </p:column>
                                <p:column styleClass="cabecalho" filterBy="#{lancamento.dataPagamentoStr}" headerText="Data do Pagamento" sortBy="#{lancamento.dataPagamentoStr}">
                                    <h:outputText value="#{lancamento.dataPagamentoStr}" />
                                </p:column>
                                <p:column styleClass="cabecalho" filterBy="#{lancamento.formaPagamentoStr}" headerText="Forma de Pagamento" sortBy="#{lancamento.formaPagamentoStr}">
                                    <h:outputText value="#{lancamento.formaPagamentoStr}" />
                                </p:column>
                                <p:column headerText="Valor" filterBy="#{lancamento.valor}" sortBy="#{lancamento.valor}">
                                    <h:outputText value="#{lancamento.valor}">
                                        <f:convertNumber currencySymbol="R$" type="currency" locale="#{lumeSecurity.locale}" />
                                    </h:outputText>
                                </p:column>
                                <p:column filterBy="#{lancamento.tarifa.taxa}" headerText="Taxa" sortBy="#{lancamento.tarifa.taxa}">
                                    <h:outputText value="#{lancamento.tarifa.taxa}">
                                        <f:convertNumber currencySymbol="" type="currency" locale="#{lumeSecurity.locale}" />
                                    </h:outputText>
                                    <h:outputText value="%" rendered="#{lancamento.tarifa != null}" />
                                </p:column>
                                <p:column filterBy="#{lancamento.valorRepassado}" headerText="Valor Utilizado" sortBy="#{lancamento.valorRepassado}">
                                    <h:outputText value="#{lancamento.valorRepassado}">
                                        <f:convertNumber currencySymbol="R$" type="currency" locale="#{lumeSecurity.locale}" />
                                    </h:outputText>
                                </p:column>
                                <p:column filterBy="#{lancamento.credito}" headerText="Crédito" sortBy="#{lancamento.credito}">
                                    <h:outputText value="#{lancamento.credito}">
                                        <f:convertNumber currencySymbol="R$" type="currency" locale="#{lumeSecurity.locale}" />
                                    </h:outputText>
                                </p:column>
                            </p:dataTable>
                            <div class="SeparatorFull"></div>
                            <h:panelGroup rendered="#{!faturamentoMB.existeRepasseEmAberto}" id="pgReservar">
                                <div class="Container25 Responsive100">
                                    <p:commandButton id="reservar" icon="White fa fa-money" value="Reservar Tudo" disabled="#{!faturamentoMB.reservar}" actionListener="#{faturamentoMB.actionReservar}"
                                        update=":lume:pnPrincipal" process=":lume:pnPrincipal" styleClass="GreenButton" />
                                </div>
                                <div class="Container25 Responsive100">
                                    <p:commandButton id="reservarParcial" icon="White fa fa-money" value="Reservar Parcial" disabled="#{!faturamentoMB.reservar}"
                                        actionListener="#{faturamentoMB.carregarReservarParcial}" update=":lume:pnReservaParcial" process=":lume:pnPrincipal" styleClass="GreenButton"
                                        oncomplete="PF('dlgReservaParcial').show();" />
                                </div>
                                <div class="Container25 Responsive100">
                                    <p:commandButton id="remover" icon="White fa fa-trash-o" value="Voltar Reserva" disabled="#{faturamentoMB.entity == null || faturamentoMB.entity.id == 0}"
                                        actionListener="#{faturamentoMB.actionRemoverReserva}" update=":lume:pnPrincipal" process=":lume:pnPrincipal" styleClass="RedButton">
                                        <p:confirm header="Confirmação" message="Deseja voltar as reservas?" icon="ui-icon-alert" />
                                    </p:commandButton>
                                </div>
                            </h:panelGroup>
                            <div class="Container25 Responsive100">
                                <p:commandButton id="procedimentosOutros" icon="White fa fa-server" onclick="PF('dlg').show();" value="Procedimentos finalizados deste tratamento"
                                    update=":lume:pnProcedimentosOutros" process="@this" disabled="#{faturamentoMB.entity.id == 0}" styleClass="OrangeButton" />
                            </div>
                        </p:fieldset>


                        <br />
                        <br />
                        <p:fieldset legend="Procedimentos à Repassar" toggleable="true" toggleSpeed="500" collapsed="false">
                            <h:panelGroup id="pnProcedimentosRepassar">
                                <p:dataTable filterDelay="1500"  reflow="true" emptyMessage="" id="dtProcedimentosRepassar" value="#{faturamentoMB.procedimentosRepasse}"
                                    selection="#{faturamentoMB.procedimentosRepasseSelecionados}" var="ptp" rows="5" paginator="true" rowKey="#{ptp}" paginatorPosition="bottom">


                                    <p:column selectionMode="multiple" style="padding: 0px;text-align: center;" width="3%" />

                                    <p:ajax event="rowSelect" update=":lume:repassar" />
                                    <p:ajax event="rowSelectCheckbox" update=":lume:repassar" />
                                    <p:ajax event="rowUnselectCheckbox" update=":lume:repassar" />
                                    <p:ajax event="toggleSelect" update=":lume:repassar,:lume:pnProcedimentosRepassar" listener="#{faturamentoMB.checkOrUncheckAllRepassar}" />


                                    <p:column filterBy="#{ptp.planoTratamento.descricao}" styleClass="cabecalho" sortBy="#{ptp.planoTratamento.descricao}" filterMatchMode="contains">
                                        <f:facet name="header">
                                            <h:outputText styleClass="cabecalho" value="Plano de Tratamento" />
                                        </f:facet>
                                        <h:outputText value="#{ptp.planoTratamento.descricao}" title="#{ptp.id}" />
                                    </p:column>
                                    <p:column filterBy="#{ptp.descricaoCompleta}" sortBy="#{ptp.descricaoCompleta}">
                                        <f:facet name="header">
                                            <h:outputText value="Procedimento" />
                                        </f:facet>
                                        <h:outputText value="#{ptp.descricaoCompleta}" />
                                    </p:column>
                                    <p:column filterBy="#{ptp.planoTratamento.paciente.dadosBasico.nomeStr}" sortBy="#{ptp.planoTratamento.paciente.dadosBasico.nome}">
                                        <f:facet name="header">
                                            <h:outputText value="Paciente" />
                                        </f:facet>
                                        <h:outputText value="#{ptp.planoTratamento.paciente.dadosBasico.nome}" />
                                    </p:column>
                                    <p:column styleClass="cabecalho" headerText="Data de Finalização" filterBy="#{ptp.dataFinalizadoStr}" sortBy="#{ptp.dataFinalizado}">
                                        <h:outputText value="#{ptp.dataFinalizadoStr}" />
                                    </p:column>
                                    <p:column filterBy="#{ptp.valorDesconto}" sortBy="#{ptp.valorDesconto}">
                                        <f:facet name="header">
                                            <h:outputText value="Valor " />
                                        </f:facet>
                                        <h:outputText value="#{ptp.valorDesconto}">
                                            <f:convertNumber currencySymbol="R$" type="currency" locale="#{lumeSecurity.locale}" />
                                        </h:outputText>
                                    </p:column>
                                    <p:column filterBy="#{ptp.custos}" sortBy="#{ptp.custos}">
                                        <f:facet name="header">
                                            <h:outputText value="Custo" />
                                        </f:facet>
                                        <h:panelGroup rendered="#{ptp.custos != 0 and ptp.tipoRemuneracaoProfissionalCalc == 'POR'}">
                                            <p:commandLink action="#{faturamentoMB.carregaCustos(ptp)}" oncomplete="PF('dlgCusto').show();" process="@this" update=":lume:dtCusto">
                                                <h:outputText value="#{ptp.custos}">
                                                    <f:convertNumber currencySymbol="R$" type="currency" locale="#{lumeSecurity.locale}" />
                                                </h:outputText>
                                            </p:commandLink>
                                        </h:panelGroup>
                                        <h:panelGroup rendered="#{ptp.custos == 0 and ptp.tipoRemuneracaoProfissionalCalc == 'POR'}">
                                            <h:outputText value="#{ptp.custos}">
                                                <f:convertNumber currencySymbol="R$" type="currency" locale="#{lumeSecurity.locale}" />
                                            </h:outputText>
                                        </h:panelGroup>
                                    </p:column>
                                    <p:column filterBy="#{ptp.finalizadoPorProfissional.percentualRemuneracao}" sortBy="#{ptp.finalizadoPorProfissional.percentualRemuneracao}">
                                        <f:facet name="header">
                                            <h:outputText value="Remuneração" />
                                        </f:facet>
                                        <h:outputText value="#{ptp.finalizadoPorProfissional.percentualRemuneracao}%" rendered="#{ptp.tipoRemuneracaoProfissionalCalc == 'POR'}" />
                                    </p:column>
                                    <p:column filterBy="#{ptp.tributo}" sortBy="#{ptp.tributo}">
                                        <f:facet name="header">
                                            <h:outputText value="Tributo" />
                                        </f:facet>
                                        <h:outputText value="#{ptp.tributo}" rendered="#{ptp.tipoRemuneracaoProfissionalCalc == 'POR'}">
                                            <f:convertNumber currencySymbol="" type="currency" locale="#{lumeSecurity.locale}" />
                                        </h:outputText>
                                        <h:outputText value="%" rendered="#{ptp.tipoRemuneracaoProfissionalCalc == 'POR'}" />
                                    </p:column>
                                    <p:column filterBy="#{ptp.valorRepasse}" styleClass="cabecalho" sortBy="#{ptp.valorRepasse}">
                                        <f:facet name="header">
                                            <h:outputText value="Valor Profissional" />
                                        </f:facet>
                                        <h:outputText value="#{ptp.valorRepasse}">
                                            <f:convertNumber currencySymbol="R$" type="currency" locale="#{lumeSecurity.locale}" />
                                        </h:outputText>

                                    </p:column>
                                    <p:column filterBy="#{ptp.valorReservado}" styleClass="cabecalho" sortBy="#{ptp.valorReservado}">
                                        <f:facet name="header">
                                            <h:outputText value="Valor Reservado" />
                                        </f:facet>
                                        <h:outputText value="#{ptp.valorReservado}">
                                            <f:convertNumber currencySymbol="R$" type="currency" locale="#{lumeSecurity.locale}" />
                                        </h:outputText>

                                    </p:column>
                                    <p:column filterBy="#{ptp.valorRestante}" sortBy="#{ptp.valorRestante}">
                                        <f:facet name="header">
                                            <h:outputText value="Débito" />
                                        </f:facet>
                                        <h:outputText value="#{ptp.valorRestante}">
                                            <f:convertNumber currencySymbol="R$" type="currency" locale="#{lumeSecurity.locale}" />
                                        </h:outputText>

                                    </p:column>
                                    <p:column filterBy="#{ptp.tipoRemuneracaoProfissionalCalc}" sortBy="#{ptp.tipoRemuneracaoProfissionalCalc}">
                                        <f:facet name="header">
                                            <h:outputText value="Tipo Remuneração" />
                                        </f:facet>
                                        <h:outputText value="#{ptp.tipoRemuneracaoProfissionalCalc}" />
                                    </p:column>

                                    <p:column>
                                        <p:commandButton id="remover2" icon="White fa fa-trash-o" title="Voltar Reserva" actionListener="#{faturamentoMB.actionRemoverReservaRepasse(ptp)}"
                                            update=":lume:pnPrincipal" process="@this" styleClass="RedButton">
                                            <p:confirm header="Confirmação" message="Deseja voltar as reservas?" icon="ui-icon-alert" />
                                        </p:commandButton>
                                    </p:column>

                                </p:dataTable>

                                <div class="SeparatorFull"></div>
                                <div class="Container25 Responsive100">
                                    <p:commandButton id="repassar" icon="White fa fa-money" value="Repassar"
                                        disabled="#{faturamentoMB.procedimentosRepasseSelecionados == null || faturamentoMB.procedimentosRepasseSelecionados.isEmpty()}"
                                        actionListener="#{faturamentoMB.actionRepassar}"
                                        update=":lume:pnProcedimentosRepassar,:lume:dtReservados,:lume:repasse,:lume:pgReservar,:lume:pnProcedimentosRepassar"
                                        process="@this,:lume:dtProcedimentosRepassar" styleClass="GreenButton" />
                                </div>
                            </h:panelGroup>
                        </p:fieldset>

                        <br />
                        <br />
                        <p:fieldset legend="Repasses" toggleable="true" toggleSpeed="500" collapsed="false">
                            <h:panelGroup id="pnReservados">
                                <p:panelGrid columns="2" columnClasses="ui-grid-col-4,ui-grid-col-8" layout="grid" styleClass="ui-panelgrid-blank"
                                    style="border:0px none; background-color:transparent;">
                                    <p:outputLabel for="repasse" value="Repasse : " />
                                    <p:selectOneMenu id="repasse" value="#{faturamentoMB.repasseSelecionado}" styleClass="Wid50" converter="repasseProfissional">
                                        <p:ajax process="@this" update=":lume:pnReservados" listener="#{faturamentoMB.carregarRepasseItens}" />
                                        <f:selectItem itemValue="#{null}" itemLabel="Selecione um Repasse" />
                                        <f:selectItems value="#{faturamentoMB.repasses}" var="r" itemValue="#{r}" itemLabel="#{r.dataStr}" />
                                    </p:selectOneMenu>

                                    <p:outputLabel value="Data Pagamento : " />
                                    <p:outputLabel value="#{faturamentoMB.repasseSelecionado.dataPagamentoStr}" />

                                    <p:outputLabel value="Pago por : " />
                                    <p:outputLabel value="#{faturamentoMB.repasseSelecionado.profissionalPagou.dadosBasico.nome}" />
                                </p:panelGrid>

                                <br />

                                <p:dataTable filterDelay="1500"  reflow="true" emptyMessage="" id="dtReservados" value="#{faturamentoMB.repasseItens}" var="ptp" rows="5" paginator="true" paginatorPosition="bottom">
                                    <p:column filterBy="#{ptp.planoTratamentoProcedimento.planoTratamento.descricao}" styleClass="cabecalho"
                                        sortBy="#{ptp.planoTratamentoProcedimento.planoTratamento.descricao}">
                                        <f:facet name="header">
                                            <h:outputText value="Plano de Tratamento" />
                                        </f:facet>
                                        <h:outputText value="#{ptp.planoTratamentoProcedimento.planoTratamento.descricao}" title="#{ptp.id}" />
                                    </p:column>
                                    <p:column filterBy="#{ptp.planoTratamentoProcedimento.descricaoCompleta}" sortBy="#{ptp.planoTratamentoProcedimento.descricaoCompleta}">
                                        <f:facet name="header">
                                            <h:outputText value="Procedimento" />
                                        </f:facet>
                                        <h:outputText value="#{ptp.planoTratamentoProcedimento.descricaoCompleta}" />
                                    </p:column>
                                    <p:column filterBy="#{ptp.planoTratamentoProcedimento.planoTratamento.paciente.dadosBasico.nome}"
                                        sortBy="#{ptp.planoTratamentoProcedimento.planoTratamento.paciente.dadosBasico.nome}">
                                        <f:facet name="header">
                                            <h:outputText value="Paciente" />
                                        </f:facet>
                                        <h:outputText value="#{ptp.planoTratamentoProcedimento.planoTratamento.paciente.dadosBasico.nome}" />
                                    </p:column>
                                    <p:column styleClass="cabecalho" headerText="Data de Finalização" filterBy="#{ptp.planoTratamentoProcedimento.dataFinalizadoStr}"
                                        sortBy="#{ptp.planoTratamentoProcedimento.dataFinalizadoStr}">
                                        <h:outputText value="#{ptp.planoTratamentoProcedimento.dataFinalizadoStr}" />
                                    </p:column>
                                    <p:column filterBy="#{ptp.planoTratamentoProcedimento.valorCalc}" sortBy="#{ptp.planoTratamentoProcedimento.valorCalc}">
                                        <f:facet name="header">
                                            <h:outputText value="Valor " />
                                        </f:facet>
                                        <h:outputText value="#{ptp.planoTratamentoProcedimento.valorCalc}">
                                            <f:convertNumber currencySymbol="R$" type="currency" locale="#{lumeSecurity.locale}" />
                                        </h:outputText>

                                    </p:column>
                                    <p:column filterBy="#{ptp.planoTratamentoProcedimento.custoCalc}" sortBy="#{ptp.planoTratamentoProcedimento.custoCalc}">
                                        <f:facet name="header">
                                            <h:outputText value="Custo" />
                                        </f:facet>
                                        <h:outputText value="#{ptp.planoTratamentoProcedimento.custoCalc}" rendered="#{ptp.planoTratamentoProcedimento.tipoRemuneracaoProfissionalCalc == 'POR'}">
                                            <f:convertNumber currencySymbol="R$" type="currency" locale="#{lumeSecurity.locale}" />
                                        </h:outputText>
                                    </p:column>
                                    <p:column filterBy="#{ptp.planoTratamentoProcedimento.percentualCalc}" sortBy="#{ptp.planoTratamentoProcedimento.percentualCalc}">
                                        <f:facet name="header">
                                            <h:outputText value="Remuneração" />
                                        </f:facet>
                                        <h:outputText value="#{ptp.planoTratamentoProcedimento.percentualCalc}%" rendered="#{ptp.planoTratamentoProcedimento.tipoRemuneracaoProfissionalCalc == 'POR'}" />
                                    </p:column>
                                    <p:column filterBy="#{ptp.planoTratamentoProcedimento.tributoCalc}" sortBy="#{ptp.planoTratamentoProcedimento.tributoCalc}">
                                        <f:facet name="header">
                                            <h:outputText value="Tributo" />
                                        </f:facet>
                                        <h:outputText value="#{ptp.planoTratamentoProcedimento.tributoCalc}" rendered="#{ptp.planoTratamentoProcedimento.tipoRemuneracaoProfissionalCalc == 'POR'}">
                                            <f:convertNumber currencySymbol="" type="currency" locale="#{lumeSecurity.locale}" />
                                        </h:outputText>
                                        <h:outputText value="%" rendered="#{ptp.planoTratamentoProcedimento.tipoRemuneracaoProfissionalCalc == 'POR'}" />
                                    </p:column>
                                    <p:column filterBy="#{ptp.planoTratamentoProcedimento.valorRepasse}" styleClass="cabecalho" sortBy="#{ptp.planoTratamentoProcedimento.valorRepasse}">
                                        <f:facet name="header">
                                            <h:outputText value="Valor Profissional" />
                                        </f:facet>
                                        <h:outputText value="#{ptp.planoTratamentoProcedimento.valorRepasse}">
                                            <f:convertNumber currencySymbol="R$" type="currency" locale="#{lumeSecurity.locale}" />
                                        </h:outputText>

                                    </p:column>
                                    <p:column filterBy="#{ptp.valor}" styleClass="cabecalho" sortBy="#{ptp.valor}">
                                        <f:facet name="header">
                                            <h:outputText value="Valor Pagar" />
                                        </f:facet>
                                        <h:outputText value="#{ptp.valor}">
                                            <f:convertNumber currencySymbol="R$" type="currency" locale="#{lumeSecurity.locale}" />
                                        </h:outputText>

                                    </p:column>
                                    <p:column filterBy="#{ptp.planoTratamentoProcedimento.valorRestante}" sortBy="#{ptp.planoTratamentoProcedimento.valorRestante}">
                                        <f:facet name="header">
                                            <h:outputText value="Débito" />
                                        </f:facet>
                                        <h:outputText value="#{ptp.planoTratamentoProcedimento.valorRestante}">
                                            <f:convertNumber currencySymbol="R$" type="currency" locale="#{lumeSecurity.locale}" />
                                        </h:outputText>

                                    </p:column>

                                    <p:column filterBy="#{ptp.planoTratamentoProcedimento.dataRepasseStr}" sortBy="#{ptp.planoTratamentoProcedimento.dataRepasse}">
                                        <f:facet name="header">
                                            <h:outputText value="Dta. Últ. Reserva / Repasse" />
                                        </f:facet>
                                        <h:outputText value="#{ptp.planoTratamentoProcedimento.dataRepasseStr}" />

                                    </p:column>
                                </p:dataTable>
                                <div class="SeparatorFull"></div>
                                <div class="Container25 Responsive100">
                                    <p:commandButton id="pagar" icon="White fa fa-money" value="Pagar" disabled="#{!faturamentoMB.pagar}" actionListener="#{faturamentoMB.actionPagar}"
                                        update="@this,:lume:pnReservados,:lume:btGerarDocumento,:lume:pgReservar" styleClass="GreenButton" />
                                </div>
                                <div class="Container25 Responsive100">
                                    <p:commandButton id="btGerarDocumento" value="Recibo" icon="White fa fa-gear" styleClass="OrangeButton" update=":lume:pnImpressao"
                                        oncomplete="PF('dlgImpressao').show();" disabled="#{!faturamentoMB.recibo}" />
                                </div>

                            </h:panelGroup>


                            <p:panel id="pnImpressao" styleClass="BordNone">
                                <p:dialog id="dlgImpressao" widgetVar="dlgImpressao" header="Documento de Repasses" responsive="true" modal="true" height="600">
                                    <div class="Container100 NoIndent Flex FlexWrap">
                                        <p:panel id="pnConteudoImpressao" styleClass="BordNone">
                                            <div class="SeparatorFull"></div>
                                            <h1 class="CardBigTopic">
                                                <h:outputText value="#{faturamentoMB.nomeClinica}" />
                                                <br />
                                            </h1>
                                            <h1 class="CardSmallTopic">
                                                <h:outputText value="#{faturamentoMB.endTelefoneClinica}" />
                                                <br />
                                            </h1>
                                            <div class="SeparatorFull"></div>

                                            <div class="Container33 Responsive33">
                                                <span class="FontLatoBold Fs14 Green DispBlock">Mês</span>
                                                <div class="EmptyBox5"></div>
                                                <span class="FontLatoBold Fs20 Navy DispBlock"><h:outputText value="#{faturamentoMB.mesStr}" /> </span>
                                                <div class="EmptyBox5"></div>
                                            </div>
                                            <div class="Container33 Responsive33">
                                                <span class="FontLatoBold Fs14 Green DispBlock">Pago</span>
                                                <div class="EmptyBox5"></div>
                                                <span class="FontLatoBold Fs20 Navy DispBlock"><h:outputText value="#{faturamentoMB.valorRepassadoTotal}">
                                                        <f:convertNumber currencySymbol="R$" type="currency" locale="#{lumeSecurity.locale}" />
                                                    </h:outputText> </span>
                                                <div class="EmptyBox5"></div>
                                            </div>



                                            <div class="Container100 Responsive100 Flex">
                                                <p:dataTable filterDelay="1500"  emptyMessage="" value="#{faturamentoMB.repasseItens}" var="ptp">
                                                    <f:facet name="header">Procedimentos</f:facet>

                                                    <p:column>
                                                        <f:facet name="header">
                                                            <h:outputText value="Paciente " />
                                                        </f:facet>
                                                        <h:outputText value="#{ptp.planoTratamentoProcedimento.planoTratamento.paciente.dadosBasico.nome}" />
                                                    </p:column>

                                                    <p:column width="30%">
                                                        <f:facet name="header">
                                                            <h:outputText value="Procedimento" />
                                                        </f:facet>
                                                        <h:outputText value="#{ptp.planoTratamentoProcedimento.descricaoCompleta}" />
                                                    </p:column>
                                                    <p:column headerText="Data de Finalização">
                                                        <h:outputText value="#{ptp.planoTratamentoProcedimento.dataFinalizadoStr}" />
                                                    </p:column>
                                                    <p:column>
                                                        <f:facet name="header">
                                                            <h:outputText value="Custo Direto" />
                                                        </f:facet>
                                                        <h:outputText value="#{ptp.planoTratamentoProcedimento.custos}"
                                                            rendered="#{ptp.planoTratamentoProcedimento.tipoRemuneracaoProfissionalCalc == 'POR'}">
                                                            <f:convertNumber currencySymbol="R$" type="currency" locale="#{lumeSecurity.locale}" />
                                                        </h:outputText>
                                                    </p:column>
                                                    <p:column>
                                                        <f:facet name="header">
                                                            <h:outputText value="Valor Profissional" />
                                                        </f:facet>
                                                        <h:outputText value="#{ptp.planoTratamentoProcedimento.valorRepasse}">
                                                            <f:convertNumber currencySymbol="R$" type="currency" locale="#{lumeSecurity.locale}" />
                                                        </h:outputText>
                                                    </p:column>
                                                    <p:column>
                                                        <f:facet name="header">
                                                            <h:outputText value="Valor Pagar" />
                                                        </f:facet>
                                                        <h:outputText value="#{ptp.valor}">
                                                            <f:convertNumber currencySymbol="R$" type="currency" locale="#{lumeSecurity.locale}" />
                                                        </h:outputText>
                                                    </p:column>
                                                </p:dataTable>
                                            </div>

                                            <div class="Container100 Responsive100">
                                                <div class="EmptyBox20"></div>
                                                <span class="FontLatoBold Fs15 Navy DispBlock">Certifico que recebi os valores referentes aos trabalhos citados acima:</span>
                                                <div class="EmptyBox20"></div>
                                                <span class="FontLatoBold Fs15 Navy DispBlock">______________________________________</span>
                                                <div class="EmptyBox5"></div>
                                                <span class="FontLatoBold Fs15 Navy DispBlock"><h:outputText value="#{faturamentoMB.profissional.dadosBasico.nome}" /> (CPF <h:outputText
                                                        value="#{faturamentoMB.profissional.dadosBasico.documento}" />)</span>
                                            </div>

                                        </p:panel>
                                        <div class="Container25">
                                            <p:commandButton value="Imprimir" type="button" icon="White fa fa-print White" styleClass="NavyButton">
                                                <p:printer target="pnConteudoImpressao" />
                                            </p:commandButton>
                                        </div>
                                    </div>

                                </p:dialog>
                            </p:panel>

                        </p:fieldset>


                    </p:panel>
                    <p:dialog id="dlg" widgetVar="dlg" header="Procedimentos finalizados de outros profissionais deste Plano de Tratamento" responsive="true" modal="true">
                        <p:panel id="pnProcedimentosOutros" styleClass="BordNone">
                            <p:dataTable filterDelay="1500"  reflow="true" emptyMessage="" id="dtProcedimentosOutros" value="#{faturamentoMB.procedimentosOutrosProfissionais}" var="ptp" rows="5" paginator="true"
                                paginatorPosition="bottom">
                                <p:column filterBy="#{ptp.finalizadoPorProfissional.dadosBasico.nome}" sortBy="#{ptp.finalizadoPorProfissional.dadosBasico.nome}">
                                    <f:facet name="header">
                                        <h:outputText value="Profissional" />
                                    </f:facet>
                                    <h:outputText value="#{ptp.finalizadoPorProfissional.dadosBasico.nome}" />
                                </p:column>
                                <p:column filterBy="#{ptp.dataFinalizadoStr}" sortBy="#{ptp.dataFinalizadoStr}">
                                    <f:facet name="header">
                                        <h:outputText value="Data finalização" />
                                    </f:facet>
                                    <h:outputText value="#{ptp.dataFinalizadoStr}" />
                                </p:column>
                                <p:column filterBy="#{ptp.descricaoCompleta}" sortBy="#{ptp.descricaoCompleta}">
                                    <f:facet name="header">
                                        <h:outputText value="Procedimento" />
                                    </f:facet>
                                    <h:outputText value="#{ptp.descricaoCompleta}" />
                                </p:column>
                                <p:column filterBy="#{ptp.valorDesconto}" sortBy="#{ptp.valorDesconto}">
                                    <f:facet name="header">
                                        <h:outputText value="Valor " />
                                    </f:facet>
                                    <h:outputText value="#{ptp.valorDesconto}">
                                        <f:convertNumber currencySymbol="R$" type="currency" locale="#{lumeSecurity.locale}" />
                                    </h:outputText>

                                </p:column>
                                <p:column filterBy="#{ptp.custos}" sortBy="#{ptp.custos}">
                                    <f:facet name="header">
                                        <h:outputText value="Custo" />
                                    </f:facet>
                                    <h:outputText value="#{ptp.custos}">
                                        <f:convertNumber currencySymbol="R$" type="currency" locale="#{lumeSecurity.locale}" />
                                    </h:outputText>
                                </p:column>
                                <p:column filterBy="#{ptp.finalizadoPorProfissional.percentualRemuneracao}" sortBy="#{ptp.finalizadoPorProfissional.percentualRemuneracao}">
                                    <f:facet name="header">
                                        <h:outputText value="Remuneração" />
                                    </f:facet>
                                    <h:outputText value="#{ptp.finalizadoPorProfissional.percentualRemuneracao}%" />
                                </p:column>
                                <p:column filterBy="#{ptp.tributo}" sortBy="#{ptp.tributo}">
                                    <f:facet name="header">
                                        <h:outputText value="Tributo" />
                                    </f:facet>
                                    <h:outputText value="#{ptp.tributo}">
                                        <f:convertNumber currencySymbol="" type="currency" locale="#{lumeSecurity.locale}" />
                                    </h:outputText>
                                    <h:outputText value="%" />
                                </p:column>
                                <p:column filterBy="#{ptp.valorRepasse}" sortBy="#{ptp.valorRepasse}">
                                    <f:facet name="header">
                                        <h:outputText value="Valor Profissional" />
                                    </f:facet>
                                    <h:outputText value="#{ptp.valorRepasse}">
                                        <f:convertNumber currencySymbol="R$" type="currency" locale="#{lumeSecurity.locale}" />
                                    </h:outputText>

                                </p:column>
                                <p:column filterBy="#{ptp.valorRepassado}" sortBy="#{ptp.valorRepassado}">
                                    <f:facet name="header">
                                        <h:outputText value="Valor Reservado" />
                                    </f:facet>
                                    <h:outputText value="#{ptp.valorRepassado}">
                                        <f:convertNumber currencySymbol="R$" type="currency" locale="#{lumeSecurity.locale}" />
                                    </h:outputText>

                                </p:column>
                                <p:column filterBy="#{ptp.valorRestante}" sortBy="#{ptp.valorRestante}">
                                    <f:facet name="header">
                                        <h:outputText value="Débito" />
                                    </f:facet>
                                    <h:outputText value="#{ptp.valorRestante}">
                                        <f:convertNumber currencySymbol="R$" type="currency" locale="#{lumeSecurity.locale}" />
                                    </h:outputText>

                                </p:column>
                            </p:dataTable>
                        </p:panel>
                    </p:dialog>

                    <p:dialog widgetVar="dlgCusto">
                        <div class="Card">
                            <h1 class="CardBigTopic">Detalhamento de custos</h1>
                            <div class="SeparatorFull"></div>
                            <p:dataTable filterDelay="1500"  reflow="true" var="custo" value="#{faturamentoMB.custos}" rowKey="custo" paginator="true" rows="20" paginatorPosition="bottom" id="dtCusto"
                                emptyMessage="Esse procedimento não possui custos.">
                                <f:facet name="header">Custos</f:facet>

                                <p:column headerText="Data de Faturamento" sortBy="#{custo.dataFaturamento}" filterBy="#{custo.dataFaturamento}" filterMatchMode="contains">
                                    <h:outputText value="#{custo.dataFaturamentoStr}" />
                                </p:column>
                                <p:column headerText="Data do Custo" sortBy="#{custo.dataRegistro}" filterBy="#{custo.dataRegistroStr}" filterMatchMode="contains">
                                    <h:outputText value="#{custo.dataRegistroStr}" />
                                </p:column>
                                <p:column headerText="Procedimento" sortBy="#{custo.planoTratamentoProcedimento.descricaoCompleta}" filterBy="#{custo.planoTratamentoProcedimento.descricaoCompleta}"
                                    filterMatchMode="contains" style="width:30%">
                                    <h:outputText value="#{custo.planoTratamentoProcedimento.descricaoCompleta}" />
                                </p:column>
                                <p:column sortBy="#{custo.descricao}" headerText="Descrição" filterBy="#{custo.descricao}" style="width:30%">
                                    <h:outputText value="#{custo.descricao}" />
                                </p:column>
                                <p:column sortBy="#{custo.valor}" style="text-align:center;" headerText="Parcela" filterBy="#{custo.valor}">
                                    <h:outputText value="#{custo.valor}">
                                        <f:convertNumber currencySymbol="R$" type="currency" locale="#{lumeSecurity.locale}" />
                                    </h:outputText>
                                </p:column>
                            </p:dataTable>
                            <br />
                            <div class="Container16 Responsive100">
                                <p:commandButton id="fechar" icon="White fa fa-times" value="Fechar" oncomplete="PF('dlgCusto').hide();" process="@this" styleClass="RedButton" />
                            </div>
                        </div>
                    </p:dialog>

                    <h:panelGroup id="pnReservaParcial">
                        <p:dialog widgetVar="dlgReservaParcial">
                            <div class="Card">
                                <p:outputLabel for="valorParcial" value="Valor : " />
                                <p:inputNumber id="valorParcial" value="#{faturamentoMB.valorParcial}" required="true" maxlength="13" maxValue="9999999999.99" decimalSeparator="," symbol="R$ "
                                    thousandSeparator="." />
                                <br />
                                <div class="SeparatorFull"></div>
                                <div class="Container100 Responsive100">
                                    <p:commandButton icon="White fa fa-money" value="Reservar" actionListener="#{faturamentoMB.actionReservarParcial}" process="@this,valorParcial"
                                        styleClass="GreenButton" oncomplete="handleDialogRequest(xhr, status, args);" update=":lume:pnPrincipal"/>
                                </div>

                            </div>
                        </p:dialog>
                    </h:panelGroup>

                </div>
            </div>
        </div>
        <script type="text/javascript">
									function handleDialogRequest(xhr, status, args) {
										if (args.dlgReservaParcial == true) {
											PF('dlgReservaParcial').hide()
										}
									}
								</script>
    </ui:define>
</ui:composition>