<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets">

	<style>
.centerH {
	position: absolute;
	left: 50%;
	transform: translateX(-50%);
}

.hrSaldo {
	width: 90%;
	top: 50px;
}

hr.hrSaldo {
	border: 0;
	height: 0;
	border-top: 1px solid rgba(0, 0, 0, 0.1);
	border-bottom: 1px solid rgba(255, 255, 255, 0.3);
}

.divSaldo {
	width: 300px;
	height: 100px;
	background-color: white;
	text-align: center;
	line-height: 100px;
	font-size: 3rem;
	font-weight: bold;
}

.divSaldoHeader {
	width: 100%;
	height: 30px;
	line-height: 30px;
	text-align: center;
	font-size: 1rem;
	color: black !important;
	font-weight: normal !important;
}
</style>

	<ui:include src="faturaView.xhtml" />
	<p:remoteCommand name="onCloseFaturaView" process="@this" />

	<br />
	<div
		style="position: relative; width: 80%; height: 100px; display: flex; padding-left: 10%; padding-right: 10%;">
		<div style="position: relative; width: 50%; height: 100%;">
			<hr class="centerH hrSaldo" />
			<p:outputPanel style="color: #{pacienteFinanceiroMB.saldoCor}">
				<div class="centerH divSaldo">
					<div class="centerH divSaldoHeader">Saldo Atual</div>
					<h:outputText value="#{pacienteFinanceiroMB.paciente.conta.saldo}"
						rendered="#{pacienteFinanceiroMB.paciente.conta.saldo != null}">
						<f:convertNumber currencySymbol="R$ " type="currency" />
					</h:outputText>
					<h:outputText value="#{0.00}"
						rendered="#{pacienteFinanceiroMB.paciente.conta.saldo == null}">
						<f:convertNumber currencySymbol="R$ " type="currency" />
					</h:outputText>
				</div>
			</p:outputPanel>
		</div>
		<div style="position: relative; width: 50%; height: 100%;">
			<hr class="centerH hrSaldo" />
			<p:outputPanel style="color: #{pacienteFinanceiroMB.naoPlanejadoCor}">
				<div class="centerH divSaldo">
					<div class="centerH divSaldoHeader">Total não planejado</div>
					<h:outputText
						value="#{pacienteFinanceiroMB.paciente.dadosTabelaTotalNaoPlanejado}"
						rendered="#{pacienteFinanceiroMB.paciente.dadosTabelaTotalNaoPlanejado != null}">
						<f:convertNumber currencySymbol="R$ " type="currency" />
					</h:outputText>
					<h:outputText value="#{0.00}"
						rendered="#{pacienteFinanceiroMB.paciente.dadosTabelaTotalNaoPlanejado == null}">
						<f:convertNumber currencySymbol="R$ " type="currency" />
					</h:outputText>
				</div>
			</p:outputPanel>
		</div>
	</div>

	<p:dataTable id="dtContasAReceber" paginator="true"
		paginatorPosition="bottom" rows="10"
		emptyMessage="Nenhum lançamento a receber para o mês corrente."
		value="#{pacienteFinanceiroMB.lAReceber}" var="l" rowKey="#{l}">
		<f:facet name="header">Lançamentos a Receber</f:facet>
		<p:column headerText="Forma de pagamento" filterMatchMode="contains"
			filterBy="#{l.formaPagamentoStr}" sortBy="#{l.formaPagamentoStr}"
			width="20%">
			<h:outputText value="#{l.formaPagamentoStr}" />
		</p:column>
		<p:column headerText="Valor" filterMatchMode="contains"
			filterBy="#{l.valor}" sortBy="#{l.valor}" width="10%">
			<h:outputText value="#{l.valor}">
				<f:convertNumber type="currency" currencySymbol="R$"
					maxFractionDigits="2" />
			</h:outputText>
		</p:column>
		<p:column headerText="Data Pagamento" filterMatchMode="contains"
			filterBy="#{l.dataPagamento}" sortBy="#{l.dataPagamento}">
			<h:outputText value="#{l.dataPagamento}" width="15%">
				<f:convertDateTime pattern="dd/MM/yyyy" />
			</h:outputText>
		</p:column>
		<p:column headerText="Data Crédito" filterMatchMode="contains"
			filterBy="#{l.dataCredito}" sortBy="#{l.dataCredito}" width="15%">
			<h:outputText value="#{l.dataCredito}">
				<f:convertDateTime pattern="dd/MM/yyyy" />
			</h:outputText>
		</p:column>
		<p:column headerText="Validado?" filterMatchMode="contains"
			filterBy="#{l.validadoStr}" sortBy="#{l.validadoStr}" width="10%">
			<h:outputText value="#{l.validadoStr}" />
			<p:tooltip rendered="#{l.validado == 'S'}" for="@parent"
				value="Validado às #{l.dataValidadoStr} por #{l.validadoPorProfissional.dadosBasico.nome}" />
		</p:column>
		<p:column headerText="Status" filterMatchMode="contains"
			filterBy="#{l.status.descricao}" sortBy="#{l.status.descricao}"
			width="15%">
			<h:outputText value="#{l.status.descricao}" />
		</p:column>
		<p:column headerText="Origem" filterMatchMode="contains"
			filterBy="#{movimentacoesMB.getOrigemFromLancamento(l)}"
			sortBy="#{movimentacoesMB.getOrigemFromLancamento(l)}" width="15%">
			<p:commandLink process="@this" title="Visualizar Fatura"
				value="#{movimentacoesMB.getOrigemFromLancamento(l)}"
				actionListener="#{faturaPagtoMB.visualizaFatura(l.fatura)}"
				oncomplete="PF('dlgFaturaView').show();"
				update="@parent:@parent:@parent:pnlfaturaView, @parent:@parent:@parent:pnlfaturaViewHeader, @parent:@parent:@parent:buttonViewFatura" />
		</p:column>
	</p:dataTable>
	<br />
	<p:dataTable id="dtContasAPagar" paginator="true"
		paginatorPosition="bottom" rows="10"
		value="#{pacienteFinanceiroMB.lAPagar}" var="l" rowKey="#{l}"
		emptyMessage="Nenhum lançamento a pagar para o mês corrente.">
		<f:facet name="header">Lançamentos a Pagar</f:facet>
		<p:column headerText="Forma de pagamento" filterMatchMode="contains"
			filterBy="#{l.formaPagamentoStr}" sortBy="#{l.formaPagamentoStr}"
			width="20%">
			<h:outputText value="#{l.formaPagamentoStr}" />
		</p:column>
		<p:column headerText="Valor" filterMatchMode="contains"
			filterBy="#{l.valor}" sortBy="#{l.valor}" width="10%">
			<h:outputText value="#{l.valor}">
				<f:convertNumber type="currency" currencySymbol="R$"
					maxFractionDigits="2" />
			</h:outputText>
		</p:column>
		<p:column headerText="Data Pagamento" filterMatchMode="contains"
			filterBy="#{l.dataPagamento}" sortBy="#{l.dataPagamento}">
			<h:outputText value="#{l.dataPagamento}" width="15%">
				<f:convertDateTime pattern="dd/MM/yyyy" />
			</h:outputText>
		</p:column>
		<p:column headerText="Data Crédito" filterMatchMode="contains"
			filterBy="#{l.dataCredito}" sortBy="#{l.dataCredito}" width="15%">
			<h:outputText value="#{l.dataCredito}">
				<f:convertDateTime pattern="dd/MM/yyyy" />
			</h:outputText>
		</p:column>
		<p:column headerText="Validado?" filterMatchMode="contains"
			filterBy="#{l.validadoStr}" sortBy="#{l.validadoStr}" width="10%">
			<h:outputText value="#{l.validadoStr}" />
			<p:tooltip rendered="#{l.validado == 'S'}"
				value="Validado às #{l.dataValidadoStr} por #{l.validadoPorProfissional.dadosBasico.nome}" />
		</p:column>
		<p:column headerText="Status" filterMatchMode="contains"
			filterBy="#{l.status.descricao}" sortBy="#{l.status.descricao}"
			width="15%">
			<h:outputText value="#{l.status.descricao}" />
		</p:column>
		<p:column headerText="Origem" filterMatchMode="contains"
			filterBy="#{movimentacoesMB.getOrigemFromLancamento(l)}"
			sortBy="#{movimentacoesMB.getOrigemFromLancamento(l)}" width="15%">
			<p:commandLink process="@this" title="Visualizar Fatura"
				value="#{movimentacoesMB.getOrigemFromLancamento(l)}"
				actionListener="#{faturaPagtoMB.visualizaFatura(l.fatura)}"
				oncomplete="PF('dlgFaturaView').show();"
				update="@parent:@parent:@parent:pnlfaturaView, @parent:@parent:@parent:pnlfaturaViewHeader, @parent:@parent:@parent:buttonViewFatura" />
		</p:column>
	</p:dataTable>

	<p:separator styleClass="SeparatorFull" />

	<p:panelGrid columns="2" layout="grid"
		styleClass="ui-panelgrid-blank ui-fluid form-group removeSecondPadding"
		style="border:0px none; background-color:transparent;">

		<h:panelGroup>
			<p:splitButton icon="White fa fa fa-file-excel-o"
				value="Exportar tabela para Excel" styleClass="GreenSplitButton"
				actionListener="#{pacienteMB.exportarTabelaFinanceiro('xls')}"
				ajax="false"
				process=":lume:tabViewPacientePaciente:dtPrincipalFinanceiro, @this"
				update="@this" immediate="true"
				onclick="PrimeFaces.monitorDownload(function(){PF('loading').show();},function(){PF('loading').hide();});">

				<p:fileDownload value="#{pacienteMB.arquivoDownload}" />

				<p:menuitem value="Exportar tabela para PDF"
					icon="fa fa fa-file-pdf-o"
					actionListener="#{pacienteMB.exportarTabelaFinanceiro('pdf')}"
					ajax="false"
					process=":lume:tabViewPacientePaciente:dtPrincipalFinanceiro, @this"
					immediate="true"
					onclick="PrimeFaces.monitorDownload(function(){PF('loading').show();},function(){PF('loading').hide();});">
					<p:fileDownload value="#{pacienteMB.arquivoDownload}" />
				</p:menuitem>
			</p:splitButton>
		</h:panelGroup>

	</p:panelGrid>

	<p:dataTable filterDelay="1500" reflow="true" emptyMessage=""
		id="dtPrincipalFinanceiro" value="#{pacienteFinanceiroMB.entityList}"
		var="f" rows="10" paginator="true" rowKey="#{f}"
		paginatorPosition="bottom" binding="#{pacienteMB.tabelaFinanceiro}">
		<f:facet name="header">Faturas</f:facet>
		<p:column width="120" headerText="Detalhes">
			<p:commandButton icon="fa fa-eye" process="@this"
				actionListener="#{faturaPagtoMB.visualizaFatura(f)}"
				update="@parent:@parent:@parent:pnlfaturaView, @parent:@parent:@parent:pnlfaturaViewHeader, @parent:@parent:@parent:buttonViewFatura"
				onclick="PF('dlgFaturaView').show();" styleClass="NavyButton"
				title="Visualizar Fatura" />
		</p:column>
		<p:column filterBy="#{f.paciente.dadosBasico.nomeStr}"
			sortBy="#{f.paciente.dadosBasico.nome}" filterMatchMode="contains"
			filterFunction="#{pacienteMB.filtroSemAcento}">
			<f:facet name="header">
				<h:outputText value="Paciente" />
			</f:facet>
			<h:outputText value="#{f.paciente.dadosBasico.nome}" />
		</p:column>
		<p:column filterBy="#{f.dataCriacaoStr}" headerText="Data de Criação"
			filterMatchMode="contains" sortBy="#{f.dataCriacaoStr}">
			<h:outputText value="#{f.dataCriacaoStr}" />
		</p:column>

		<p:column filterBy="#{f.dadosTabelaRepasseTotalFatura}"
			headerText="Valor total da fatura" filterMatchMode="contains"
			sortBy="#{f.dadosTabelaRepasseTotalFatura}">
			<h:outputText value="#{f.dadosTabelaRepasseTotalFatura}">
				<f:convertNumber currencySymbol="R$ " type="currency" />
			</h:outputText>
		</p:column>

		<p:column filterBy="#{f.dadosTabelaRepasseTotalPago}"
			headerText="Valor total pago" filterMatchMode="contains"
			sortBy="#{f.dadosTabelaRepasseTotalPago}">
			<h:outputText value="#{f.dadosTabelaRepasseTotalPago}">
				<f:convertNumber currencySymbol="R$ " type="currency" />
			</h:outputText>
		</p:column>

		<p:column filterBy="#{f.dadosTabelaRepasseTotalNaoPago}"
			headerText="Valor total não pago" filterMatchMode="contains"
			sortBy="#{f.dadosTabelaRepasseTotalNaoPago}">
			<h:outputText value="#{f.dadosTabelaRepasseTotalNaoPago}">
				<f:convertNumber currencySymbol="R$ " type="currency" />
			</h:outputText>
		</p:column>

		<p:column filterBy="#{f.dadosTabelaRepasseTotalNaoPlanejado}"
			headerText="Valor total não planejado" filterMatchMode="contains"
			sortBy="#{f.dadosTabelaRepasseTotalNaoPlanejado}">
			<h:outputText value="#{f.dadosTabelaRepasseTotalNaoPlanejado}">
				<f:convertNumber currencySymbol="R$ " type="currency" />
			</h:outputText>
		</p:column>

		<p:column filterBy="#{f.statusFaturaCompleto}"
			headerText="Status da Fatura" filterMatchMode="contains"
			sortBy="#{f.statusFaturaCompleto}">
			<h:outputText value="#{f.statusFaturaCompleto}" />
		</p:column>

	</p:dataTable>

</ui:composition>