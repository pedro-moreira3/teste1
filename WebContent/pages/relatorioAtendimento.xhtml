<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://primefaces.org/ui" template="/WEB-INF/template.xhtml" xmlns:pe="http://primefaces.org/ui/extensions">
    <ui:define name="content">
        <style>
.ui-picklist .ui-picklist-list {
    height: 100px;
}

.fc-time-grid-container {
    height: auto !important;
}

.ui-growl {
    z-index: 999999 !important;
}

.ui-dialog {
    overflow: auto !important;
}

div.ui-selectoneradio label {
    width: auto !important;
}
</style>
        <script>
			function resize(dialog) {
			//'#lume\\:pnAgendamento'
				$(window).resize(function() {
					$(dialog).css({
						'width' : $(window).width(),
						'height' : $(window).height(),
						'left' : '0px',
						'top' : '0px'
					});
				}).resize();
			}
        </script>
        <div class="ui-g ui-fluid">
			<div class="ui-g-12 ui-lg-12">
				<div class="card card-w-title">
					<h1>Relatório de Atendimento</h1>
                    <p:separator styleClass="SeparatorFull" />
                    
                    <p:panelGrid		columns="3" layout="grid" styleClass="ui-panelgrid-blank ui-fluid form-group">
						<h:panelGroup>
							
							<p:outputLabel 	for="dataInicial" value="Data inicial:" />
        					<p:calendar 	id="dataInicial" value="#{relatorioAtendimentoMB.dataInicio}" />
        					
						</h:panelGroup>
        				
        				<h:panelGroup>
        					
        					<p:outputLabel 	for="dataFinal" value="Data final:" />
        					<p:calendar 	id="dataFinal" value="#{relatorioAtendimentoMB.dataFim}" />
        				
        				</h:panelGroup>
                    	
                    	<p:commandButton id="filtrarPorData" value="Filtrar" actionListener="#{relatorioAtendimentoMB.popularLista}" update="dtRelAtendimento"/>
                    
                    </p:panelGrid>
                    
                    <h:panelGroup>                    	
                    	<p:dataTable	id="dtRelAtendimento" widgetVar="dtRelAtendimento" value="#{relatorioAtendimentoMB.listaAtendimentos}" 
                    					var="atendimento" rowKey="#{atendimento}" rows="10" paginator="true" paginatorPosition="bottom" reflow="true" 
                    					emptyMessage="Nenhum registro encontrado" selection="#{relatorioAtendimentoMB.entity}" selectionMode="single" >
                    		
                    		<f:facet name="header">Relatório de atendimentos</f:facet>
                    		
                    		<p:column 	filterBy="#{atendimento.paciente.dadosBasico.nome}" sortBy="#{atendimento.paciente.dadosBasico.nome}" 
                    					filterMatchMode="contains" headerText="Paciente" width="30%">
                            	<h:outputText value="#{atendimento.paciente.dadosBasico.nome}" />
                        	</p:column>
                        	
                        	<p:column 	filterBy="#{atendimento.profissional.dadosBasico.nome}" sortBy="#{atendimento.profissional.dadosBasico.nome}" 
                        				filterMatchMode="contains" headerText="Profissional responsável" width="30%">
                            	<h:outputText value="#{atendimento.profissional.dadosBasico.nome}" />
                        	</p:column>
                        	
                        	<p:column 	filterBy="#{atendimento.statusAgendamento.descricao}" sortBy="#{atendimento.statusAgendamento.descricao}" 
                        				filterMatchMode="contains" headerText="Status" width="30%">
                            	<h:outputText value="#{atendimento.statusAgendamento.descricao}" />
                        	</p:column>
                        	
                        	<p:ajax event="rowSelect" oncomplete="PF('dlgRelAtendimento').show();" update=":lume:dlgRelAtendimento"/>
                        	
                    	</p:dataTable>
                    </h:panelGroup>
                    
                    <p:dialog	id="dlgRelAtendimento" widgetVar="dlgRelAtendimento" header="Paciente" modal="true"
                    			onHide="PF('dlgRelAtendimento').toggleMaximize();" onShow="PF('dlgRelAtendimento').toggleMaximize();">

                    	<p:fieldset		legend="Dados paciente" id="tgPaciente" toggleable="true" toggleSpeed="500"
                    					style="margin-top:20px;margin-bottom:10px;">
                    						
                    		<p:panelGrid	columns="3" layout="grid" styleClass="ui-panelgrid-blank ui-fluid form-group">
                    		    <h:panelGroup>
                    		    	<h:outputText	value="Paciente"/>
                    		    	<p:inputText	readonly="true" value="#{relatorioAtendimentoMB.entity.paciente.dadosBasico.nome}"/>
                    		    </h:panelGroup>
                    		    
                    		    <h:panelGroup>
                    		    	<h:outputText	value="Profissional responsável" />
                    		    	<p:inputText	readonly="true" value="#{relatorioAtendimentoMB.entity.profissional.dadosBasico.nome}"/>
                    		    </h:panelGroup>
                    		    
                    		    <h:panelGroup>
                    		    	<h:outputText	value="Convênio" />
                    		    	<p:inputText	readonly="true" value="#{relatorioAtendimentoMB.entity.paciente.convenio.dadosBasico.nome}"/>
                    		    </h:panelGroup>
                    		</p:panelGrid>
                    		
                    		<p:panelGrid	columns="3" layout="grid" styleClass="ui-panelgrid-blank ui-fluid form-group">
                    			<h:panelGroup>
                    		    	<h:outputText	value="Titular"/>
                    		    	<p:inputText	readonly="true" value="#{relatorioAtendimentoMB.entity.paciente.titular.dadosBasico.nome}"/>
                    		    </h:panelGroup>
                    		    
                    		    <h:panelGroup>
                    		    	<h:outputText	value="Plano" />
                    		    	<p:inputText	readonly="true" value="#{relatorioAtendimentoMB.entity.paciente.plano.nome}"/>
                    		    </h:panelGroup>
                    		    
                    		    <h:panelGroup>
                    		    	<h:outputText	value="Data da última alteração" />
                    		    	<p:calendar		readonly="true" value="#{relatorioAtendimentoMB.entity.paciente.dataUltimaAlteracao}"/>
                    		    </h:panelGroup>
                    		</p:panelGrid>
                    		
                    	</p:fieldset>
                    	
                    	<p:fieldset		legend="Plano de tratamento" id="tgPlano" toggleable="true" toggleSpeed="400"
                    					style="margin-top:20px;margin-bottom:10px">
                    						
                    		<p:panelGrid	columns="3" layout="grid" styleClass="ui-panelgrid-blank ui-fluid form-group">
                    		    <h:panelGroup>
                    		    	<h:outputText	value="Inicio do tratamento"/>
                    		    	<p:calendar		readonly="true" value="#{relatorioAtendimentoMB.entity.planoTratamento.inicio}"/>
                    		    </h:panelGroup>
                    		    
                    		    <h:panelGroup>
                    		    	<h:outputText	value="Término do tramento" />
                    		    	<p:calendar		readonly="true" value="#{relatorioAtendimentoMB.entity.planoTratamento.fim}"/>
                    		    </h:panelGroup>
                    		    
                    		    <h:panelGroup>
                    		    	<h:outputText	value="Valor total" />
                    		    	<p:inputText	readonly="true" value="R$ #{relatorioAtendimentoMB.entity.planoTratamento.valorTotal}"/>
                    		    </h:panelGroup>
                    		</p:panelGrid>
                    		
                    		<p:panelGrid	columns="3" layout="grid" styleClass="ui-panelgrid-blank ui-fluid form-group">
                    			<h:panelGroup>
                    		    	<h:outputText	value="Valor total do desconto"/>
                    		    	<p:inputText	readonly="true" value="R$ #{relatorioAtendimentoMB.entity.planoTratamento.valorTotalDesconto}"/>
                    		    </h:panelGroup>
                    		    
                    		    <h:panelGroup>
                    		    	<h:outputText	value="Plano" />
                    		    	<p:inputText	readonly="true" value="#{relatorioAtendimentoMB.entity.paciente.plano.nome}"/>
                    		    </h:panelGroup>                    		
                    		</p:panelGrid>
                    		
                    		<h:panelGroup>
                    				<p:dataTable	id="dtProcedimentos" widgetVar="dtProcedimentos" 
                    								value="#{relatorioAtendimentoMB.entity.planoTratamento.planoTratamentoProcedimentos}" 
                    								var="procedimento" rowKey="#{procedimento}" rows="5" paginator="true" paginatorPosition="bottom" 
                    								reflow="true" emptyMessage="Nenhum registro encontrado" selectionMode="single" >
                    								
                    					<f:facet	name="procedimentos">Procedimentos</f:facet>
                    								
                    					<p:column 	filterBy="#{procedimento.procedimento.descricao}" 
                    								sortBy="#{procedimento.procedimento.descricao}" 
                        							filterMatchMode="contains" headerText="Descrição" width="30%">
                            				<h:outputText value="#{procedimento.procedimento.descricao}" />
                        				</p:column>
                        							
                        				<p:column 	filterBy="#{procedimento.procedimento.valor}" 
                    								sortBy="#{procedimento.procedimento.valor}" 
                        							filterMatchMode="contains" headerText="Valor" width="30%">
                            				<h:outputText value="#{procedimento.procedimento.valor}" />
                        				</p:column>
                    								
                    				</p:dataTable>
                    		</h:panelGroup>
                    	</p:fieldset>                    		
                    </p:dialog>
                    
                </div>
            </div>
        </div> 
        
        <script type="text/javascript">
			function handleDialogRequest(xhr, status, args) {
				console.debug('handleDialogRequest');
				console.debug(args);
				if (args.dlg == true) {
					PF('eventDialog').hide();
				} else {
					window.scrollTo(0, 0);
				}
			}
		</script>
        
    </ui:define>
</ui:composition>