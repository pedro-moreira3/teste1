<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" template="/WEB-INF/template.xhtml"
	xmlns:pe="http://primefaces.org/ui/extensions">
	<ui:define name="content">

		<p:outputPanel id="pnlAtualizacaoFaturaView">
			<ui:include src="#{faturaPagtoMB.faturaViewImportName}" />
		</p:outputPanel>
		<p:remoteCommand name="onCloseFaturaView" process="@this" />

		<div class="ui-g ui-fluid">
			<div class="ui-g-12 ui-lg-12">
				<div class="card card-w-title">
					<h1>Movimentações</h1>
					<div class="SeparatorFull"></div>
					<br />

					<p:tabView style="padding: 10px; padding-top: 0px;"
						id="tabViewMovimentacoes">

						<p:ajax event="tabChange"
							listener="#{movimentacoesMB.onTabChange}"
							update=":lume:tabViewMovimentacoes" />

						<p:tab title="Contas a Receber">

							<p:outputPanel style="padding-top: 10px;">
								<p:fieldset collapsed="true" toggleable="true" legend="Filtros">
									<p:panelGrid columns="3" layout="grid" id="filtrosAReceber"
										columnClasses="ui-g-6, ui-g-3, ui-g-3"
										styleClass="ui-panelgrid-blank form-group ui-fluid removeSideGridPadding">

										<h:panelGroup styleClass="md-combo">
											<h:outputText for="filtroPeriodoAReceber"
												value="Período da Data de crédito:" />
											<p:selectOneMenu id="filtroPeriodoAReceber"
												value="#{movimentacoesMB.periodoBuscaAReceber}"
												converter="enumPeriodoBusca">
												<p:ajax process="@this" update="inicioAReceber, fimAReceber"
													listener="#{movimentacoesMB.actionTrocaDatasAReceber}" />
												<f:selectItems value="#{padroesTelaMB.periodosDataBusca}"
													var="periodo" itemValue="#{periodo}"
													itemLabel="#{periodo.descricao}" />
											</p:selectOneMenu>
										</h:panelGroup>

										<h:panelGroup styleClass="md-inputfield taller">
											<h:outputText for="inicioAReceber"
												value="Data de crédito de:" />
											<p:calendar id="inicioAReceber"
												value="#{movimentacoesMB.dataInicioAReceber}" />
										</h:panelGroup>

										<h:panelGroup styleClass="md-inputfield taller">
											<h:outputText for="fimAReceber" value="Data de crédito até:" />
											<p:calendar id="fimAReceber"
												value="#{movimentacoesMB.dataFimAReceber}" />
										</h:panelGroup>

										<h:panelGroup styleClass="md-inputfield taller">
											<h:outputText for="filtroPaciente" value="Paciente:" />
											<p:autoComplete id="filtroPaciente"
												value="#{movimentacoesMB.paciente}"
												style="margin-top: 10px !important"
												completeMethod="#{movimentacoesMB.sugestoesPacientes}"
												var="p" itemLabel="#{p.dadosBasico.nome}" itemValue="#{p}"
												converter="paciente" forceSelection="true"
												scrollHeight="400" minQueryLength="3" queryDelay="1000">

												<p:column headerText="Código" style="text-align: center;">
													<h:outputText value="#{p.codigo}" />
												</p:column>
												<p:column headerText="Nome">
													<h:outputText value="#{p.dadosBasico.nome}" />
												</p:column>
												<p:column headerText="Celular">
													<h:outputText value="#{p.dadosBasico.celular}" />
												</p:column>
												<p:column headerText="Nome da Mãe">
													<h:outputText value="#{p.nomeMae}" />
												</p:column>

											</p:autoComplete>
										</h:panelGroup>

										<h:panelGroup styleClass="lumeField">
											<p:outputLabel for="statusRecebimentoAReceber"
												value="Status do recebimento: " />
											<p:selectOneMenu id="statusRecebimentoAReceber"
												style="top: -10px;"
												value="#{movimentacoesMB.statusLancamentoAReceber}"
												converter="enumStatusLancamento">
												<f:selectItem itemValue="#{null}" itemLabel="Todos" />
												<f:selectItems
													value="#{movimentacoesMB.listaStatusLancamentoAReceber}"
													var="status" itemLabel="#{status.descricao}"
													itemValue="#{status}" />
												<p:ajax
													listener="#{movimentacoesMB.alteraStatusLancamentoAReceber}"
													update="subStatusRecebimentoAReceber" />
											</p:selectOneMenu>
										</h:panelGroup>

										<h:panelGroup styleClass="lumeField">
											<p:outputLabel for="subStatusRecebimentoAReceber"
												value="Sub Status do recebimento: " />
											<p:selectCheckboxMenu id="subStatusRecebimentoAReceber"
												label="Sub Status" multiple="true" style="top: -4px;"
												value="#{movimentacoesMB.subStatusLancamentoAReceber}"
												converter="enumSubStatusLancamento">
												<f:selectItems
													value="#{movimentacoesMB.listaSubStatusLancamentoAReceber}"
													var="substatus" itemLabel="#{substatus.descricao}"
													itemValue="#{substatus}" />
											</p:selectCheckboxMenu>
										</h:panelGroup>

									</p:panelGrid>

									<p:panelGrid columns="4" layout="grid"
										styleClass="ui-panelgrid-blank form-group ui-fluid removeSideGridPadding">

										<p:commandButton value="Pesquisar" styleClass="GreenButton"
											actionListener="#{movimentacoesMB.carregaListaAReceber}"
											process="@this, :lume:tabViewMovimentacoes:filtrosAReceber"
											update=":lume:tabViewMovimentacoes:dtContasAReceber" />

									</p:panelGrid>
								</p:fieldset>
							</p:outputPanel>

							<br />

							<p:dataTable id="dtContasAReceber" paginator="true"
								paginatorPosition="bottom" rows="10"
								emptyMessage="Nenhum lançamento a receber para o mês corrente."
								value="#{movimentacoesMB.aReceber}" var="l" rowKey="#{l}">
								<f:facet name="header">Lançamentos a Receber</f:facet>
								<p:column headerText="Informação de origem"
									filterBy="#{movimentacoesMB.getFaturaInfo(l.fatura)}"
									sortBy="#{movimentacoesMB.getFaturaInfo(l.fatura)}"
									filterMatchMode="contains" width="16%">
									<h:outputText
										value="#{movimentacoesMB.getFaturaInfo(l.fatura)}" />
								</p:column>
								<p:column headerText="Forma de pagamento"
									filterMatchMode="contains" filterBy="#{l.formaPagamentoStr}"
									sortBy="#{l.formaPagamentoStr}" width="15%">
									<h:outputText value="#{l.formaPagamentoStr}" />
								</p:column>
								<p:column headerText="Valor" filterMatchMode="contains"
									filterBy="#{l.valor}" sortBy="#{l.valor}" width="10%">
									<h:outputText value="#{l.valor}">
										<f:convertNumber type="currency" currencySymbol="R$"
											maxFractionDigits="2" />
									</h:outputText>
									<f:facet name="footer">
										<h:outputText value="Total " />
										<h:outputText value="#{movimentacoesMB.somaTotalAReceber}">
											<f:convertNumber currencySymbol="R$" type="currency"
												minFractionDigits="2" />
										</h:outputText>
									</f:facet>
								</p:column>
								<p:column headerText="Data Pagamento" filterMatchMode="contains"
									filterBy="#{l.dataPagamento}" sortBy="#{l.dataPagamento}">
									<h:outputText value="#{l.dataPagamento}" width="12%">
										<f:convertDateTime pattern="dd/MM/yyyy" />
									</h:outputText>
								</p:column>
								<p:column headerText="Data Crédito" filterMatchMode="contains"
									filterBy="#{l.dataCredito}" sortBy="#{l.dataCredito}"
									width="12%">
									<h:outputText value="#{l.dataCredito}">
										<f:convertDateTime pattern="dd/MM/yyyy" />
									</h:outputText>
								</p:column>
								<p:column headerText="Validado?" filterMatchMode="contains"
									filterBy="#{l.validadoStr}" sortBy="#{l.validadoStr}"
									width="10%">
									<h:outputText value="#{l.validadoStr}" />
									<p:tooltip rendered="#{l.validado == 'S'}" for="@parent"
										value="Validado às #{l.dataValidadoStr} por #{l.validadoPorProfissional.dadosBasico.nome}" />
								</p:column>
								<p:column headerText="Status" filterMatchMode="contains"
									filterBy="#{l.statusCompleto}" sortBy="#{l.statusCompleto}"
									width="10%">
									<h:outputText value="#{l.statusCompleto}" />
								</p:column>
								<p:column headerText="Origem" filterMatchMode="contains"
									filterBy="#{movimentacoesMB.getOrigemFromLancamento(l)}"
									sortBy="#{movimentacoesMB.getOrigemFromLancamento(l)}"
									width="15%">
									<p:commandLink process="@this" title="Visualizar Fatura"
										value="#{movimentacoesMB.getOrigemFromLancamento(l)}"
										actionListener="#{faturaPagtoMB.visualizaFatura(l.fatura)}"
										oncomplete="PF('dlgFaturaView').show();"
										update=":lume:pnlAtualizacaoFaturaView, :lume:pnlfaturaView, :lume:pnlfaturaViewHeader, :lume:buttonViewFatura" />
								</p:column>
							</p:dataTable>

						</p:tab>
						<p:tab title="Contas a Pagar">

							<p:outputPanel style="padding-top: 10px;">
								<p:fieldset collapsed="true" toggleable="true" legend="Filtros">
									<p:panelGrid columns="3" layout="grid" id="filtrosAPagar"
										columnClasses="ui-g-6, ui-g-3, ui-g-3"
										styleClass="ui-panelgrid-blank form-group ui-fluid removeSideGridPadding">

										<h:panelGroup styleClass="md-combo">
											<h:outputText for="filtroPeriodoAPagar"
												value="Período da Data de Crédito:" />
											<p:selectOneMenu id="filtroPeriodoAPagar"
												value="#{movimentacoesMB.periodoBuscaAPagar}"
												converter="enumPeriodoBusca">
												<p:ajax process="@this" update="inicioAPagar, fimAPagar"
													listener="#{movimentacoesMB.actionTrocaDatasAPagar}" />
												<f:selectItems value="#{padroesTelaMB.periodosDataBusca}"
													var="periodo" itemValue="#{periodo}"
													itemLabel="#{periodo.descricao}" />
											</p:selectOneMenu>
										</h:panelGroup>

										<h:panelGroup styleClass="md-inputfield taller">
											<h:outputText for="inicioAPagar" value="Data de crédito de:" />
											<p:calendar id="inicioAPagar"
												value="#{movimentacoesMB.dataInicioAPagar}" />
										</h:panelGroup>

										<h:panelGroup styleClass="md-inputfield taller">
											<h:outputText for="fimAPagar" value="Data de crédito até:" />
											<p:calendar id="fimAPagar"
												value="#{movimentacoesMB.dataFimAPagar}" />
										</h:panelGroup>

										<h:panelGroup styleClass="md-inputfield taller">
											<h:outputText for="filtroProfissional" value="Profissional:" />
											<p:autoComplete dropdown="true" queryDelay="1000" size="35"
												value="#{movimentacoesMB.profissional}"
												style="margin-top: 10px !important" id="filtroProfissional"
												minQueryLength="3"
												completeMethod="#{movimentacoesMB.geraSugestoesProfissional}"
												var="profissional"
												itemLabel="#{profissional.dadosBasico.prefixoNome}"
												itemValue="#{profissional}" converter="profissional"
												forceSelection="true">
											</p:autoComplete>
										</h:panelGroup>

										<h:panelGroup styleClass="lumeField">
											<p:outputLabel for="statusRecebimentoAPagar"
												value="Status do pagamento: " />
											<p:selectOneMenu id="statusRecebimentoAPagar"
												style="top: -10px;"
												value="#{movimentacoesMB.statusLancamentoAPagar}"
												converter="enumStatusLancamento">
												<f:selectItems
													value="#{movimentacoesMB.listaStatusLancamentoAPagar}"
													var="status" itemLabel="#{status.descricao}"
													itemValue="#{status}" />
												<p:ajax
													listener="#{movimentacoesMB.alteraStatusLancamentoAPagar}"
													update="subStatusRecebimentoAPagar" />
											</p:selectOneMenu>
										</h:panelGroup>

										<h:panelGroup styleClass="lumeField">
											<p:outputLabel for="subStatusRecebimentoAPagar"
												value="Sub Status do pagamento: " />
											<p:selectCheckboxMenu id="subStatusRecebimentoAPagar"
												label="Sub Status" multiple="true" style="top: -4px;"
												value="#{movimentacoesMB.subStatusLancamentoAPagar}"
												converter="enumSubStatusLancamento">
												<f:selectItems
													value="#{movimentacoesMB.listaSubStatusLancamentoAPagar}"
													var="substatus" itemLabel="#{substatus.descricao}"
													itemValue="#{substatus}" />
											</p:selectCheckboxMenu>
										</h:panelGroup>

									</p:panelGrid>

									<p:panelGrid columns="4" layout="grid"
										styleClass="ui-panelgrid-blank form-group ui-fluid removeSideGridPadding">

										<p:commandButton value="Pesquisar" styleClass="GreenButton"
											actionListener="#{movimentacoesMB.carregaListaAPagar}"
											process="@this, :lume:tabViewMovimentacoes:filtrosAPagar"
											update=":lume:tabViewMovimentacoes:dtContasAPagar" />

									</p:panelGrid>
								</p:fieldset>
							</p:outputPanel>

							<br />

							<p:dataTable id="dtContasAPagar" paginator="true"
								paginatorPosition="bottom" rows="10"
								emptyMessage="Nenhum lançamento a pagar para o mês corrente."
								value="#{movimentacoesMB.aPagar}" var="l" rowKey="#{l}">
								<f:facet name="header">Lançamentos a Pagar</f:facet>
								<p:column headerText="Informação de origem"
									filterBy="#{movimentacoesMB.getFaturaInfo(l.fatura)}"
									sortBy="#{movimentacoesMB.getFaturaInfo(l.fatura)}"
									filterMatchMode="contains" width="16%">
									<h:outputText
										value="#{movimentacoesMB.getFaturaInfo(l.fatura)}" />
								</p:column>
								<p:column headerText="Forma de pagamento"
									filterMatchMode="contains" filterBy="#{l.formaPagamentoStr}"
									sortBy="#{l.formaPagamentoStr}" width="15%">
									<h:outputText value="#{l.formaPagamentoStr}" />
								</p:column>
								<p:column headerText="Valor" filterMatchMode="contains"
									filterBy="#{l.valor}" sortBy="#{l.valor}" width="10%">
									<h:outputText value="#{l.valor}">
										<f:convertNumber type="currency" currencySymbol="R$"
											maxFractionDigits="2" />
									</h:outputText>
									<f:facet name="footer">
										<h:outputText value="Total " />
										<h:outputText value="#{movimentacoesMB.somaTotalAPagar}">
											<f:convertNumber currencySymbol="R$" type="currency"
												minFractionDigits="2" />
										</h:outputText>
									</f:facet>
								</p:column>
								<p:column headerText="Data Pagamento" filterMatchMode="contains"
									filterBy="#{l.dataPagamento}" sortBy="#{l.dataPagamento}">
									<h:outputText value="#{l.dataPagamento}" width="12%">
										<f:convertDateTime pattern="dd/MM/yyyy" />
									</h:outputText>
								</p:column>
								<p:column headerText="Data Crédito" filterMatchMode="contains"
									filterBy="#{l.dataCredito}" sortBy="#{l.dataCredito}"
									width="12%">
									<h:outputText value="#{l.dataCredito}">
										<f:convertDateTime pattern="dd/MM/yyyy" />
									</h:outputText>
								</p:column>
								<p:column headerText="Validado?" filterMatchMode="contains"
									filterBy="#{l.validadoStr}" sortBy="#{l.validadoStr}"
									width="10%">
									<h:outputText value="#{l.validadoStr}" />
									<p:tooltip rendered="#{l.validado == 'S'}"
										value="Validado às #{l.dataValidadoStr} por #{l.validadoPorProfissional.dadosBasico.nome}" />
								</p:column>
								<p:column headerText="Status" filterMatchMode="contains"
									filterBy="#{l.statusCompleto}" sortBy="#{l.statusCompleto}"
									width="10%">
									<h:outputText value="#{l.statusCompleto}" />
								</p:column>
								<p:column headerText="Origem" filterMatchMode="contains"
									filterBy="#{movimentacoesMB.getOrigemFromLancamento(l)}"
									sortBy="#{movimentacoesMB.getOrigemFromLancamento(l)}"
									width="15%">
									<p:commandLink process="@this" title="Visualizar Fatura"
										value="#{movimentacoesMB.getOrigemFromLancamento(l)}"
										actionListener="#{faturaPagtoMB.visualizaFatura(l.fatura)}"
										oncomplete="PF('dlgFaturaView').show();"
										update=":lume:pnlAtualizacaoFaturaView, :lume:pnlfaturaView, :lume:pnlfaturaViewHeader, :lume:buttonViewFatura" />
								</p:column>
							</p:dataTable>

						</p:tab>
					</p:tabView>

					<br />

					<p:poll interval="5" update="@this, :lume:movimentacoesChart"
						stop="#{movimentacoesMB.graficoCompleto}" process="@this" />
					<p:outputPanel style="width: 100%;" id="movimentacoesChart">
						<p:barChart model="#{movimentacoesMB.lineModel}"
							style="width: 100%; height: 300px;"
							rendered="#{movimentacoesMB.graficoCompleto}" />
						<p:graphicImage value="/images/loading.gif"
							style="width: 100%: max-height: 300px; margin-left: 50%; transform: translateX(-50%);"
							rendered="#{!movimentacoesMB.graficoCompleto}" />
					</p:outputPanel>

				</div>
			</div>
		</div>
	</ui:define>
</ui:composition>