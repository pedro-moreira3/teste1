<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://primefaces.org/ui" template="/WEB-INF/template.xhtml" xmlns:pe="http://primefaces.org/ui/extensions">
    <ui:define name="content">
        <div class="ui-g ui-fluid">
			<div class="ui-g-12 ui-lg-12">
				<div class="card card-w-title">
                    <p:outputPanel styleClass="BordNone">

                        <h1>Empréstimo de Kits</h1>
                        <div class="SeparatorFull"></div>

                        <p:fieldset legend="Kits">

                            <p:dataTable filterDelay="1500"  reflow="true" emptyMessage="" id="dtKitsPendentes" value="#{controleMaterialMB.kitsPendentes}" var="reservaKit" rows="7" paginator="true"
                                selection="#{controleMaterialMB.reservaKit}" selectionMode="single" rowKey="#{reservaKit}" paginatorPosition="bottom">
                                <f:facet name="header">Kits Pendentes</f:facet>
                                <p:ajax event="rowSelect" listener="#{controleMaterialMB.limpaMateriais}"
                                    update=":lume:dtMateriaisDisponiveis, :lume:disponibiliza, :lume:dtItensPendentes, :lume:dtKitsPendentes, :lume:entregar,:lume:naoUtilizado" process="@this" />
                                <p:column filterBy="#{reservaKit.reserva.descricao}" sortBy="#{reservaKit.reserva.descricao}" filterMatchMode="contains" headerText="Reserva">
                                    <h:outputText value="#{reservaKit.reserva.descricao}" title="#{reservaKit.id}" />
                                </p:column>
                                <p:column filterBy="#{reservaKit.disponiblizado}" sortBy="#{reservaKit.disponiblizado}" filterMatchMode="contains" headerText="Disponibilizado?">
                                    <h:outputText value="#{reservaKit.disponiblizado == true ? 'Sim' : 'Não'}" />
                                </p:column>
                                <p:column filterBy="#{reservaKit.reserva.prazoStr}" sortBy="#{reservaKit.reserva.prazoStrOrd}" filterMatchMode="contains" headerText="Data da Utilização">
                                    <h:outputText value="#{reservaKit.reserva.prazoStr}" />
                                </p:column>
                                <p:column filterBy="#{reservaKit.reserva.observacao}" sortBy="#{reservaKit.reserva.observacao}" filterMatchMode="contains" headerText="Observações">
                                    <h:outputText value="#{reservaKit.reserva.observacao}" />
                                </p:column>
                                <p:column filterBy="#{reservaKit.kit.descricao}" sortBy="#{reservaKit.kit.descricao}" filterMatchMode="contains" headerText="Descrição">
                                    <h:outputText value="#{reservaKit.kit.descricao}" />
                                </p:column>
                                <p:column filterBy="#{reservaKit.kit.tipo}" sortBy="#{reservaKit.kit.tipo}" filterMatchMode="contains" headerText="Tipo do Kit">
                                    <h:outputText value="#{reservaKit.kit.tipo}" />
                                </p:column>
                                <p:column filterBy="#{reservaKit.reserva.profissional.dadosBasico.prefixoNome}" sortBy="#{reservaKit.reserva.profissional.dadosBasico.prefixoNome}"
                                    filterMatchMode="contains" headerText="Profissional">
                                    <h:outputText value="#{reservaKit.reserva.profissional.dadosBasico.prefixoNome}" />
                                </p:column>
                                <p:column filterBy="#{reservaKit.reserva.agendamento.paciente.dadosBasico.prefixoNome}" sortBy="#{reservaKit.reserva.agendamento.paciente.dadosBasico.prefixoNome}"
                                    filterMatchMode="contains" headerText="#{dominioMB.cliente}">
                                    <h:outputText value="#{reservaKit.reserva.agendamento.paciente.dadosBasico.prefixoNome}" />
                                </p:column>
                                <p:column filterBy="#{reservaKit.reserva.agendamento.inicioStr}" sortBy="#{reservaKit.reserva.agendamento.inicio}" filterMatchMode="contains" headerText="Agendamento">
                                    <h:outputText value="#{reservaKit.reserva.agendamento.inicioStr}" />
                                </p:column>
                                <p:column filterBy="#{reservaKit.quantidade}" sortBy="#{reservaKit.quantidade}" filterMatchMode="contains" headerText="Quantidade">
                                    <h:outputText value="#{reservaKit.quantidade}" />
                                </p:column>
                                <p:column headerText="Disponibilizados">
                                    <p:commandButton icon="White fa fa-search" oncomplete="PF('dlgDisponibilizados').show();" update=":lume:dtDisponibilizados" process="@this"
                                        actionListener="#{controleMaterialMB.carregarItensDisponibilizados(reservaKit)}" style="width: 33px !important" />
                                </p:column>
                            </p:dataTable>
                        </p:fieldset>
                        <br />
                        <p:fieldset legend="Materiais">
                            <p:dataTable filterDelay="1500"  reflow="true" emptyMessage="" id="dtItensPendentes" value="#{controleMaterialMB.kitItensPendentes}" var="kitItemSelecionado" rows="7" paginator="true"
                                selection="#{controleMaterialMB.kitItemSelecionado}" selectionMode="single" rowKey="#{kitItemSelecionado}" paginatorPosition="bottom">
                                <p:ajax event="rowSelect" update=":lume:dtMateriaisDisponiveis, :lume:dtItensPendentes, :lume:disponibiliza" listener="#{controleMaterialMB.carregaItem}"
                                    process="@this" />
                                <f:facet name="header">Itens Pendentes</f:facet>
                                <p:column filterBy="#{kitItemSelecionado.item.descricaoLimpa}" sortBy="#{kitItemSelecionado.item.descricao}" filterMatchMode="contains" headerText="Descrição">
                                    <h:outputText value="#{kitItemSelecionado.item.descricao}" title="#{kitItemSelecionado.id}" />
                                </p:column>
                                <p:column filterBy="#{kitItemSelecionado.quantidade * controleMaterialMB.quantidadeReservaKit}"
                                    sortBy="#{kitItemSelecionado.quantidade * controleMaterialMB.quantidadeReservaKit}" filterMatchMode="contains" headerText="Quantidade">
                                    <h:outputText value="#{kitItemSelecionado.quantidade * controleMaterialMB.quantidadeReservaKit}" />
                                    <h:outputText value="#{controleMaterialMB.getUnidadeString(kitItemSelecionado.item)}" styleClass="unidadeMedidaString" />
                                </p:column>
                            </p:dataTable>
                            <br />

                            <p:dataTable filterDelay="1500"  reflow="true" emptyMessage=" " id="dtMateriaisDisponiveis" value="#{controleMaterialMB.materiaisDisponiveis}" var="materiaisSelecionado" rows="7"
                                paginator="true" selection="#{controleMaterialMB.materiaisSelecionado}" paginatorPosition="bottom" rowKey="#{materiaisSelecionado.id}">

                                <p:ajax event="rowSelect" update=":lume:disponibiliza,:lume:dtMateriaisDisponiveis" listener="#{controleMaterialMB.actionVerificaDisponibiliza}" />
                                <p:ajax event="rowSelectCheckbox" update=":lume:disponibiliza,:lume:dtMateriaisDisponiveis" listener="#{controleMaterialMB.actionVerificaDisponibiliza}" />
                                <p:ajax event="rowUnselectCheckbox" update=":lume:disponibiliza,:lume:dtMateriaisDisponiveis" listener="#{controleMaterialMB.actionVerificaDisponibiliza}" />
                                <p:ajax event="toggleSelect" update=":lume:disponibiliza,:lume:dtMateriaisDisponiveis" listener="#{controleMaterialMB.actionVerificaDisponibiliza}" />

                                <p:column selectionMode="multiple" style="width:16px;text-align:center" />

                                <f:facet name="header">Materiais Disponíveis</f:facet>
                                <p:column filterBy="#{materiaisSelecionado.item.descricaoLimpa}" sortBy="#{materiaisSelecionado.item.descricao}" filterMatchMode="contains" headerText="Descrição">
                                    <h:outputText value="#{materiaisSelecionado.item.descricao}" title="#{materiaisSelecionado.id}" />
                                </p:column>
                                <p:column filterBy="#{materiaisSelecionado.quantidadeAtual}" sortBy="#{materiaisSelecionado.quantidadeAtual}" filterMatchMode="contains" headerText="Quantidade Atual">
                                    <h:outputText value="#{materiaisSelecionado.quantidadeAtual}">
                                        <f:convertNumber />
                                    </h:outputText>
                                    <h:outputText value="#{controleMaterialMB.getUnidadeString(materiaisSelecionado.item)}" styleClass="unidadeMedidaString" />
                                </p:column>
                                <p:column filterBy="#{materiaisSelecionado.marca.nome}" sortBy="#{materiaisSelecionado.marca.nome}" filterMatchMode="contains" headerText="Marca">
                                    <h:outputText value="#{materiaisSelecionado.marca.nome}" />
                                </p:column>
                                <p:column filterBy="#{materiaisSelecionado.lote}" sortBy="#{materiaisSelecionado.lote}" filterMatchMode="contains" headerText="Lote">
                                    <h:outputText value="#{materiaisSelecionado.lote}" />
                                </p:column>
                                <p:column filterBy="#{materiaisSelecionado.dataValidadeStr}" sortBy="#{materiaisSelecionado.dataValidade}" filterMatchMode="contains" headerText="Validade">
                                    <h:outputText value="#{materiaisSelecionado.dataValidadeStr}" />
                                </p:column>
                                <p:column filterBy="#{materiaisSelecionado.local.descricao}" sortBy="#{materiaisSelecionado.local.descricao}" filterMatchMode="contains" headerText="Localização">
                                    <h:outputText value="#{materiaisSelecionado.local.descricao}"/>
                               </p:column>
                            </p:dataTable>
                            <br />
                            <div class="SeparatorFull"></div>
                            <p:panelGrid columns="4" layout="grid"
								styleClass="ui-panelgrid-blank form-group ui-fluid">
                                <p:commandButton id="disponibiliza" icon="White fa fa-mail-forward" value="Disponibilizar" actionListener="#{controleMaterialMB.actionDisponibilizar}"
                                    disabled="#{!controleMaterialMB.enableDisponibilizar}"
                                    update=":lume:dtMateriaisDisponiveis, :lume:dtItensPendentes, :lume:dtKitsPendentes, :lume:disponibiliza , :lume:entregar,:lume:naoUtilizado"
                                    process=":lume:dtMateriaisDisponiveis, @this" styleClass="GreenButton" />
                                <p:commandButton id="entregar" icon="White fa fa-sign-out" value="Entregar" disabled="#{!controleMaterialMB.enableEntregar}"
                                    actionListener="#{controleMaterialMB.actionEntregar}"
                                    update=":lume:dtMateriaisDisponiveis,:lume:dtItensPendentes,:lume:dtKitsPendentes,:lume:disponibiliza,:lume:entregar,:lume:naoUtilizado"
                                    process=":lume:dtMateriaisDisponiveis, @this" />
                                <p:commandButton id="naoUtilizado" icon="White fa fa-times-circle" value="Cancelar" onclick="PF('dlg').show();" disabled="#{controleMaterialMB.reservaKit.id == null}"
                                    styleClass="RedButton" />
                            </p:panelGrid>
                        </p:fieldset>
                        <p:dialog id="dlg" widgetVar="dlg" header="Cancelar" responsive="true" modal="true">
                            <h:panelGroup styleClass="lumeField">
                                <p:outputLabel for="justificativa" value="Justificativa : " />
                                <p:selectOneMenu id="justificativa" value="#{controleMaterialMB.justificativa}" converter="dominio">
                                    <f:selectItem itemValue="#{null}" itemLabel="Selecione uma justificativa" />
                                    <f:selectItems value="#{controleMaterialMB.justificativas}" var="justificativa" itemLabel="#{justificativa.nome}" itemValue="#{justificativa}" />
                                </p:selectOneMenu>
                            </h:panelGroup>
                            <div class="SeparatorFull"></div>
                            <p:commandButton id="persist" icon="White fa fa-save" value="Salvar" actionListener="#{controleMaterialMB.actionCancela}"
                                update=":lume:dtMateriaisDisponiveis,:lume:dtItensPendentes,:lume:dtKitsPendentes,:lume:disponibiliza,:lume:entregar,:lume:naoUtilizado" process="@this,justificativa"
                                oncomplete="PF('dlg').hide();" />
                        </p:dialog>
                    </p:outputPanel>
                </div>
            </div>
        </div>
        <h:panelGroup id="pgDisponibilizados">
            <p:dialog id="dlgDisponibilizados" widgetVar="dlgDisponibilizados" header="Disponibilizados" modal="true" width="90%">
                <p:dataTable filterDelay="1500"  id="dtDisponibilizados" reflow="true" emptyMessage="" value="#{controleMaterialMB.disponibilizados}" var="cm" rows="7" paginator="true" paginatorPosition="bottom">
                    <p:ajax event="rowSelect" update=":lume:dtMateriaisDisponiveis, :lume:dtItensPendentes, :lume:disponibiliza" listener="#{controleMaterialMB.carregaItem}" process="@this" />
                    <f:facet name="header">Itens Disponibilizados</f:facet>
                    <p:column filterBy="#{cm.material.item.descricaoLimpa}" sortBy="#{cm.material.item.descricao}" filterMatchMode="contains" headerText="Descrição">
                        <h:outputText value="#{cm.material.item.descricao}" title="#{cm.id}" />
                    </p:column>
                    <p:column filterBy="#{cm.quantidade}" sortBy="#{cm.quantidade}" filterMatchMode="contains" headerText="Quantidade">
                        <h:outputText value="#{cm.quantidade}" />
                    </p:column>
                </p:dataTable>
                <br />
                <div class="SeparatorFull"></div>
                <p:panelGrid columns="4" layout="grid" styleClass="ui-panelgrid-blank form-group ui-fluid">
                    <p:commandButton id="fechar" icon="White fa fa-close" value="Fechar" process="@this" styleClass="RedButton" oncomplete="PF('dlgDisponibilizados').hide()" />
                </p:panelGrid>
            </p:dialog>
        </h:panelGroup>
    </ui:define>
</ui:composition>