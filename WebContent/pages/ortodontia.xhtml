<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:ui="http://java.sun.com/jsf/facelets">

	<style>
label.ui-helper-hidden {
	display: none !important;
}

.ui-panelgrid thead tr td, .ui-panelgrid tfoot tr td {
	color: #525252 !important;
	background-color: rgba(40, 40, 40, 0.1) !important;
	font-family: 'latobold' !important;
}

li.orcamento-li {
	list-style-type: disc !important;
}

.fixaAbaixo {
	position: relative;
}

.fixaAbaixo input {
	position: absolute;
	bottom: 0 !important;
}

.fixaAbaixo button span {
	margin-top: -3px !important;
}

.CardTextParent {
	width: 100%;
	display: flex;
}

.CardTextParent .CardText {
	text-align: center;
	border: 1px solid #bdbdbd;
	border-radius: 3px;
	width: 24.25%;
	padding: 12px 16px;
}

.CardText span:first-child {
	font-size: 18px;
}

.CardText span:last-child {
	font-size: 14px;
}

.descontoFieldset .ui-panelgrid-cell:nth-child(1), .descontoFieldset .ui-panelgrid-cell:nth-child(3)
	{
	padding-top: 10px !important;
}
</style>

	<div class="Container100 Responsive100 NoIndent">
		<div class="Container100 ui-fluid NoPadding">

			<p:outputPanel id="pnMainOrtodontia">

				<p:panelGrid columns="2" layout="grid"
					styleClass="ui-panelgrid-blank form-group ui-fluid removeSideGridPadding">
					<p:commandButton id="newOrtodontia" icon="White fa fa-file-o"
						value="Nova Manutenção Orto"
						actionListener="#{ortodontiaMB.actionNew}" process="@this"
						oncomplete="PF('dlgPlanoOrtodontico').show()" immediate="true" />
				</p:panelGrid>

				<p:dataTable filterDelay="1500" reflow="true" emptyMessage=""
					id="dtPlanoTratamentoOrtodontia" value="#{ortodontiaMB.entityList}"
					var="planoTratamento" rows="10" paginator="true"
					paginatorPosition="bottom" selection="#{ortodontiaMB.entity}"
					selectionMode="single" rowKey="#{planoTratamento}">
					<p:ajax event="rowSelect" process="@this" />
					<f:facet name="header">Planos de Tratamento Ortodonticos</f:facet>
					<p:column headerText="Ações" style="width:50px">
						<p:commandButton styleClass="NavyButton" icon="fa fa-eye"
							oncomplete="PF('dlgPlanoOrtodontico').show()"
							update=":lume:tabView:planoOrtodonticoHeader, :lume:tabView:planoOrtodontico"
							process="@this" title="Gerenciar Plano de Tratamento"
							actionListener="#{ortodontiaMB.actionCarregarPlano(planoTratamento)}">
						</p:commandButton>
					</p:column>
					<p:column filterBy="#{planoTratamento.descricaoComConvenio}"
						sortBy="#{planoTratamento.descricaoComConvenio}"
						filterMatchMode="contains" headerText="Descrição">
						<h:outputText value="#{planoTratamento.descricaoComConvenio}"
							title="#{planoTratamento.id}" />
					</p:column>
					<p:column
						filterBy="#{planoTratamento.profissional.dadosBasico.prefixoNome}"
						sortBy="#{planoTratamento.profissional.dadosBasico.prefixoNome}"
						filterMatchMode="contains" headerText="Profissional">
						<h:outputText
							value="#{planoTratamento.profissional.dadosBasico.prefixoNome}" />
					</p:column>
					<p:column filterBy="#{planoTratamento.inicioStr}"
						filterMatchMode="contains" headerText="Inicio"
						sortBy="#{planoTratamento.inicio}">
						<h:outputText value="#{planoTratamento.inicioStr}" />
					</p:column>
					<p:column filterBy="#{planoTratamento.fimStr}"
						filterMatchMode="contains" headerText="Fim"
						sortBy="#{planoTratamento.fim}">
						<h:outputText value="#{planoTratamento.fimStr}" />
					</p:column>
				</p:dataTable>
			</p:outputPanel>

		</div>
	</div>

	<ui:remove>
	<p:dialog id="dlgPreviewOrcamentoOrto"
		widgetVar="dlgPreviewOrcamentoOrto" appendTo=":lume" responsive="true"
		modal="true" width="60%">

		<f:facet name="header">
			<h:outputText value="Orçamentos" />
		</f:facet>

		<p:outputPanel id="previewOrcamento">
			<p:panelGrid columns="2" layout="grid" id="botoesOrcamentoPTOrto"
				styleClass="ui-panelgrid-blank form-group ui-fluid removeSideGridPadding">

				<p:commandButton id="newOrcamentoOrto" icon="ui-icon-add"
					actionListener="#{ortodontiaMB.actionNewOrcamento}"
					update=":lume:tabView:pnViewOrcamento, :lume:tabView:orcamentoViewHeader, :lume:tabView:buttonsDlgOrcamentoView,:lume:tabView:panelDescObs"
					value="Novo Orçamento" process="@this" styleClass="NavyButton"
					disabled="#{planoTratamentoMB.entity.status == 'S'}" />

			</p:panelGrid>

			<p:dataTable filterDelay="1500" reflow="true"
				emptyMessage="Nenhum orçamento cadastrado" id="dtPreviewOrcamentos"
				widgetVar="dtPreviewOrcamentos" var="orcamento"
				value="#{ortodontiaMB.orcamentos}" rows="10" paginator="true"
				paginatorPosition="bottom"
				selection="#{ortodontiaMB.orcamentoSelecionado}"
				rowKey="#{orcamento}">

				<f:facet name="header">
					<h:outputText
						value="Orçamentos do Plano Ortodôntico '#{ortodontiaMB.entity.descricao}'" />
				</f:facet>
				<ui:remove>
					<p:column width="120" headerText="Editar">
						<p:commandButton styleClass="NavyButton" icon="fa fa-eye">



						</p:commandButton>
						<p:commandButton icon="White fa fa-print" process="@this"
							update=":lume:tabView:orcamentoInclude"
							actionListener="#{planoTratamentoMB.actionEditOrcamento(orcamento)}"
							oncomplete="PF('dlgPrintOrcamento').show()"
							styleClass="NavyButton" />
						<p:commandButton icon="fa fa-trash" process="@this"
							actionListener="#{ortodontiaMB.actionRemoveOrcamento(orcamento)}"
							update=":lume:tabView:tbViewOrcamento" styleClass="NavyButton"
							title="Cancelar Orçamento">
							<p:confirm header="Confirmação"
								message="Deseja cancelar o orçamento?" icon="ui-icon-alert" />
						</p:commandButton>
						<p:commandButton process="@this"
							disable="#{orcamento.aprovado == 'S'}"
							oncomplete="PF('dlgNovoReajusteOrcamento').show();"
							icon="fa fa-dollar" styleClass="NavyButton">

							<p:ajax listener="#{ortodontiaMB.actionEditOrcamento(orcamento)}"
								process="@this" />

						</p:commandButton>

					</p:column>
				</ui:remove>
				<p:column headerText="Descrição" filterBy="#{orcamento.descricao}"
					filterMatchMode="contains" sortBy="#{orcamento.descricao}">
					<h:outputText value="#{orcamento.descricao}" />
				</p:column>

				<p:column headerText="Data de Criação"
					filterBy="#{orcamento.dataCriacao}" filterMatchMode="contains"
					sortBy="#{orcamento.dataCriacao}">
					<h:outputText value="#{orcamento.dataCriacao}">
						<f:convertDateTime pattern="HH:mm dd/MM/yyyy" />
					</h:outputText>
				</p:column>

				<p:column headerText="Valor Total"
					filterBy="#{orcamento.valorTotal}" filterMatchMode="contains"
					sortBy="#{orcamento.valorTotal}">
					<h:outputText value="#{orcamento.valorTotal}">
						<f:convertNumber type="currency" currencySymbol="R$"
							maxFractionDigits="2" />
					</h:outputText>
				</p:column>

				<p:column headerText="Aprovado?" filterBy="#{orcamento.aprovadoStr}"
					filterMatchMode="contains" sortBy="#{orcamento.aprovadoStr}">
					<h:outputText value="#{orcamento.aprovadoStr}" />
				</p:column>

				<p:column headerText="Índice de reajuste">
					<h:outputText value="#{orcamento.indiceReajuste.reajuste}">
						<f:convertNumber type="currency" currencySymbol="%"
							maxFractionDigits="2" />
					</h:outputText>
				</p:column>

				<p:column headerText="Observações"
					filterBy="#{orcamento.observacoes}" filterMatchMode="contains"
					sortBy="#{orcamento.observacoes}">
					<h:outputText value="#{orcamento.observacoes}" />
				</p:column>

			</p:dataTable>
		</p:outputPanel>

	</p:dialog>
	</ui:remove>

	<p:dialog id="dlgNovoReajusteOrcamento"
		widgetVar="dlgNovoReajusteOrcamento" width="30%" responsive="true"
		modal="true" appendTo=":lume">

		<p:panelGrid id="pnNovoReajusteOrcamento" columns="1" layout="grid"
			styleClass="ui-panelgrid-blank ui-fluid form-group">

			<h:panelGroup>
				<p:outputLabel value="Informe o percentual de reajuste" />
				<p:inputNumber value="#{ortodontiaMB.indiceReajuste}" symbol="%"
					maxlength="100" decimalPlaces="2" symbolPosition="s">

					<p:ajax process="@this" />

				</p:inputNumber>
			</h:panelGroup>

		</p:panelGrid>

		<p:panelGrid columns="3" layout="grid"
			styleClass="ui-panelgrid-blank ui-fluid form-group">

			<p:commandButton value="Aplicar reajuste" icon="fa fa-save"
				styleClass="GreenButton">

				<p:ajax process="@this"
					listener="#{ortodontiaMB.actionPersistReajuste}"
					oncomplete="PF('dlgNovoReajusteOrcamento').hide();"
					update=":lume:tabView:dtOrcamentosOrtodontia"/>

			</p:commandButton>

			<h:panelGroup></h:panelGroup>

			<p:commandButton value="Fechar" icon="fa fa-close"
				styleClass="NavyButton"
				oncomplete="PF('dlgNovoReajusteOrcamento').hide();" />

		</p:panelGrid>

	</p:dialog>

	<p:dialog id="dlgOrcamentoPlanoOrtodontico" appendTo=":lume" widgetVar="dlgOrcamentoPlanoOrtodontico"
		responsive="true" modal="true"
		onHide="PF('dlgOrcamentoPlanoOrtodontico').toggleMaximize();"
		onShow="PF('dlgOrcamentoPlanoOrtodontico').toggleMaximize();">
		
		<f:facet name="header">
			<p:outputPanel id="orcamentoPlanoOrtodonticoHeader">
				<h:outputText
					value="Orçamento - Manutenção Ortodôntica do paciente #{ortodontiaMB.paciente.dadosBasico.nome}" />
			</p:outputPanel>
		</f:facet>

		<p:outputPanel id="orcamentoPlanoOrtodontico"
			style="max-height: calc(100% - 54px); height: calc(100% - 54px);">
			
			<p:scrollPanel mode="native"
				style="position: relative; width: calc(100% - 20px); height: calc(100% - 20px); padding: 10px;">
				<p:outputPanel id="pnViewOrcamentoOrtodontico">
					<div class="CardTextParent">

						<h:panelGroup styleClass="CardText">
							<span> <b><h:outputText value="Valor Total" /></b>
							</span>
							<br />
							<span> <h:outputText
									value="#{ortodontiaMB.orcamentoSelecionado.valorTotalSemDesconto}">
									<f:convertNumber type="currency" currencySymbol="R$"
										maxFractionDigits="2" />
								</h:outputText>
							</span>
						</h:panelGroup>
						<div style="width: 1%" />

						<h:panelGroup styleClass="CardText">
							<span> <b><h:outputText value="Valor Pago" /></b>
							</span>
							<br />
							<span> <h:outputText
									value="#{ortodontiaMB.orcamentoSelecionado.valorPago}">
									<f:convertNumber type="currency" currencySymbol="R$"
										maxFractionDigits="2" />
								</h:outputText>
							</span>
						</h:panelGroup>

						<div style="width: 1%" />

						<h:panelGroup styleClass="CardText">
							<span> <b><h:outputText value="Desconto" /></b>
							</span>
							<br />
							<span> <h:outputText
									value="#{ortodontiaMB.orcamentoSelecionado.descontoValor}"
									rendered="#{ortodontiaMB.orcamentoSelecionado.descontoTipo == 'V'}">
									<f:convertNumber type="currency" currencySymbol="R$"
										maxFractionDigits="2" />
								</h:outputText> <h:outputText
									value="#{ortodontiaMB.orcamentoSelecionado.descontoValorDec}"
									rendered="#{ortodontiaMB.orcamentoSelecionado.descontoTipo == 'P'}">
									<f:convertNumber type="percent" maxFractionDigits="2" />
								</h:outputText>
							</span>
						</h:panelGroup>

						<div style="width: 1%" />
						<h:panelGroup styleClass="CardText">
							<span> <b><h:outputText value="Valor a Pagar" /></b>
							</span>
							<br />
							<span> <h:outputText
									value="#{ortodontiaMB.valorOrcamentoAPagar}">
									<f:convertNumber type="currency" currencySymbol="R$"
										maxFractionDigits="2" />
								</h:outputText>
							</span>
						</h:panelGroup>
					</div>
					<br />
					<p:dataTable filterDelay="1500" reflow="true"
						emptyMessage="Nenhum procedimento cadastrado no Plano de Tratamento"
						id="tbViewProcedimentoOrcamentoOrtodontico"
						widgetVar="tbViewOrcamento" var="procedimento"
						value="#{ortodontiaMB.orcamentoSelecionado.itens}"
						paginator="true" paginatorPosition="bottom">
						<f:facet name="header">
							<h:outputText value="Procedimentos" />
						</f:facet>
						<p:column headerText="Descrição" filterMatchMode="contains"
							filterBy="#{procedimento.descricao}"
							sortBy="#{procedimento.descricao}">
							<h:outputText value="#{procedimento.descricao}" />
						</p:column>

						<p:column headerText="Valor Original" filterMatchMode="contains"
							style="width: 200px;" filterBy="#{procedimento.valorOriginal}"
							sortBy="#{procedimento.valorOriginal}">
							<h:outputText value="#{procedimento.valorOriginal}">
								<f:convertNumber currencySymbol="R$" type="currency" />
							</h:outputText>
						</p:column>
						<p:column headerText="Valor" filterMatchMode="contains"
							style="width: 200px;" filterBy="#{procedimento.valor}"
							sortBy="#{procedimento.valor}">
							<p:inputNumber value="#{procedimento.valor}"
								required="#{planoTratamentoMB.orcamentoSelecionado != null}"
								maxlength="13" maxValue="9999999999.99" decimalSeparator=","
								symbol="R$ " thousandSeparator="."
								readonly="#{ortodontiaMB.orcamentoSelecionado.ativo == 'N'}"
								disabled="#{ortodontiaMB.entity.status == 'S'}">
							</p:inputNumber>
						</p:column>
						<p:column headerText="Desconto" filterMatchMode="contains"
							style="width: 80px;"
							filterBy="#{ortodontiaMB.getDescontoFrom(procedimento)}"
							sortBy="#{ortodontiaMB.getDescontoFrom(procedimento)}">
							<h:outputText
								value="#{ortodontiaMB.getDescontoFrom(procedimento)}">
								<f:convertNumber type="percent" />
							</h:outputText>
						</p:column>

						<p:column headerText="Reajuste" filterMatchMode="contains"
							style="width: 80px;"
							filterBy="#{ortodontiaMB.orcamentoSelecionado.indiceReajuste.reajuste}"
							sortBy="#{ortodontiaMB.orcamentoSelecionado.indiceReajuste.reajuste}">
							<h:outputText value="#{o.indiceReajuste.reajuste}">

							</h:outputText>
						</p:column>

						<p:column headerText="Incluso?" width="50">
							<p:selectBooleanCheckbox value="#{procedimento.incluso}"
								disabled="#{ortodontiaMB.entity.status == 'S'}" />
						</p:column>
					</p:dataTable>
					<br />
					<p:fieldset legend="Desconto" toggleable="true" collapsed="true"
						style="margin: 0;">
						<p:panelGrid columns="4" layout="grid"
							columnClasses="ui-g-2,ui-g-4,ui-g-2,ui-g-4"
							styleClass="ui-panelgrid-blank form-group ui-fluid removeSideGridPadding removePaddingUp descontoFieldset">
							<h:outputText value="Tipo do Desconto" />
							<p:selectOneMenu
								rendered="#{ortodontiaMB.orcamentoSelecionado != null}"
								disabled="#{ortodontiaMB.entity.status == 'S' or ortodontiaMB.orcamentoSelecionado.aprovado}"
								value="#{ortodontiaMB.orcamentoSelecionado.descontoTipo}">
								<f:selectItem itemValue="P" itemLabel="Porcentagem" />
								<f:selectItem itemValue="V" itemLabel="Valor" />
								<p:ajax process="@this"
									update=":lume:tabView:orcamentoOrtodonticoDescontoValor" />
							</p:selectOneMenu>

							<h:outputText value="Valor do Desconto" />
							<h:panelGroup id="orcamentoOrtodonticoDescontoValor">
								<p:inputNumber
									disabled="#{ortodontiaMB.entity.status == 'S' or ortodontiaMB.orcamentoSelecionado.aprovado}"
									value="#{ortodontiaMB.orcamentoSelecionado.descontoValor}"
									styleClass="taller" maxlength="13" maxValue="9999999999.99"
									decimalSeparator="," symbol="R$ " thousandSeparator="."
									rendered="#{ortodontiaMB.orcamentoSelecionado.descontoTipo == 'V'}">
								</p:inputNumber>
								<p:inputNumber
									disabled="#{ortodontiaMB.entity.status == 'S' or ortodontiaMB.orcamentoSelecionado.aprovado}"
									value="#{ortodontiaMB.orcamentoSelecionado.descontoValor}"
									styleClass="taller" maxlength="13" maxValue="9999999999.99"
									decimalSeparator="," symbol="%" thousandSeparator="."
									symbolPosition="s"
									rendered="#{ortodontiaMB.orcamentoSelecionado.descontoTipo == 'P'}">
								</p:inputNumber>
							</h:panelGroup>
						</p:panelGrid>
					</p:fieldset>

				</p:outputPanel>
			</p:scrollPanel>
		</p:outputPanel>

		<p:panelGrid columns="4" layout="grid"
			id="buttonsDlgOrcamentoOrtodonticoView"
			styleClass="ui-panelgrid-blank form-group ui-fluid removeSideGridPadding">
			<p:commandButton icon="White fa fa-save" value="Salvar"
				process="@this, :lume:tabView:orcamentoPlanoOrtodontico"
				actionListener="#{ortodontiaMB.actionPersistOrcamento}"
				styleClass="GreenButton"
				update=":lume:tabView:orcamentoPlanoOrtodontico, :lume:tabView:dtOrcamentosOrtodontia, :lume:tabView:buttonsDlgOrcamentoOrtodonticoView"
				disabled="#{ortodontiaMB.entity.status == 'S' or ortodontiaMB.orcamentoSelecionado.aprovado}" />
			<p:commandButton icon="White fa fa-print"
				value="Visualizar Impressão" process="@this"
				oncomplete="PF('dlgPrintOrcamentoO').show()" styleClass="NavyButton"
				update=":lume:tabView:orcamentoIncludeOrtodontico"
				disabled="#{ortodontiaMB.orcamentoSelecionado.id == null or ortodontiaMB.orcamentoSelecionado.id == 0}">
			</p:commandButton>
			<p:commandButton icon="White fa fa-gear" value="Aprovar Orçamento"
				actionListener="#{ortodontiaMB.actionAprovaOrcamento}"
				process="@this, :lume:tabView:orcamentoPlanoOrtodontico"
				styleClass="OrangeButton"
				update=":lume:tabView:buttonsDlgOrcamentoOrtodonticoView, :lume:tabView:orcamentoPlanoOrtodontico, :lume:tabView:dtOrcamentosOrtodontia"
				disabled="#{ortodontiaMB.entity.status == 'S' or ortodontiaMB.orcamentoSelecionado.id == null or ortodontiaMB.orcamentoSelecionado.id == 0
								or ortodontiaMB.orcamentoSelecionado.aprovado}" />
			<p:commandButton icon="White fa fa-close" value="Fechar"
				process="@this" onclick="PF('dlgOrcamentoPlanoOrtodontico').hide();"
				styleClass="NavyButton" />
		</p:panelGrid>

	</p:dialog>

	<p:dialog id="dlgPlanoOrtodontico" appendTo=":lume"
		widgetVar="dlgPlanoOrtodontico" responsive="true" modal="true"
		onHide="PF('dlgPlanoOrtodontico').toggleMaximize();"
		onShow="PF('dlgPlanoOrtodontico').toggleMaximize();">

		<f:facet name="header">
			<p:outputPanel id="planoOrtodonticoHeader">
				<h:outputText
					value="Manutenção Ortodôntica do paciente #{ortodontiaMB.paciente.dadosBasico.nome}" />
			</p:outputPanel>
		</f:facet>

		<p:outputPanel id="planoOrtodontico"
			style="max-height: calc(100% - 54px); height: calc(100% - 54px);">
			<p:scrollPanel mode="native"
				style="position: relative; width: calc(100% - 20px); height: calc(100% - 20px); padding: 10px;">
				<div class="ui-g ui-fluid">
					<div class="ui-g-12 ui-lg-12">

						<p:outputPanel id="pnOrtodontia" styleClass="BordNone"
							style="margin-top: 20px !important;">

							<p:fieldset legend="Dados" toggleable="true">
								<p:panelGrid columns="4" layout="grid"
									columnClasses="ui-g-2,ui-g-4,ui-g-2,ui-g-4"
									styleClass="ui-panelgrid-blank form-group ui-fluid"
									style="border:0px none; background-color:transparent;">
									<p:outputLabel for="descricaoPlano"
										value="Descrição do Plano : " />
									<p:inputText id="descricaoPlano"
										value="#{ortodontiaMB.entity.descricao}" required="true" />
									<p:outputLabel for="valorProcedimentoPadrao"
										value="Valor procedimento : " />
									<p:inputNumber id="valorProcedimentoPadrao"
										value="#{ortodontiaMB.valorProcedimento}"
										disabled="#{ortodontiaMB.entity.id != null or ortodontiaMB.entity.id > 0}"
										required="true" maxlength="13" maxValue="9999999999.99"
										decimalSeparator="," symbol="R$ " thousandSeparator="." />
									<p:outputLabel for="utilizaConvenio"
										value="Utilizar o convênio #{ortodontiaMB.paciente.convenio.dadosBasico.nome} :"
										rendered="#{ortodontiaMB.paciente.convenio != null}" />
									<p:selectBooleanCheckbox id="utilizaConvenio"
										value="#{ortodontiaMB.entity.bconvenio}"
										rendered="#{ortodontiaMB.paciente.convenio != null}"
										disabled="#{ortodontiaMB.entity.id != null or ortodontiaMB.entity.id > 0}">
										<p:ajax process="@this" update="valorProcedimentoPadrao"
											listener="#{ortodontiaMB.atualizaValorProcedimento()}" />
									</p:selectBooleanCheckbox>
									<p:column rendered="#{ortodontiaMB.paciente.convenio == null}" />
									<p:column rendered="#{ortodontiaMB.paciente.convenio == null}" />
									<p:outputLabel for="meses" value="Meses : " />
									<p:inputText value="#{ortodontiaMB.entity.meses}" id="meses"
										required="true"
										disabled="#{ortodontiaMB.entity.id != null or ortodontiaMB.entity.id > 0}">
										<p:ajax event="keyup" process="inicioTratamento,@this"
											update="" listener="#{ortodontiaMB.actionCalculaMeses}"
											delay="0" />
									</p:inputText>
									<p:outputLabel for="inicioTratamento"
										value="Início do tratamento : " />
									<p:calendar id="inicioTratamento" required="true"
										value="#{ortodontiaMB.entity.inicio}" pattern="dd/MM/yyyy"
										showWeeksBar="false" locale="#{lumeSecurity.locale}"
										timeZone="#{lumeSecurity.timeZone}" navigator="true"
										yearRange="-0:+1" mask="true"
										disabled="#{ortodontiaMB.entity.id != null or ortodontiaMB.entity.id > 0}">
										<p:ajax process="@this,meses" event="dateSelect"
											listener="#{ortodontiaMB.actionCalculaMeses}" />
										<p:ajax process="@this,meses" event="change"
											listener="#{ortodontiaMB.actionCalculaMeses}" />
									</p:calendar>

									<p:outputLabel value="Previsão de fim do tratamento : " />
									<p:inputText id="fimTratamento"
										value="#{ortodontiaMB.entity.fimStr}" readonly="true"
										disabled="#{ortodontiaMB.entity.id != null or ortodontiaMB.entity.id > 0}" />
								</p:panelGrid>

								<p:panelGrid columns="4"
									columnClasses="ui-grid-col-3,ui-grid-col-5,ui-grid-col-2,ui-grid-col-2"
									layout="grid" styleClass="ui-panelgrid-blank"
									style="border:0px none; background-color:transparent;">

									<p:outputLabel value="Procedimento Ortodôntico : "
										for="procedimentoPadrao" />
									<p:autoComplete dropdown="true" queryDelay="1000"
										required="true"
										value="#{ortodontiaMB.entity.procedimentoPadrao}"
										id="procedimentoPadrao"
										completeMethod="#{ortodontiaMB.geraSugestoesProcedimentoOrtodontico}"
										var="p" itemLabel="#{p.descricao}" itemValue="#{p}"
										converter="procedimento" forceSelection="true"
										scrollHeight="400" minQueryLength="3"
										style="float:left !important;width: 100% !important"
										inputStyle="width:500px;">
										<p:ajax event="itemSelect" process="@this"
											update="valorProcedimentoPadrao"
											listener="#{ortodontiaMB.atualizaValorProcedimento()}" />
									</p:autoComplete>
								</p:panelGrid>

							</p:fieldset>
							<br />

							<p:fieldset legend="Diagnósticos" toggleable="true"
								rendered="#{false}">
								<p:panelGrid columns="2"
									columnClasses="ui-grid-col-6,ui-grid-col-6" layout="grid"
									styleClass="ui-panelgrid-blank"
									style="border:0px none; background-color:transparent;">
									<h:panelGroup style="display: flex !important;">
										<p:selectOneMenu id="diagnostico"
											value="#{ortodontiaMB.diagnosticoSelecionado}"
											filterMatchMode="contains" autoWidth="false"
											style="float:left;width:90% !important"
											converter="diagnostico" filter="true">
											<p:ajax process="@this" update="adicionarDiagnostico" />
											<f:selectItem itemLabel="Selecione um diagnóstico"
												noSelectionOption="true" itemValue="#{null}" />
											<f:selectItems value="#{ortodontiaMB.diagnosticos}" var="d"
												itemValue="#{d}" itemLabel="#{d.descricao}" />
										</p:selectOneMenu>
										<p:commandButton id="adicionarDiagnostico"
											icon="White fa fa-plus White"
											actionListener="#{ortodontiaMB.actionAdicionarDiagnostico}"
											update=":lume:tabView:dtDiagnosticos,@this"
											process="diagnostico,@this"
											disabled="#{ortodontiaMB.diagnosticoSelecionado == null}" />
									</h:panelGroup>
									<h:panelGroup style="display: flex !important;">
										<p:selectOneMenu id="aparelho"
											value="#{ortodontiaMB.aparelhoSelecionado}"
											filterMatchMode="contains" autoWidth="false"
											style="float:left;width:90% !important" converter="aparelho"
											filter="true">
											<p:ajax process="@this" update="adicionarAparelho" />
											<f:selectItem itemLabel="Selecione um aparelho"
												noSelectionOption="true" itemValue="#{null}" />
											<f:selectItems value="#{ortodontiaMB.aparelhos}" var="d"
												itemValue="#{d}" itemLabel="#{d.descricao}" />
										</p:selectOneMenu>
										<p:commandButton id="adicionarAparelho"
											icon="White fa fa-plus White"
											actionListener="#{ortodontiaMB.actionAdicionarAparelho}"
											update=":lume:tabView:dtAparelhos,@this"
											process="aparelho,@this"
											disabled="#{ortodontiaMB.aparelhoSelecionado == null}" />
									</h:panelGroup>
									<p:dataTable filterDelay="1500" reflow="true" emptyMessage=""
										id="dtDiagnosticos" var="d"
										value="#{ortodontiaMB.entity.diagnosticos}" rows="10"
										paginator="true" paginatorPosition="bottom">
										<p:column sortBy="#{d.diagnosticoOrtodontico.descricao}"
											headerText="Diagnósticos">
											<h:outputText value="#{d.diagnosticoOrtodontico.descricao}" />
										</p:column>
										<p:column width="33px">
											<p:commandButton icon="White fa fa-minus White"
												actionListener="#{ortodontiaMB.actionRemoverDiagnostico(d)}"
												update=":lume:tabView:dtDiagnosticos" process="@this" />
										</p:column>
									</p:dataTable>
									<p:dataTable filterDelay="1500" reflow="true" emptyMessage=""
										id="dtAparelhos" var="d"
										value="#{ortodontiaMB.entity.aparelhos}" rows="10"
										paginator="true" paginatorPosition="bottom">
										<p:column sortBy="#{d.aparelhoOrtodontico.descricao}"
											headerText="Aparelhos">
											<h:outputText value="#{d.aparelhoOrtodontico.descricao}" />
										</p:column>
										<p:column width="33px">
											<p:commandButton icon="White fa fa-minus White"
												actionListener="#{ortodontiaMB.actionRemoverAparelho(d)}"
												update=":lume:tabView:dtAparelhos" process="@this" />
										</p:column>
									</p:dataTable>
								</p:panelGrid>
							</p:fieldset>
							<br />

							<p:fieldset id="fsProcedimentosEValores"
								legend="Procedimentos e Valores" toggleable="true"
								collapsed="#{ortodontiaMB.entity.id == null or ortodontiaMB.entity.id == 0}">
								<p:panelGrid columns="2"
									columnClasses="ui-grid-col-6,ui-grid-col-6" layout="grid"
									styleClass="ui-panelgrid-blank"
									style="border:0px none; background-color:transparent;"
									rendered="#{ortodontiaMB.admin}">
									<p:panelGrid columns="1" columnClasses="ui-grid-col-12"
										layout="grid" styleClass="ui-panelgrid-blank"
										id="dtProcedimentosPanel"
										style="border:0px none; background-color:transparent;">
										<p:dataTable filterDelay="1500" reflow="true" emptyMessage=""
											id="dtProcedimentosOrtodontia" var="ptp"
											value="#{ortodontiaMB.entity.planoTratamentoProcedimentos}"
											rows="6" paginator="true" paginatorPosition="bottom"
											sortField="#{ptp.sequencial}" sortBy="#{ptp.sequencial}">
											<f:facet name="header">Procedimentos</f:facet>
											<p:column styleClass="TexAlCenter" sortBy="#{ptp.sequencial}"
												headerText="Nr." width="10%">
												<h:outputText id="sequencial" value="#{ptp.sequencial}"
													title="#{ptp.id}" />
											</p:column>
											<p:column styleClass="TexAlCenter"
												sortBy="#{ptp.procedimento.descricao}" headerText="Proc."
												width="30%">
												<h:outputText value="#{ptp.procedimento.descricao}"
													title="#{ptp.id}" />
											</p:column>
											<p:column filterBy="#{ptp.dataFinalizadoStr}"
												filterMatchMode="contains" styleClass="cabecalho"
												headerText="Data de Finalização"
												sortBy="#{ptp.dataFinalizadoStrOrd}" width="30%">
												<h:outputText value="#{ptp.dataFinalizadoStr}" />
											</p:column>
											<p:column
												filterBy="#{ptp.finalizadoPorProfissional.dadosBasico.nome}"
												filterMatchMode="contains" headerText="Finalizado Por"
												sortBy="#{ptp.finalizadoPorProfissional.dadosBasico.nome}">
												<h:outputText
													value="#{ptp.finalizadoPorProfissional.dadosBasico.nome}" />
											</p:column>
										</p:dataTable>
									</p:panelGrid>

									<p:column>
										<p:panelGrid columns="1" layout="grid"
											styleClass="ui-panelgrid-blank form-group ui-fluid removeSideGridPadding">

											<p:panelGrid columns="2" layout="grid"
												styleClass="ui-panelgrid-blank form-group ui-fluid removeSideGridPadding">

												<p:commandButton icon="White fa fa-gear White"
													value="Gerar Orçamento" styleClass="OrangeButton"
													action="#{ortodontiaMB.actionNewOrcamento}"
													process="@this,:lume:tabView:dtOrcamentosOrtodontia"
													update=":lume:tabView:dtOrcamentosOrtodontia">
												</p:commandButton>

											</p:panelGrid>

											<p:dataTable filterDelay="1500" reflow="true" emptyMessage=""
												id="dtOrcamentosOrtodontia" var="o"
												value="#{ortodontiaMB.orcamentos}" rows="5" paginator="true"
												paginatorPosition="bottom">

												<f:facet name="header">Orçamentos</f:facet>

												<p:column width="120" headerText="Editar">
													<p:commandButton styleClass="NavyButton" icon="fa fa-eye"
														title="Editar Dados">

														<p:ajax
															process="@this,:lume:tabView:pnViewOrcamentoOrtodontico"
															oncomplete="PF('dlgOrcamentoPlanoOrtodontico').show();"
															listener="#{ortodontiaMB.actionEditOrcamento(o)}"
															update=":lume:tabView:pnViewOrcamentoOrtodontico, :lume:tabView:buttonsDlgOrcamentoOrtodonticoView, :lume:tabView:orcamentoPlanoOrtodontico" />

													</p:commandButton>
													
													<p:commandButton icon="White fa fa-print" process="@this"
														actionListener="#{ortodontiaMB.setOrcamentoSelecionado(o)}"
														update=":lume:tabView:orcamentoIncludeOrtodontico"
														oncomplete="PF('dlgPrintOrcamentoO').show()"
														styleClass="NavyButton" title="Imprimir Orçamento" />
													<p:commandButton process="@this"
														disable="#{orcamento.isAprovado}"
														oncomplete="PF('dlgNovoReajusteOrcamento').show();"
														icon="fa fa-dollar" styleClass="NavyButton">

														<p:ajax listener="#{ortodontiaMB.actionEditOrcamento(o)}"
															process="@this" />

													</p:commandButton>
													<p:commandButton icon="fa fa-trash" process="@this"
														actionListener="#{ortodontiaMB.actionRemoveOrcamento(o)}"
														update=":lume:tabView:dtOrcamentosOrtodontia"
														styleClass="RedButton" title="Cancelar Orçamento"
														disabled="#{o.aprovado or ortodontiaMB.entity.status == 'S'}">
														<p:confirm header="Confirmação"
															message="Deseja cancelar o orçamento?"
															icon="ui-icon-alert" />
													</p:commandButton>
													
												</p:column>
												<p:column filterBy="#{o.dataAprovacaoStr}"
													filterMatchMode="contains" styleClass="cabecalho"
													headerText="Data de criação" sortBy="#{o.dataCriacao}"
													width="20%">
													<h:outputText value="#{o.dataCriacao}">
														<f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
													</h:outputText>
												</p:column>
												<p:column filterBy="#{o.dataAprovacaoStr}"
													filterMatchMode="contains" styleClass="cabecalho"
													headerText="Data de aprovação" sortBy="#{o.dataAprovacao}"
													width="20%">
													<h:outputText value="#{o.dataAprovacao}">
														<f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
													</h:outputText>
												</p:column>
												<p:column headerText="Valor Acordado">
													<h:outputText value="#{o.valorProcedimentoOrtodontico}">
														<f:convertNumber currencySymbol="R$" type="currency"
															locale="#{lumeSecurity.locale}" />
													</h:outputText>
												</p:column>
												<p:column headerText="Parcelas">
													<h:outputText value="#{o.quantidadeParcelas}" />
												</p:column>

												<p:column headerText="Reajuste" filterMatchMode="contains"
													style="width: 80px;"
													filterBy="#{o.indiceReajuste.reajuste}"
													sortBy="#{o.indiceReajuste.reajuste}">
													<h:outputText value="#{o.indiceReajuste.reajuste}">

													</h:outputText>
												</p:column>

												<p:column headerText="Valor Total">
													<h:outputText value="#{o.valorTotal}">
														<f:convertNumber currencySymbol="R$" type="currency"
															locale="#{lumeSecurity.locale}" />
													</h:outputText>
												</p:column>
												<p:column headerText="Valor Pago">
													<h:outputText value="#{o.valorPago}">
														<f:convertNumber currencySymbol="R$" type="currency"
															locale="#{lumeSecurity.locale}" />
													</h:outputText>
												</p:column>
											</p:dataTable>
										</p:panelGrid>
									</p:column>

								</p:panelGrid>
							</p:fieldset>

						</p:outputPanel>
					</div>
				</div>
			</p:scrollPanel>
		</p:outputPanel>
		<p:panelGrid columns="4" layout="grid"
			styleClass="ui-panelgrid-blank form-group ui-fluid removeSideGridPadding">
			<p:commandButton value="Salvar" id="salvar"
				process="@this, :lume:tabView:planoOrtodontico"
				actionListener="#{ortodontiaMB.actionPersist}"
				icon="White fa fa-save White" styleClass="GreenButton"
				update=":lume:tabView:pnMainOrtodontia, :lume:tabView:planoOrtodontico,:lume:tabView:valorProcedimentoPadrao">
			</p:commandButton>
			<p:column />
			<p:column />
			<p:commandButton value="Fechar" type="button" icon="fa fa-close"
				styleClass="NavyButton" onclick="PF('dlgPlanoOrtodontico').hide()"
				process="@this" />
		</p:panelGrid>
	</p:dialog>

	<p:outputPanel id="orcamentoIncludeOrtodontico">
		<ui:include src="/templates/orcamentoImpressaoOrtodontico.xhtml">
			<ui:param name="o" value="#{ortodontiaMB.orcamentoSelecionado}" />
			<ui:param name="pt" value="#{ortodontiaMB.entity}" />
		</ui:include>
	</p:outputPanel>

</ui:composition>