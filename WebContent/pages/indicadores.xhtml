<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" template="/WEB-INF/template.xhtml"
	xmlns:pe="http://primefaces.org/ui/extensions">
	<ui:define name="content">

		<div class="ui-g ui-fluid">
			<div class="ui-g-12 ui-lg-12">
				<div class="card card-w-title">
					<h1>Indicadores</h1>

					<p:fieldset toggleable="true">
						<p:panelGrid columns="3" layout="grid" id="pnFiltros"
							styleClass="ui-panelgrid-blank ui-fluid form-group">

							<h:panelGroup styleClass="md-combo">
								<h:outputText for="filtroPeriodo" value="Período de criação:" />
								<p:selectOneMenu id="filtroPeriodo"
									value="#{indicadorMB.filtroPeriodo}">
									<p:ajax process="@this" update=":lume:pnFiltros"
										listener="#{indicadorMB.actionTrocaDatasCriacao}" />
									<f:selectItem itemValue="" itemLabel="Selecione" />
									<f:selectItem itemValue="S" itemLabel="Últimos 7 dias" />
									<f:selectItem itemValue="Q" itemLabel="Últimos 15 dias" />
									<f:selectItem itemValue="T" itemLabel="Últimos 30 dias" />
									<f:selectItem itemValue="I" itemLabel="Últimos 6 meses" />
								</p:selectOneMenu>
							</h:panelGroup>

							<h:panelGroup>
								<p:outputLabel for="inicio" value="Inicio: " />
								<p:calendar id="inicio" value="#{indicadorMB.inicio}"
									pattern="dd/MM/yyyy" mask="true" required="false" />
							</h:panelGroup>

							<h:panelGroup>
								<p:outputLabel for="fim" value="Fim: " />
								<p:calendar id="fim" value="#{indicadorMB.fim}"
									pattern="dd/MM/yyyy" mask="true" required="false" />
							</h:panelGroup>
						</p:panelGrid>

						<p:panelGrid columns="4" layout="grid"
							styleClass="ui-panelgrid-blank form-group ui-fluid">
							<p:commandButton id="pesquisarCustos" icon="fa fa-search White"
								value="Pesquisar" update=":lume:dtIndicadoresAgendamento"
								process="@this,pnFiltros" styleClass="OrangeButton" />
						</p:panelGrid>
					</p:fieldset>
					
					<p:fieldset toggleable="true">
						<p:dataTable id="dtIndicadoresAgendamento"
							rows="10" paginator="true" paginatorPosition="bottom"
							emptyMessage="Nenhum lançamento a receber para o mês corrente."
							value="#{indicadorMB.indicadoresAgendamento}" var="indicadorAgendamento" rowKey="#{indicadorAgendamento}">
							<f:facet name="header">Agendamentos</f:facet>
							<p:column headerText="Descrição"
								filterBy="#{indicadorAgendamento.descricao}"
								sortBy="#{indicadorAgendamento.descricao}"
								filterMatchMode="contains" width="15%">
								<h:outputText value="#{indicadorAgendamento.descricao}" />
							</p:column>
							<ui:repeat value="#{indicadorAgendamento.indicadores}" var="indicador">
								<p:column headerText="#{indicador.mes}"
									sortBy="#{indicador.valor}"
									filterMatchMode="contains" width="15%">
									<h:outputText value="#{'(' + indicador.metrica + ')' + indicador.valor}" />
								</p:column>
							</ui:repeat>
						</p:dataTable>
					</p:fieldset>
					
					<p:fieldset toggleable="true">
						<p:dataTable id="dtIndicadoresFinanceiro"
							rows="10" paginator="true" paginatorPosition="bottom"
							emptyMessage="Nenhum lançamento a receber para o mês corrente."
							value="#{indicadorMB.indicadoresFinanceiro}" var="indicadorFinanceiro"
							rowKey="#{indicadorFinanceiro}">
							<f:facet name="header">Financeiro</f:facet>
							<p:column headerText="Indicador"
								sortBy="#{indicadorFinanceiro.descricao}"
								filterMatchMode="contains" width="15%">
								<h:outputText value="#{indicadorFinanceiro.descricao}" />
							</p:column>
							<p:columns value="#{indicadorMB.indicadoresFinanceiro[indicadorMB.rowIndexByKey(indicadorFinanceiro)].indicadores}"
								var="indicador" headerText="#{indicador.mes}"
								sortBy="#{indicador.valor}"
								filterMatchMode="contains" width="15%">
								<h:outputText value="#{indicador.metrica.concat(' ').concat(indicador.valor)}" />
							</p:columns>
						</p:dataTable>
					</p:fieldset>
					
					<ui:remove>
					<p:fieldset collapsed="true" toggleable="true">
						<p:dataTable id="dtIndicadoresOrcamentos"
							rows="10" paginator="true" paginatorPosition="bottom"
							emptyMessage="Nenhum lançamento a receber para o mês corrente."
							value="#{indicadorMB.indicadoresOrcamentos}" var="indicadoresOrcamentos" rowKey="#{indicadoresOrcamentos}">
							<f:facet name="header">Orçamentos</f:facet>
							<p:column headerText="Descrição"
								filterBy="#{indicadoresOrcamentos.descricao}"
								sortBy="#{indicadoresOrcamentos.descricao}"
								filterMatchMode="contains" width="15%">
								<h:outputText value="#{indicadoresOrcamentos.descricao}" />
							</p:column>
							<p:column headerText="Valor"
								filterBy="#{indicadoresOrcamentos.valor}"
								sortBy="#{indicadoresOrcamentos.valor}"
								filterMatchMode="contains" width="15%">
								<h:outputText value="#{indicadoresOrcamentos.valor}" />
							</p:column>
						</p:dataTable>
					</p:fieldset>
					</ui:remove>

				</div>
			</div>
		</div>
	</ui:define>
</ui:composition>