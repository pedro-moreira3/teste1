<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" template="/WEB-INF/template.xhtml"
	xmlns:pe="http://primefaces.org/ui/extensions">
	<ui:define name="content">
		<style>
.centerPanels .ui-panel .ui-panel-titlebar, .centerPanels .ui-panel .ui-panel-content
	{
	text-align: center;
}

.lessPaddingSides .ui-panelgrid-cell {
	padding-left: 5px !important;
	padding-right: 5px !important;
}

body .sideChkBox.ui-chkbox {
	width: auto;
}

body .sideChkBox .ui-chkbox-box {
	display: inline-block;
	vertical-align: middle;
	margin-right: 4px;
}

body .sideChkBox .ui-chkbox-label {
	vertical-align: middle;
	margin-top: 0;
}
</style>

		<p:dialog widgetVar="dlgNewLancamento" header="Novo Lançamento"
			responsive="true" modal="true" appendTo=":lume">
			<p:ajax event="close" resetValues="true"
				update=":lume:pnlNewLancamento" />
			<div class="ui-g ui-fluid">
				<div class="ui-g-12 ui-lg-12">
					<p:outputPanel id="pnlNewLancamento">
						<h:panelGroup styleClass="lumeField" id="pnTipo">
							<p:outputLabel for="formaPagamento" value="Forma de Pagamento: " />
							<p:selectOneRadio id="formaPagamento"
								value="#{faturaPagtoMB.formaPagamento}" required="true"
								layout="grid" columns="3">
								<p:ajax update=":lume:pnlNewLancamento" process="@this"
									listener="#{faturaPagtoMB.atualizaProduto}" />
								<f:selectItems value="#{faturaPagtoMB.formasPagamento}" var="tp"
									itemValue="#{tp.valor}" itemLabel="#{tp.nome}" />
							</p:selectOneRadio>
							<p:message styleClass="msg" for="formaPagamento" />
						</h:panelGroup>
						<h:panelGroup styleClass="lumeField"
							rendered="#{faturaPagtoMB.showProduto}">
							<p:outputLabel for="produtoLancamento" value="Produto: " />
							<p:selectOneMenu id="produtoLancamento"
								value="#{faturaPagtoMB.tarifa}" converter="tarifa"
								required="#{faturaPagtoMB.showProduto}">
								<p:ajax listener="#{faturaPagtoMB.atualizaDataCredito}"
									process="@this" update=":lume:pnlNewLancamento" />
								<f:selectItem itemLabel="Selecione um Produto"
									itemValue="#{null}" />
								<f:selectItems value="#{faturaPagtoMB.tarifas}" var="tp"
									itemValue="#{tp}" itemLabel="#{tp.produtoStr}" />
							</p:selectOneMenu>
							<p:message for="produtoLancamento" styleClass="msg" />
						</h:panelGroup>
						<h:panelGroup styleClass="lumeField"
							rendered="#{faturaPagtoMB.formaPagamento == 'CC' and faturaPagtoMB.tarifa != null}">
							<p:outputLabel for="numParcelas" value="Parcelas: " />
							<p:selectOneMenu id="numParcelas"
								value="#{faturaPagtoMB.parcela}" filter="true"
								filterMatchMode="startsWith">
								<f:selectItems value="#{faturaPagtoMB.parcelas}" var="p"
									itemValue="#{p}" itemLabel="#{p}" />
							</p:selectOneMenu>
							<p:message for="numParcelas" styleClass="msg" />
						</h:panelGroup>
						<h:panelGroup styleClass="lumeField">
							<p:outputLabel for="valorAPagar" value="Valor: " />
							<p:inputNumber id="valorAPagar" value="#{faturaPagtoMB.valor}"
								required="true" maxlength="13" maxValue="9999999999.99"
								decimalSeparator="," symbol="R$ " thousandSeparator=".">
							</p:inputNumber>
						</h:panelGroup>
						<h:panelGroup styleClass="lumeField" id="pnJustificativa">
							<p:outputLabel for="dataPagamento" value="Data de Pagamento: " />
							<p:calendar id="dataPagamento"
								value="#{faturaPagtoMB.dataPagamento}" required="true"
								pattern="dd/MM/yyyy" showWeeksBar="false"
								locale="#{lumeSecurity.locale}"
								timeZone="#{lumeSecurity.timeZone}" navigator="true"
								yearRange="-10:+10">
								<p:ajax event="dateSelect"
									listener="#{faturaPagtoMB.handleSelectPagamento}"
									update=":lume:pnlNewLancamento"
									process="@this, :lume:pnlNewLancamento" />
							</p:calendar>
							<p:message for="dataPagamento" styleClass="msg" />
						</h:panelGroup>
						<h:panelGroup styleClass="lumeField">
							<p:outputLabel for="dataCredito" value="Data de Crédito:" />
							<p:calendar id="dataCredito" value="#{faturaPagtoMB.dataCredito}"
								required="true" pattern="dd/MM/yyyy" showWeeksBar="false"
								locale="#{lumeSecurity.locale}"
								timeZone="#{lumeSecurity.timeZone}" navigator="true"
								yearRange="-10:+10" disabled="#{!faturaPagtoMB.administrador}" />
							<p:message for="dataCredito" styleClass="msg" />
						</h:panelGroup>
						<div class="SeparatorFull"></div>
						<p:panelGrid columns="1" layout="grid"
							styleClass="ui-panelgrid-blank form-group ui-fluid removeSideGridPadding">
							<p:commandButton value="Salvar" icon="White fa fa-save"
								actionListener="#{faturaPagtoMB.actionPersistLancamento}"
								update=":lume:pnlNewLancamento, :lume:pnlfaturaView, :lume:buttonViewFatura"
								process="@this, :lume:pnlNewLancamento" styleClass="GreenButton" />
						</p:panelGrid>
					</p:outputPanel>
				</div>
			</div>
		</p:dialog>

		<p:dialog id="faturaView" appendTo=":lume" widgetVar="dlgFaturaView"
			responsive="true" modal="true"
			onHide="PF('dlgFaturaView').toggleMaximize();"
			onShow="PF('dlgFaturaView').toggleMaximize();">
			<f:facet name="header">
				<p:outputPanel id="pnlfaturaViewHeader">
					<h:outputText
						value="Visualização da Fatura - #{faturaPagtoMB.entity.dataCriacaoStr}" />
				</p:outputPanel>
			</f:facet>
			<p:outputPanel id="pnlfaturaView"
				style="max-height: calc(100% - 54px); height: calc(100% - 54px);">
				<p:scrollPanel mode="native"
					style="position: relative; width: calc(100% - 20px); height: calc(100% - 20px); padding: 10px;">
					<div class="ui-g ui-fluid">
						<div class="ui-g-12 ui-lg-12">

							<p:panelGrid columns="4" layout="grid"
								columnClasses="ui-g-2, ui-g-4, ui-g-2, ui-g-4"
								styleClass="ui-panelgrid-blank ui-fluid form-group removeSideGridPadding">
								<h:outputText for="paciente" value="Paciente:" />
								<p:inputText id="paciente"
									value="#{faturaPagtoMB.entity.paciente.dadosBasico.nome}"
									readonly="true" />
								<p:column />
								<p:column />
								<h:outputText for="dataCriacao" value="Data Criação:" />
								<p:inputText id="dataCriacao"
									value="#{faturaPagtoMB.entity.dataCriacaoStr}" readonly="true" />
								<p:column />
								<p:column />
							</p:panelGrid>

							<p:panelGrid columns="3" layout="grid"
								styleClass="ui-panelgrid-blank ui-fluid form-group removeSideGridPadding centerPanels lessPaddingSides">
								<p:panel id="valorTotal" header="Valor Total">
									<h:outputText
										value="#{faturaPagtoMB.getTotal(faturaPagtoMB.entity)}">
										<f:convertNumber currencySymbol="R$ " type="currency" />
									</h:outputText>
								</p:panel>
								<p:panel id="valorPago" header="Valor Pago">
									<h:outputText
										value="#{faturaPagtoMB.getTotalPago(faturaPagtoMB.entity)}">
										<f:convertNumber currencySymbol="R$ " type="currency" />
									</h:outputText>
								</p:panel>
								<p:panel id="valorRestante" header="Valor Restante">
									<h:outputText
										value="#{faturaPagtoMB.getTotalRestante(faturaPagtoMB.entity)}">
										<f:convertNumber currencySymbol="R$ " type="currency" />
									</h:outputText>
								</p:panel>
							</p:panelGrid>
							<p:dataTable filterDelay="1500" reflow="true" emptyMessage=""
								value="#{faturaPagtoMB.entity.itens}" var="fi" rows="20"
								paginator="true" rowKey="#{fi}" paginatorPosition="bottom">
								<f:facet name="header">Itens</f:facet>
								<p:column sortBy="#{fi.descricaoItem}"
									filterMatchMode="contains" filterBy="#{fi.descricaoItem}"
									headerText="Descrição">
									<h:outputText value="#{fi.descricaoItem}" style="float:left" />
								</p:column>
								<p:column sortBy="#{fi.tipoSaldoStr}" filterMatchMode="contains"
									filterBy="#{fi.tipoSaldoStr}" headerText="Tipo do Saldo"
									width="150">
									<h:outputText value="#{fi.tipoSaldoStr}" />
								</p:column>
								<p:column sortBy="#{fi.valorItem}" filterMatchMode="contains"
									filterBy="#{fi.valorItem}" headerText="Valor" width="100">
									<h:outputText value="#{fi.valorItem}">
										<f:convertNumber currencySymbol="R$ " type="currency" />
									</h:outputText>
								</p:column>
							</p:dataTable>
							<p:separator styleClass="SeparatorFull" />
							<p:panel>
								<p:selectBooleanCheckbox styleClass="sideChkBox"
									itemLabel="Mostrar lançamentos cancelados."
									value="#{faturaPagtoMB.showLancamentosCancelados}">
									<p:ajax process="@this" update=":lume:lancamentosFatura" />
								</p:selectBooleanCheckbox>
							</p:panel>
							<br />
							<p:dataTable filterDelay="1500" reflow="true" emptyMessage=""
								value="#{faturaPagtoMB.lancamentos}" var="l" rows="20"
								paginator="true" rowKey="#{l}" paginatorPosition="bottom"
								id="lancamentosFatura">
								<f:facet name="header">Lançamentos da Fatura</f:facet>
								<p:column headerText="Ações" width="100" exportable="false">
									<p:commandButton styleClass="RedButton" icon="fa fa-trash"
										title="Cancelar lançamento" disabled="#{!l.ativo}"
										actionListener="#{faturaPagtoMB.cancelaLancamento(l)}"
										process="@this" update=":lume:pnlfaturaView" />
								</p:column>
								<p:column styleClass="cabecalho"
									filterBy="#{l.formaPagamentoStr}"
									headerText="Forma de Pagamento" sortBy="#{l.formaPagamentoStr}">
									<h:outputText value="#{l.formaPagamentoStr}" />
								</p:column>
								<p:column sortBy="#{l.valor}" filterMatchMode="contains"
									filterBy="#{l.valor}" headerText="Valor">
									<h:outputText value="#{l.valor}">
										<f:convertNumber currencySymbol="R$ " type="currency" />
									</h:outputText>
								</p:column>
								<p:column sortBy="#{l.dataCreditoStr}"
									filterMatchMode="contains" filterBy="#{l.dataCreditoStr}"
									headerText="Data de Crédito">
									<h:outputText value="#{l.dataCreditoStr}" />
								</p:column>
								<p:column sortBy="#{l.dataPagamentoStr}"
									filterMatchMode="contains" filterBy="#{l.dataPagamentoStr}"
									headerText="Data de Pagamento">
									<h:outputText value="#{l.dataPagamentoStr}" />
								</p:column>
								<p:column sortBy="#{(l.validado == 'S' ? 'Sim' : 'Não')}"
									filterMatchMode="contains"
									filterBy="#{(l.validado == 'S' ? 'Sim' : 'Não')}"
									headerText="Validado?">
									<h:outputText value="#{(l.validado == 'S' ? 'Sim' : 'Não')}" />
								</p:column>
								<p:column sortBy="#{l.validadoPorProfissional.dadosBasico.nome}"
									filterMatchMode="contains"
									filterBy="#{l.validadoPorProfissional.dadosBasico.nome}"
									headerText="Validado Por">
									<h:outputText
										value="#{l.validadoPorProfissional.dadosBasico.nome}" />
								</p:column>
							</p:dataTable>

						</div>
					</div>
				</p:scrollPanel>
			</p:outputPanel>
			<p:panelGrid columns="4" layout="grid" id="buttonViewFatura"
				styleClass="ui-panelgrid-blank form-group ui-fluid removeSideGridPadding">
				<p:commandButton value="Fechar" icon="fa fa-close"
					styleClass="NavyButton" onclick="PF('dlgFaturaView').hide()"
					process="@this" />
				<p:commandButton value="Novo Lançamento" icon="fa fa-gear"
					process="@this" update=":lume:pnlNewLancamento"
					styleClass="OrangeButton"
					disabled="#{faturaPagtoMB.getTotalRestante(faturaPagtoMB.entity) le 0}"
					actionListener="#{faturaPagtoMB.actionNewLancamento}"
					oncomplete="PF('dlgNewLancamento').show()" />
			</p:panelGrid>
		</p:dialog>

		<div class="ui-g ui-fluid">
			<div class="ui-g-12 ui-lg-12">
				<div class="card card-w-title">
					<p:panelGrid columns="2" layout="grid" id="filterFaturas"
						styleClass="ui-panelgrid-blank ui-fluid form-group removeSideGridPadding">
						<h:panelGroup>
							<h:outputText for="inicio" value="Data de criação de:" />
							<p:calendar id="inicio" value="#{faturaPagtoMB.inicio}" />
						</h:panelGroup>
						<h:panelGroup>
							<h:outputText for="fim" value="Data de criação até:" />
							<p:calendar id="fim" value="#{faturaPagtoMB.fim}" />
						</h:panelGroup>
						<h:panelGroup styleClass="noupdate">
							<h:outputText for="filtroPaciente" value="Paciente:" />
							<p:autoComplete id="filtroPaciente"
								value="#{faturaPagtoMB.paciente}"
								completeMethod="#{faturaPagtoMB.sugestoesPacientes}" var="p"
								itemLabel="#{p.dadosBasico.nome}" itemValue="#{p}"
								converter="paciente" forceSelection="true" scrollHeight="400"
								minQueryLength="3" queryDelay="1000">

								<p:column headerText="Nome">
									<h:outputText value="#{p.dadosBasico.nome}" />
								</p:column>
								<p:column headerText="Celular">
									<h:outputText value="#{p.dadosBasico.celular}" />
								</p:column>
								<p:column headerText="Nome da Mãe">
									<h:outputText value="#{p.nomeMae}" />
								</p:column>

							</p:autoComplete>
						</h:panelGroup>
						<ui:remove>
							<h:panelGroup>
								<p:outputLabel for="pt" value="Planos de Tratamento:" />
								<p:selectCheckboxMenu id="pt"
									value="#{faturaPagtoMB.ptSelecionados}"
									converter="planoTratamento">
									<f:selectItems value="#{faturaPagtoMB.listaPt}" var="plt"
										itemValue="#{plt}" itemLabel="#{plt.descricao}" />
									<p:ajax process="@this" />
									<p:ajax event="toggleSelect" process="@this" />
								</p:selectCheckboxMenu>
							</h:panelGroup>
						</ui:remove>
						<h:panelGroup>
							<p:outputLabel for="status" value="Status: " />
							<p:selectOneMenu id="status" value="#{faturaPagtoMB.status}">
								<f:selectItem itemValue="#{null}"
									itemLabel="Selecione um Status" />
								<f:selectItems value="#{faturaPagtoMB.listaStatus}" var="status"
									itemLabel="#{status}" itemValue="#{status}" />
								<p:ajax process="@this" />
							</p:selectOneMenu>
						</h:panelGroup>

					</p:panelGrid>
					<p:panelGrid columns="4" layout="grid"
						styleClass="ui-panelgrid-blank ui-fluid form-group removeSideGridPadding">
						<p:commandButton actionListener="#{faturaPagtoMB.pesquisar}"
							process="@this, :lume:filterFaturas" value="Pesquisar" update=":lume:dtPrincipal" />
					</p:panelGrid>
					<div class="SeparatorFull"></div>
					<br />
					<p:dataTable filterDelay="1500" reflow="true" emptyMessage=""
						id="dtPrincipal" value="#{faturaPagtoMB.entityList}" var="f"
						rows="20" paginator="true" rowKey="#{f}"
						paginatorPosition="bottom">
						<f:facet name="header">Faturas</f:facet>
						<p:column width="120" headerText="Detalhes">
							<p:commandButton icon="fa fa-eye" process="@this"
								actionListener="#{faturaPagtoMB.visualizaFatura(f)}"
								update=":lume:pnlfaturaView, :lume:pnlfaturaViewHeader, :lume:buttonViewFatura"
								onclick="PF('dlgFaturaView').show();" styleClass="NavyButton"
								title="Visualizar Fatura" />
						</p:column>
						<p:column filterBy="#{f.paciente.dadosBasico.nomeStr}"
							sortBy="#{f.paciente.dadosBasico.nome}"
							filterMatchMode="contains">
							<f:facet name="header">
								<h:outputText value="Paciente" />
							</f:facet>
							<h:outputText value="#{f.paciente.dadosBasico.nome}" />
						</p:column>
						<p:column filterBy="#{f.dataCriacaoStr}"
							headerText="Data de Criação" filterMatchMode="contains"
							sortBy="#{f.dataCriacaoStr}">
							<h:outputText value="#{f.dataCriacaoStr}" />
						</p:column>

						<p:column filterBy="#{faturaPagtoMB.getTotal(f)}"
							headerText="Valor total da fatura" filterMatchMode="contains"
							sortBy="#{faturaPagtoMB.getTotal(f)}">
							<h:outputText value="#{faturaPagtoMB.getTotal(f)}">
								<f:convertNumber currencySymbol="R$ " type="currency" />
							</h:outputText>
						</p:column>

					</p:dataTable>
				</div>
			</div>
		</div>

		<script type="text/javascript">
			//<![CDATA[

			//]]>
		</script>
	</ui:define>
</ui:composition>